if setfpscap then setfpscap(120) end
local HWID = game:GetService("RbxAnalyticsService"):GetClientId()
local API_URL = "https://api.shieldteam.asia"

local Http = game:GetService("HttpService")
local url = API_URL .. "/api/validate?key=" .. Key .. "&hwid=" .. HWID

local success, response = pcall(function()
    return game:HttpGet(url)
end)

if success then
    local data = Http:JSONDecode(response)
    if data.status then
        print("Login Sukses! Sisa waktu: " .. tostring(data.timeLeft))
    else
        game.Players.LocalPlayer:Kick("Key Invalid or Expired: " .. tostring(data.msg))
        return
    end
else
    warn("Gagal connect ke server: " .. tostring(response))
    return 
end
-- [[ iOS Discord Loader V5 (Thank You Support) ]] --
local function RunLoader()
    local Players = game:GetService("Players")
    local CoreGui = game:GetService("CoreGui")
    local TweenService = game:GetService("TweenService")
    local Lighting = game:GetService("Lighting")
    
    local Player = Players.LocalPlayer or Players.PlayerAdded:Wait()
    
    local Parent = CoreGui
    if not pcall(function() local x = Instance.new("ScreenGui", CoreGui) x:Destroy() end) then
        Parent = Player:WaitForChild("PlayerGui")
    end
    
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "iOSLoader"
    ScreenGui.Parent = Parent
    ScreenGui.IgnoreGuiInset = true
    ScreenGui.DisplayOrder = 10000 
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- 1. Blur Effect
    local Blur = Instance.new("BlurEffect")
    Blur.Size = 0
    Blur.Parent = Lighting
    TweenService:Create(Blur, TweenInfo.new(0.5), {Size = 15}):Play() -- Less blur for small UI

    -- 2. Dark Overlay
    local Backdrop = Instance.new("Frame")
    Backdrop.Size = UDim2.new(1, 0, 1, 0)
    Backdrop.BackgroundColor3 = Color3.new(0,0,0)
    Backdrop.BackgroundTransparency = 1
    Backdrop.Parent = ScreenGui
    
    TweenService:Create(Backdrop, TweenInfo.new(0.5), {BackgroundTransparency = 0.5}):Play()
    
    -- 3. Main Card (Compact)
    local Card = Instance.new("Frame")
    Card.Size = UDim2.new(0, 220, 0, 160) -- Very small fixed size
    Card.Position = UDim2.new(0.5, 0, 0.5, 0)
    Card.AnchorPoint = Vector2.new(0.5, 0.5)
    Card.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Card.BackgroundTransparency = 0.1
    Card.BorderSizePixel = 0
    Card.ClipsDescendants = true
    Card.Parent = ScreenGui
    
    local UIConstraint = Instance.new("UISizeConstraint")
    UIConstraint.MinSize = Vector2.new(180, 140)
    UIConstraint.MaxSize = Vector2.new(240, 180)
    UIConstraint.Parent = Card
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12) 
    UICorner.Parent = Card
    
    -- Scale Animation
    local Scale = Instance.new("UIScale")
    Scale.Scale = 1.1
    Scale.Parent = Card
    
    Scale.Scale = 0
    TweenService:Create(Scale, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Scale = 1}):Play()
    
    -- Title
    local Title = Instance.new("TextLabel")
    Title.Text = "Join Community"
    Title.Font = Enum.Font.GothamBold 
    Title.TextSize = 16
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Size = UDim2.new(1, 0, 0, 20)
    Title.Position = UDim2.new(0, 0, 0, 15)
    Title.BackgroundTransparency = 1
    Title.Parent = Card
    
    -- Description
    local Desc = Instance.new("TextLabel")
    Desc.Text = "Discord updates:"
    Desc.Font = Enum.Font.Gotham
    Desc.TextSize = 12
    Desc.TextColor3 = Color3.fromRGB(200, 200, 200)
    Desc.Size = UDim2.new(0.9, 0, 0, 20)
    Desc.Position = UDim2.new(0.05, 0, 0, 35)
    Desc.BackgroundTransparency = 1
    Desc.TextWrapped = true
    Desc.Parent = Card
    
    -- Link Display
    local LinkText = Instance.new("TextLabel")
    LinkText.Text = "discord.gg/f7P7qxtJFq"
    LinkText.Font = Enum.Font.Code
    LinkText.TextSize = 11
    LinkText.TextColor3 = Color3.fromRGB(100, 180, 255)
    LinkText.Size = UDim2.new(1, 0, 0, 20)
    LinkText.Position = UDim2.new(0, 0, 0, 60)
    LinkText.BackgroundTransparency = 1
    LinkText.Parent = Card

    -- Separators
    local HLine = Instance.new("Frame")
    HLine.Size = UDim2.new(1, 0, 0, 1)
    HLine.Position = UDim2.new(0, 0, 1, -40)
    HLine.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    HLine.BorderSizePixel = 0
    HLine.BackgroundTransparency = 0
    HLine.Parent = Card

    -- Button
    local ActionBtn = Instance.new("TextButton")
    ActionBtn.Text = "Copy Link"
    ActionBtn.Font = Enum.Font.GothamBold
    ActionBtn.TextSize = 14
    ActionBtn.TextColor3 = Color3.fromRGB(10, 132, 255) 
    ActionBtn.Size = UDim2.new(1, 0, 0, 40)
    ActionBtn.Position = UDim2.new(0, 0, 1, -40)
    ActionBtn.BackgroundTransparency = 1
    ActionBtn.Parent = Card
    
    -- Logic
    local Finished = false
    
    local isClicked = false
    ActionBtn.MouseButton1Click:Connect(function()
        if isClicked then return end
        isClicked = true

        if setclipboard then
            setclipboard("https://discord.gg/f7P7qxtJFq")
        end
        ActionBtn.Text = "Copied"
        ActionBtn.TextColor3 = Color3.fromRGB(48, 209, 88) -- Green
        
        task.wait(0.5)
        
        -- Start Countdown
        for i = 3, 1, -1 do -- Faster countdown
            ActionBtn.Text = tostring(i)
            ActionBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
            task.wait(0.8)
        end

        -------------------------------------------------------------
        -- TRANSITION: THANK YOU SCREEN
        -------------------------------------------------------------
        -- Fade out old elements
        local fadeInfo = TweenInfo.new(0.2)
        TweenService:Create(Title, fadeInfo, {TextTransparency = 1}):Play()
        TweenService:Create(Desc, fadeInfo, {TextTransparency = 1}):Play()
        TweenService:Create(LinkText, fadeInfo, {TextTransparency = 1}):Play()
        TweenService:Create(ActionBtn, fadeInfo, {TextTransparency = 1}):Play()
        TweenService:Create(HLine, fadeInfo, {BackgroundTransparency = 1}):Play()
        
        task.wait(0.2)

        -- Change content to "Thanks"
        Title.Text = "Verified"
        Title.TextColor3 = Color3.fromRGB(48, 209, 88) -- Success Green
        Title.Position = UDim2.new(0,0, 0.4, 0) -- Center

        Desc.Text = "Loading..."
        Desc.Size = UDim2.new(0.9, 0, 0, 20)
        Desc.Position = UDim2.new(0.05, 0, 0.55, 0) -- Below Title
        Desc.TextSize = 12
        
        -- Fade in new content
        TweenService:Create(Title, fadeInfo, {TextTransparency = 0}):Play()
        TweenService:Create(Desc, fadeInfo, {TextTransparency = 0}):Play()

        -- Wait for user to read
        task.wait(1.5)

        -- Close Animation
        TweenService:Create(Scale, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {Scale = 0}):Play()
        TweenService:Create(Backdrop, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
        TweenService:Create(Blur, TweenInfo.new(0.5), {Size = 0}):Play()
        task.wait(0.2)
        
        ScreenGui:Destroy()
        Blur:Destroy()
        Finished = true
    end)
    
    repeat task.wait() until Finished
end

RunLoader()

-- Load required libraries
local Fluent = loadstring(game:HttpGet("https://raw.githubusercontent.com/KAN-FISCH/tesss/refs/heads/main/gunung/njajeakjrnaejrar1"))()
local webhook = loadstring(game:HttpGet("https://raw.githubusercontent.com/KAN-FISCH/tesss/refs/heads/main/weebhook"))()
local servershield = loadstring(game:HttpGet("https://raw.githubusercontent.com/KAN-FISCH/tesss/refs/heads/main/servershield"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()
-- local webhook = loadstring(game:HttpGet("https://raw.githubusercontent.com/KAN-FISCH/tesss/refs/heads/main/weebhook"))()
-- local webhook1 = loadstring(game:HttpGet("https://raw.githubusercontent.com/KAN-FISCH/tesss/refs/heads/main/servershield"))()

-- Initialize Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local GuiService = game:GetService("GuiService")
local HttpService = game:GetService("HttpService")

-- Player references
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Backpack = LocalPlayer:WaitForChild("Backpack")
local RodName = workspace.PlayerStats[LocalPlayer.Name].T[LocalPlayer.Name].Stats.rod.Value
local CoreGui = game:GetService("CoreGui")
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")
local Terrain = workspace:FindFirstChildOfClass("Terrain")
local FishingZonesFolder = Workspace:FindFirstChild("zones"):WaitForChild("fishing")
local BackpackEquipEvent = ReplicatedStorage:WaitForChild("packages"):WaitForChild("Net"):WaitForChild("RE/Backpack/Equip")
local workspace = game:GetService("Workspace")

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local speaker = Players.LocalPlayer

local function getRoot(character)
    return character and character:FindFirstChild("HumanoidRootPart") or nil
end
local Service = game:GetService("TextChatService")
function detectRobloxExecutorName()
    local exec = "Unknown"
    if identifyexecutor then
        exec = identifyexecutor()
    elseif getexecutorname and type(getexecutorname) == "function" then
        exec = getexecutorname()
    elseif syn and syn.executor and type(syn.executor) == "string" then
        exec = syn.executor
    elseif is_sirhurt_closure then
        exec = "SirHurt"
    elseif is_protosmasher_closure then
        exec = "ProtoSmasher"
    elseif KRNL_LOADED then
        exec = "KRNL"
    elseif SENTINEL_LOADED then
        exec = "Sentinel"
    elseif is_synapse_function then
        exec = "Synapse X"
    elseif debug and debug.getregistry then
        for _, v in ipairs(debug.getregistry()) do
            if type(v) == "table" and rawget(v, "luadecomp") then
                exec = "Luna"
            end
        end
    end
    if exec == "NX" or string.find(exec:lower(), "nx") then
        exec = "Luna"
    end

    return exec
end

local executorName = detectRobloxExecutorName()
if not _G.Config then
    _G.Config = {
        ['Farm Fish'] = false,
        AutoCast = false,
        InstantCast = false,
        AutoReel = false,
        InstantReel = false,
        AutoPerfectCatch = false,
        selectedZone = "None",
        selectedZoneADS = false,
        AutoSellOnHeld = false,
        isFishing = false,
        equipRod = false,
        playerDetectionEnabled = false,
        isEquipRpd = false,
        AutoSell = false,
        AutoShake = false,
        AutoFavorite = false,
        RemoveUIFisch = false,
        AutoSaveConfig = false,
        ReelMode = "Legit"
    }
end

-- Variables untuk auto save system
local autoSaveEnabled = false
local autoSaveConnection = nil
local lastSavedConfig = {}
local saveInterval = 1

-- Function untuk deep copy table
local function deepCopy(original)
    local copy = {}
    for key, value in pairs(original) do
        if type(value) == "table" then
            copy[key] = deepCopy(value)
        else
            copy[key] = value
        end
    end
    return copy
end

-- Function untuk compare config changes
local function configChanged()
    for key, value in pairs(_G.Config) do
        if lastSavedConfig[key] ~= value then
            return true
        end
    end
    return false
end

-- Function untuk save config
local function saveConfig()
    local HttpService = game:GetService("HttpService")
    local configString = HttpService:JSONEncode(_G.Config)
    if writefile then
        writefile("FischConfig.json", configString)
        print("[Auto Save] Config saved to FischConfig.json")
    end
    lastSavedConfig = deepCopy(_G.Config)
end

local function loadConfig()
    if readfile and isfile and isfile("FischConfig.json") then
        local HttpService = game:GetService("HttpService")
        local success, result = pcall(function()
            local configString = readfile("FischConfig.json")
            return HttpService:JSONDecode(configString)
        end)
        
        if success and result then
            for key, value in pairs(result) do
                if _G.Config[key] ~= nil then
                    _G.Config[key] = value
                end
            end
            return true
        end
    end
    return false
end

local function startAutoSave()
    autoSaveConnection = spawn(function()
        while autoSaveEnabled do
            wait(saveInterval)
            
            if autoSaveEnabled and configChanged() then
                saveConfig()
            end
        end
    end)
end

local function stopAutoSave()
    autoSaveEnabled = false
    if autoSaveConnection then
        autoSaveConnection = nil
    end
end

local function toggleAutoSaveConfig(state)
    _G.Config.AutoSaveConfig = state
    autoSaveEnabled = state
    if state then
        loadConfig()
        lastSavedConfig = deepCopy(_G.Config)
        startAutoSave()
        saveConfig()
    else
        stopAutoSave()
        if configChanged() then
            saveConfig()
        end
    end
end
DelayFasterReel = 2
local function manualSaveConfig()
    saveConfig()
end

local function manualLoadConfig()
    if loadConfig() then
    end
end
spawn(function()
    loadConfig()
end)
if not _G.AllFuncs then
    _G.AllFuncs = {}
end


local isFreaze = false

local function FreazeChar(state)
    isFreaze = state  
    local Character = LocalPlayer.Character
    if Character then
        local Humanoid = Character:FindFirstChild("Humanoid")
        local Animator = Humanoid and Humanoid:FindFirstChild("Animator")
        local AnimateScript = Character:FindFirstChild("Animate")

        if isFreaze then
            if Animator then
                Animator:Destroy() 
            end
            if AnimateScript then
                AnimateScript.Disabled = true
            end
        else
            if Humanoid and not Humanoid:FindFirstChild("Animator") then
                local NewAnimator = Instance.new("Animator")
                NewAnimator.Parent = Humanoid
            end
            if AnimateScript then
                AnimateScript.Disabled = false
            end
        end
    end
end
local isFrozen = false
local frozenPosition = nil

local function FreezeCharacter(state)
    local Character = LocalPlayer.Character
    if not Character then return end

    local HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    if not HumanoidRootPart then return end

    if state then
        frozenPosition = HumanoidRootPart.CFrame
        isFrozen = true
        task.spawn(function()
            while isFrozen do
                HumanoidRootPart.CFrame = frozenPosition 
                task.wait(0.01)
            end
        end)
    else
        isFrozen = false
    end
end
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local heartbeatConnection
superinstantreeel = false
superinstantreeldelay = 0.1 
local lastCastTime = 0 
local castCooldown = tonumber(superinstantreeldelay or 0.1)

local function dropbobber()
    local activeFolder = workspace:FindFirstChild("active")
    
    local function isException(name)
        return name:find("Bobber") or name:find("Rod") or name:find("DivingGear")
    end

    local function cast(Rod)
        if not Rod or Rod.Parent ~= LocalPlayer.Character then return end
        local currentTime = tick()
        if currentTime - lastCastTime < 0.3 then return end -- Tight debounce
        
        local events = Rod:FindFirstChild("events")
        if events and events:FindFirstChild("castAsync") then
            lastCastTime = currentTime
            task.spawn(function()
                events.castAsync:InvokeServer(100, 1)
            end)
        end
    end

    local function startRodLoop(Rod)
        local currentBobber = nil
        local positionConnection = nil

        local function cleanup()
            if positionConnection then
                positionConnection:Disconnect()
                positionConnection = nil
            end
            currentBobber = nil
        end

        -- TRIGGER 1: Bobber Destroyed (Fastest for re-cast)
        Rod.ChildRemoved:Connect(function(child)
            if child.Name == "bobber" and _G.Config.AutoCast then
                cleanup()
                cast(Rod)
            end
        end)

        -- TRIGGER 2: Fish Spawned in Active (Backup for instant catch)
        if activeFolder then
            activeFolder.ChildAdded:Connect(function(item)
                if not _G.Config.AutoCast or Rod.Parent ~= LocalPlayer.Character then return end
                
                local function check()
                    if not item.Parent then return end
                    if not isException(item.Name) then
                        local ownerId = item:GetAttribute("OwnerId")
                        if ownerId == LocalPlayer.UserId then
                            cleanup()
                            cast(Rod)
                        end
                    end
                end

                -- Immediate check + Attribute listener for speed
                check()
                local attrConn
                attrConn = item:GetAttributeChangedSignal("OwnerId"):Connect(function()
                    check()
                    if attrConn then attrConn:Disconnect() end
                end)
                task.delay(1, function() if attrConn then attrConn:Disconnect() end end)
            end)
        end

        -- Positioning Loop (Heartbeat only for movement, not casting)
        task.spawn(function()
            while Rod and Rod.Parent == LocalPlayer.Character and _G.Config.AutoCast do
                local Bobber = Rod:FindFirstChild("bobber")
                
                if not Bobber then
                    cleanup()
                    cast(Rod)
                elseif Bobber ~= currentBobber then
                    cleanup()
                    currentBobber = Bobber
                    
                    positionConnection = RunService.Heartbeat:Connect(function()
                        if not Bobber or not Bobber.Parent or not Rod or Rod.Parent ~= LocalPlayer.Character or not _G.Config.AutoCast then
                            cleanup()
                            return
                        end

                        local humanoidRootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                        if not humanoidRootPart then return end

                        local dropDone = false
                        -- Carrot Secret Detection
                        local carrotSecretFolder = workspace:FindFirstChild("world")
                            and workspace.world:FindFirstChild("map")
                            and workspace.world.map:FindFirstChild("Carrot Secret")
                        if carrotSecretFolder then
                            local closestMesh = nil
                            local closestDist = math.huge
                            for _, model in ipairs(carrotSecretFolder:GetChildren()) do
                                local mesh = model:FindFirstChild("Meshes/CarrotPool_Cube.001 (1)")
                                if mesh and mesh:IsA("MeshPart") then
                                    local dist = (humanoidRootPart.Position - mesh.Position).Magnitude
                                    if dist < closestDist then
                                        closestDist = dist
                                        closestMesh = mesh
                                    end
                                end
                            end

                            if closestMesh and closestDist < 50 then
                                Bobber:PivotTo(CFrame.new(closestMesh.Position))
                                Bobber.AssemblyLinearVelocity = Vector3.zero
                                Bobber.AssemblyAngularVelocity = Vector3.zero
                                dropDone = true
                            end
                        end

                        if not dropDone then
                            local fishingZone = workspace:FindFirstChild("zones") and workspace.zones:FindFirstChild("fishing")
                            if fishingZone then
                                local origin = humanoidRootPart.Position + humanoidRootPart.CFrame.LookVector * 5
                                local bestPart = nil
                                local bestDist = math.huge
                                        
                                for _, v in ipairs(fishingZone:GetDescendants()) do
                                    if v:IsA("BasePart") then
                                        local dist = (v.Position - origin).Magnitude
                                        if dist < bestDist then
                                            bestDist = dist
                                            bestPart = v
                                        end
                                    end
                                end

                                if bestPart then
                                    Bobber.AssemblyLinearVelocity = Vector3.zero
                                    Bobber.AssemblyAngularVelocity = Vector3.zero
                                    local offset = 3
                                    local map = workspace:FindFirstChild("world") and workspace.world:FindFirstChild("map")
                                    local wiz = map and map:FindFirstChild("WizardCave1")
                                    if wiz and #wiz:GetChildren() > 0 then offset = 3 end
                                    local surfaceY = bestPart.Position.Y + bestPart.Size.Y/2 - offset
                                    Bobber.CFrame = CFrame.new(origin.X, surfaceY, origin.Z)
                                end
                            end
                        end
                    end)
                end
                RunService.Heartbeat:Wait()
            end
            cleanup()
        end)
    end

    LocalPlayer.Character.ChildAdded:Connect(function(child)
        if not child:IsA("Tool") then return end
        local playerStats = workspace:FindFirstChild("PlayerStats")
        if not playerStats then return end
        local firstPlayerFolder = playerStats:FindFirstChild(LocalPlayer.Name)
        if not firstPlayerFolder then return end
        local modelT = firstPlayerFolder:FindFirstChild("T")
        if not modelT then return end
        local secondPlayerFolder = modelT:FindFirstChild(LocalPlayer.Name)
        if not secondPlayerFolder then return end
        local rodValue = secondPlayerFolder.Stats:FindFirstChild("rod")
        if not rodValue then return end

        if child.Name == rodValue.Value then
            startRodLoop(child)
        end
    end)
    
    local currentRodName = workspace.PlayerStats[LocalPlayer.Name].T[LocalPlayer.Name].Stats.rod.Value
    local currentRod = LocalPlayer.Character:FindFirstChild(currentRodName)
    if currentRod then
        startRodLoop(currentRod)
    end
end
task.spawn(function()
    local success, err = pcall(function()
        local Players = game:GetService("Players")
        local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()
        local PlayerGui = LocalPlayer:WaitForChild("PlayerGui", 30)
        
        if not PlayerGui then 
            return 
        end

        local function cleanOverlay(parent)
            -- Destroy the Astraeus specific overlay
            local overlay = parent:FindFirstChild("Astraeus_Overlay")
            if overlay then overlay:Destroy() end
            
            -- Based on your decompiled code: Destroy generic cinematic frames
            local frame = parent:FindFirstChild("Frame")
            if frame and frame:IsA("Frame") and parent:IsA("ScreenGui") then
                -- Common cinematic/zoom overlay detected
                parent:Destroy() 
                return
            end

            parent.ChildAdded:Connect(function(child)
                if child.Name == "Astraeus_Overlay" or child.Name == "Frame" then
                    task.wait() 
                    if parent:IsA("ScreenGui") and child.Name == "Frame" then
                        parent:Destroy()
                    else
                        child:Destroy()
                    end
                end
            end)
        end

        -- Aggressively target known "zoom/cinematic" names globally
        local targets = {"over", "vignette", "cinematic", "overlay"}
        local parents = {PlayerGui, game:GetService("ReplicatedStorage"), workspace, game:GetService("Lighting")}

        local function purge(parent)
            for _, desc in pairs(parent:GetDescendants()) do
                for _, t in ipairs(targets) do
                    if desc.Name:lower() == t then
                        pcall(function() desc:Destroy() end)
                    end
                end
            end
        end

        for _, p in ipairs(parents) do 
            purge(p) 
            p.DescendantAdded:Connect(function(desc)
                for _, t in ipairs(targets) do
                    if desc.Name:lower() == t then
                        task.wait()
                        pcall(function() desc:Destroy() end)
                    end
                end
            end)
        end

    end)
    
    if not success then
        warn("[Auto Remove Error]: " .. tostring(err))
    end
end)
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local counter = 0

LegitReel = false
__var = {
	reelConnection = nil,
	autoReelEnabled = true,
	perfectCatchEnabled = true,
    DelayTimeFaster = 5,
	isReeling = false,
    AutoSnapEnabled = false,
    SnapTarget = "",
    SnapMutation = "",
    Hunting_Enabled = false,
    Hunting_Target = nil,
    savedPosition = nil,
    barSize = 2
}
local function StartAutoReel()
    -- Hook ReelController Logic (Magnet Fish)
    if not _G.ReelLogicHooked then
        _G.ReelLogicHooked = true
        task.spawn(function()
            local success, RC = pcall(function() 
                return require(game:GetService("ReplicatedStorage").client.legacyControllers.ReelController) 
            end)
            if success and RC and RC.Update then
                local oldUpdate = RC.Update
                RC.Update = function(self, dt)
                    if _G.Config.InstantReel then
                        -- Force progress to 100 so it finishes the MOMENT it becomes ready
                        self.progress = 100
                        
                        -- Force visual bar to 100% immediately to hide animation
                        pcall(function()
                            if self.reel_progress and self.reel_progress.bar then
                                self.reel_progress.bar.Size = UDim2.fromScale(1, 1)
                            end
                        end)
                    end
                    
                    pcall(function()
                        oldUpdate(self, dt)
                    end)
                    if LegitReel or _G.Config.ReelMode == "Instant" then 
                         self.fishPosition = self.barPosition
                    end
                end
            end
        end)
    end
end


local function getCurrentRod()
    local char = Players.LocalPlayer.Character
    if not char then return nil end
    for _, tool in ipairs(char:GetChildren()) do
        if tool:IsA("Tool") and tool:FindFirstChild("events") then
            return tool
        end
    end
    return nil
end

local function supereel()
	 if __var.reelConnection then
        __var.reelConnection:Disconnect()
        __var.reelConnection = nil
    end

    local lastReel = nil
    LegitReel = true
            StartAutoReel()
    __var.isReeling = false

    __var.reelConnection = RunService.Heartbeat:Connect(function()
        if not __var.autoReelEnabled then
            return
        end

        local reel = PlayerGui:FindFirstChild('reel')
        if reel and reel ~= lastReel and not __var.isReeling then
            __var.isReeling = true
            lastReel = reel

            task.spawn(function()
                task.wait(__var.DelayTimeFaster or 5)

                local isPerfect
                if __var.perfectCatchEnabled then
                    isPerfect = true
                else
                    local chances =
                        { true, false, false, false, false, false, false }
                    isPerfect = chances[math.random(1, #chances)]
                end

                local success, err = pcall(function()
                   

                end)

                local destroyed = false
                local ancestryConn
                ancestryConn = reel.AncestryChanged:Connect(function()
                    destroyed = true
                    ancestryConn:Disconnect()
                end)

                local timeout = 3
                while not destroyed and timeout > 0 do
                    task.wait(0.1)
                    timeout -= 0.1
                end

                if ancestryConn then
                    ancestryConn:Disconnect()
                end

                __var.isReeling = false
            end)
        end
    end)
end

local v_u_1 = game:GetService("ReplicatedStorage")
local v_u_10 = require(v_u_1.shared.modules.LocalPassive)
local v_u_13 = v_u_10:GetSource("FishBehavior")

local function EndMinigame(isPerfect)
    pcall(function()
        local progress = 100
        -- Use the REAL remote found in the decompiled code
        game:GetService("ReplicatedStorage").events["Reel/Finish"]:FireServer({
            e = progress,
            p = isPerfect or true,
            l = {}
        })
        -- Signal local UI cleanup
        game:GetService("ReplicatedStorage").events.bindable_reel_finished:Fire(true)
    end)
end
task.spawn(function()
    local player = game.Players.LocalPlayer
    local gui = player:WaitForChild("PlayerGui")
    
    -- Cache HUD
    local hudCache = gui:FindFirstChild("hud")
    
    local function disableReel(reel)
        if not _G.Config.InstantReel then return end
        if not reel then return end
        
        -- Just disable, don't destroy
        if reel:IsA("ScreenGui") then
            reel.Enabled = false
            reel.ResetOnSpawn = false
        end
    end

    local function stickyGui(obj)
        if not obj then return end
        
        if obj:IsA("ScreenGui") then
            if not obj.Enabled then obj.Enabled = true end
            obj:GetPropertyChangedSignal("Enabled"):Connect(function()
                if not obj.Enabled then obj.Enabled = true end
            end)
        elseif obj:IsA("GuiObject") then
            if not obj.Visible then obj.Visible = true end
            obj:GetPropertyChangedSignal("Visible"):Connect(function()
                if not obj.Visible then obj.Visible = true end
            end)
        end
    end

    local function ensureBackpackVisible()
        local bp = gui:FindFirstChild("backpack") or gui:FindFirstChild("Backpack")
        if bp then
            stickyGui(bp)
            local hb = bp:FindFirstChild("hotbar") or bp:FindFirstChild("Hotbar")
            if hb then stickyGui(hb) end
        end
        local hbSeparate = gui:FindFirstChild("hotbar") or gui:FindFirstChild("Hotbar")
        if hbSeparate then stickyGui(hbSeparate) end
    end
    
    local function monitorReel(reel)
        if not reel then return end
        
        reel:GetPropertyChangedSignal("Enabled"):Connect(function()
            if _G.Config.InstantReel and reel.Enabled then
                reel.Enabled = false
            end
        end)
    end
    
    local function ensureHudEnabled()
        if hudCache and not hudCache.Enabled then
            hudCache.Enabled = true
        end
    end
    
    gui.ChildAdded:Connect(function(child)
        local cName = child.Name:lower()
        if cName == "backpack" or cName == "hotbar" then
            ensureBackpackVisible()
        end

        if child.Name == "reel" then
            if _G.Config.InstantReel then
                disableReel(child)
                monitorReel(child)
                ensureHudEnabled()
            end
            
        elseif child.Name == "hud" then
            hudCache = child
            
            child:GetPropertyChangedSignal("Enabled"):Connect(function()
                if not child.Enabled then
                    child.Enabled = true
                end
            end)
        end
    end)
    
    local existingReel = gui:FindFirstChild("reel")
    if existingReel then
        disableReel(existingReel)
        monitorReel(existingReel)
    end
    
    ensureHudEnabled()

    -- task.spawn(function()
    --     local function clearAnims(char)
    --         local hum = char:WaitForChild("Humanoid")
    --         local animator = hum:WaitForChild("Animator")
            
    --         animator.AnimationPlayed:Connect(function(track)
    --             track:Stop()
    --         end)
            
    --         for _, track in pairs(animator:GetPlayingAnimationTracks()) do
    --             track:Stop()
    --         end
    --     end
        
    --     if player.Character then pcall(clearAnims, player.Character) end
    --     player.CharacterAdded:Connect(function(char)
    --         pcall(clearAnims, char)
    --     end)
    -- end)

    -- ============================================
    -- STABLE CAMERA LOCK (BYPASS VIEW LOCK)
    -- ============================================
    local RunService = game:GetService("RunService")
    RunService.RenderStepped:Connect(function()
        if _G.Config and _G.Config.InstantReel then
            local camera = workspace.CurrentCamera
            if not camera then return end
            
            local character = player.Character
            local humanoid = character and character:FindFirstChild("Humanoid")
            
            -- Prevent game from focus on fish/bobber
            if humanoid and camera.CameraSubject ~= humanoid then
                camera.CameraSubject = humanoid
            end
            
            -- Prevent cinematic FOV changes
            if camera.FieldOfView ~= 70 then
                camera.FieldOfView = 70
            end

            -- Prevent zoom locking
            if player.CameraMaxZoomDistance < 50 then
                player.CameraMaxZoomDistance = 120
                player.CameraMinZoomDistance = 10
            end
            
            -- Ensure camera is controllable
            if camera.CameraType ~= Enum.CameraType.Custom then
                camera.CameraType = Enum.CameraType.Custom
            end
        end
    end)

    task.spawn(function()
        while true do
            ensureBackpackVisible()
            if _G.Config.InstantReel then
                local reel = gui:FindFirstChild("reel")
                if reel and reel:IsA("ScreenGui") and reel.Enabled then
                    reel.Enabled = false
                end
                
                ensureHudEnabled()
            end
            
            task.wait(0.5)
        end
    end)
    
    print("✅ Instant Reel Active (Disable Mode - No Errors)")
end)
task.spawn(function()
    local Players = game:GetService("Players")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local LocalPlayer = Players.LocalPlayer
    local CONFIG = {
        PROGRESS_EFFICIENCY = 10000000000000000,
        PROGRESS_LOSS = 0,
        BAR_SIZE = 5,
        RESILIENCE = 999999,
        ACCELERATION = 0,
        START_PROGRESS = 100000000,
    }
    local ORIGINAL = {
        controllerNew = nil,
        isHooked = false,
    }

    repeat task.wait(0.5) until ReplicatedStorage:FindFirstChild("client")

    local function ApplyModifiers(reelInstance)
        if not reelInstance then return false end
        
        if not _G.Config.InstantReel then
            return false
        end
        
        local applied = 0
        local modifiers = {
            {"progressefficiency", "force", CONFIG.PROGRESS_EFFICIENCY},
            {"progressLossMultiplier", "force", CONFIG.PROGRESS_LOSS},
            {"barSize", "force", CONFIG.BAR_SIZE},
            {"resilience", "force", CONFIG.RESILIENCE},
            {"accel", "force", CONFIG.ACCELERATION},
            {"progress", "force", CONFIG.START_PROGRESS},
        }
        
        for _, mod in ipairs(modifiers) do
            local success = pcall(function()
                reelInstance:AddModifier(mod[1], mod[2], mod[3])
            end)
            
            if success then
                applied = applied + 1
            end
        end
        return true
    end

    local function HookReelController()
        if ORIGINAL.isHooked then
            return true
        end
        
        local success, controller = pcall(function()
            return require(ReplicatedStorage.client.legacyControllers.ReelController)
        end)
        
        if not success then
            return false
        end
        
        ORIGINAL.controllerNew = controller.new
        controller.new = function(...)
            local instance = ORIGINAL.controllerNew(...)
            if _G.Config.InstantReel then
                -- Handle Perfect Catch Status
                local isPerfect = __var.perfectCatchEnabled
                if not isPerfect then
                    isPerfect = (math.random(1, 2) == 1) -- 50/50 chance if disabled
                end
                instance.perfect = isPerfect
                
                pcall(function()
                    instance:AddModifier("progress", "force", 1000000000)
                    instance:AddModifier("progressefficiency", "force", 1000000)
                    instance:AddModifier("resilience", "force", 0)
                    instance:AddModifier("barSize", "force", 10)
                end)
            end
            
            return instance
        end
        
        ORIGINAL.isHooked = true
        return true
    end
    local function RestoreOriginal()
        _G.Config.InstantReel = false
    end
    task.spawn(function()
        local lastState = _G.Config.InstantReel
        
        while true do
            task.wait(1)
            if _G.Config.InstantReel ~= lastState then
                lastState = _G.Config.InstantReel
                
                local emoji = _G.Config.InstantReel and "✅" or "❌"
                local status = _G.Config.InstantReel and "ENABLED" or "DISABLED"
                local mode = _G.Config.InstantReel and "Modifiers active" or "Normal fishing"
            end
        end
    end)
    local hooked = HookReelController()
end)
-- -- Auto Modifier Loop (Standalone & Auto-Start)
-- task.spawn(function()
--     local ReplicatedStorage = game:GetService("ReplicatedStorage")
--     local LocalPassive = require(ReplicatedStorage.shared.modules.LocalPassive)
--     local player = game.Players.LocalPlayer
    
--     while true do
--         if _G.Config and _G.Config.InstantReel then
--              -- Logic 1: Force Progress (Universal Compatibility)
--             -- pcall(function()
--             --     -- Source 1: GetActivePassives
--             --     local activePassives = LocalPassive:GetActivePassives()
--             --     if activePassives then
--             --         for _, passive in pairs(activePassives) do
--             --             if passive.current and passive.current.AddModifier then
--             --                 passive.current:AddModifier("progress", "add", 100)
--             --                 passive.current:AddModifier("progressefficiency", "add", 1000)
--             --                 passive.current:AddModifier("progressefficiency", "force_add", 1000)
--             --                 passive.current:AddModifier("resilience", "add", 1000)
--             --             end
--             --         end
--             --     end

--             -- end)
            
--             -- Logic 2: Force Hide Reel UI (Not Destroy)
            
--         end
--         task.wait(0.01) -- Much faster check to catch it immediately
--     end
-- end)
local bugrod = false
local finishCount = 0
local function onSound(sound)
    if sound:IsA("Sound") and sound.Name:lower():find("bite") then
        sound.Played:Connect(function()
            -- if _G.Config.InstantReel then
            --     -- INSTANT = NO CAMERA ZOOM START
            --     EndMinigame(true) 
            -- end
        end)
    end
end

-- local function onSound(sound)
--     if sound:IsA("Sound") and sound.Name:lower():find("bite") then
--         sound.Played:Connect(function()
--             if superinstantreeel then
--                  local reel = game.Players.LocalPlayer.PlayerGui:FindFirstChild("reel")
--                  -- Handle case where reel isn't immediately found (might spawn after sound)
--                  if not reel then
--                      task.wait(0.1)
--                      reel = game.Players.LocalPlayer.PlayerGui:FindFirstChild("reel")
--                  end

--                  if reel then
--                     local isPerfect2
--                     if __var.perfectCatchEnabled then
--                         isPerfect2 = true
--                     else
--                         local chances = { true, false, false, false, false, false, false }
--                         isPerfect2 = chances[math.random(1, #chances)]
--                     end
                    
--                     EndMinigame(reel, isPerfect2)
--                  end
--             end
--         end)
--     end
-- end

local function hookSound()
    local char = game.Players.LocalPlayer.Character
    if char then
        local head = char:FindFirstChild("Head")
        if head then
            head.ChildAdded:Connect(onSound)
            for _, s in ipairs(head:GetChildren()) do
                onSound(s)
            end
        end
    end
end

game.Players.LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    hookSound()
end)
hookSound()
local function InitializeCharacter(char)
    task.wait(0.1)
    dropbobber()
    supereel()
end

LocalPlayer.CharacterAdded:Connect(InitializeCharacter)

if LocalPlayer.Character then
    InitializeCharacter(LocalPlayer.Character)
end
local Utils = {}
local Connections = {}

local function EnsureInstance(instance)
    return instance and instance:IsA("GuiObject") and instance:IsDescendantOf(game)
end

local function Collect(connection)
    table.insert(Connections, connection)
    return connection
end
local function GetToggleValue(toggleName)
    return true
end

local function dbgwarn(message)
    warn(message)
end
local GuiService = game:GetService("GuiService")
local shakeSpeed = 10 -- Adjustable Speed
local function Shake()
			local function MountShakeUI(ShakeUI)
				local SafeZone = ShakeUI:WaitForChild("safezone", 1)
				
				if not SafeZone then
					warn("Unable to mount shake UI.")
					return
				end
				local Connection
				Connection = SafeZone.ChildAdded:Connect(function(Child)
					if Child:IsA("ImageButton") then
						Child.Selectable = true
						GuiService.SelectedObject = Child
                        
                        -- 1. INSTANT FIRE (Hook)
                        task.spawn(function()
                             pcall(function()
                                 if getconnections then
                                     local down = { UserInputType = Enum.UserInputType.MouseButton1, UserInputState = Enum.UserInputState.Begin }
                                     local up = { UserInputType = Enum.UserInputType.MouseButton1, UserInputState = Enum.UserInputState.End }
                                     
                                     for _, c in pairs(getconnections(Child.MouseButton1Down)) do c:Fire(100, 100) end
                                     for _, c in pairs(getconnections(Child.MouseButton1Up)) do c:Fire(100, 100) end
                                     for _, c in pairs(getconnections(Child.MouseButton1Click)) do c:Fire() end
                                     for _, c in pairs(getconnections(Child.Activated)) do c:Fire(down) end
                                     for _, c in pairs(getconnections(Child.InputBegan)) do c:Fire(down) end
                                     for _, c in pairs(getconnections(Child.InputEnded)) do c:Fire(up) end
                                 end
                             end)
                        end)

                        -- 2. Backup Super Spam (Adjustable Speed)
                        task.spawn(function()
                            while Child.Parent do
                                Child.Selectable = true -- Force constantly
                                GuiService.SelectedObject = Child
                                if keypress and keyrelease then
                                    for i=1, shakeSpeed do -- Burst 'shakeSpeed' times per frame
                                        keypress(0x0D)
                                        keyrelease(0x0D)
                                    end
                                end
                                game:GetService("RunService").RenderStepped:Wait()
                            end
                        end)
					end
				end)
				
                -- Backup Loops
				local renderConnection = RunService.RenderStepped:Connect(function()
					for _, child in pairs(SafeZone:GetChildren()) do
						if child:IsA("ImageButton") then
							child.Selectable = true
                            GuiService.SelectedObject = child
                            -- Burst here too
                            if keypress and keyrelease then
                                for i=1, shakeSpeed do
                                    keypress(0x0D)
                                    keyrelease(0x0D)
                                end
                            end
						end
					end
				end)
				
				task.spawn(function()
					while SafeZone and SafeZone:IsDescendantOf(LocalPlayer.PlayerGui) do
						task.wait(0.1)
					end
					if Connection then Connection:Disconnect() end
					if renderConnection then renderConnection:Disconnect() end
					GuiService.SelectedObject = nil
				end)
			end
			LocalPlayer.PlayerGui.ChildAdded:Connect(function(Child)
				if Child.Name == "shakeui" and Child:IsA("ScreenGui") then
					MountShakeUI(Child)
				end
			end)
			for _, Child in pairs(LocalPlayer.PlayerGui:GetChildren()) do
				if Child.Name == "shakeui" and Child:IsA("ScreenGui") then
					MountShakeUI(Child)
				end
			end
		end
local noClipEnabled = false
local fogRemoved = false
local noClipConnection

local function toggleNoClip(state)
    noClipEnabled = state
    if noClipEnabled then
        noClipConnection = RunService.Stepped:Connect(function()
            if LocalPlayer.Character then
                for _, v in pairs(LocalPlayer.Character:GetDescendants()) do
                    if v:IsA("BasePart") then
                        v.CanCollide = false
                    end
                end
            end
        end)
    else
        if noClipConnection then
            noClipConnection:Disconnect()
            noClipConnection = nil
        end
    end
end

local function toggleRemoveFog(state)
    if state then
        Lighting.FogEnd = 1e9 
        local atmosphere = Lighting:FindFirstChildOfClass("Atmosphere")
        if atmosphere then
            atmosphere:Destroy()
        end
    else
        Lighting.FogEnd = 1000
        Lighting.FogStart = 200
        if not Lighting:FindFirstChildOfClass("Atmosphere") then
            local newAtmosphere = Instance.new("Atmosphere")
            newAtmosphere.Parent = Lighting
        end
    end
end

local function GetRod()
    local Rod = LocalPlayer.Character:FindFirstChild(RodName) or LocalPlayer.Backpack:FindFirstChild(RodName)
    return Rod
end
local function EquipRod()
    local Rod = GetRod()
    if Rod then
        LocalPlayer.Character.Humanoid:EquipTool(Rod)
    else
        warn("Rod tidak ditemukan di Character atau Backpack!")
    end
end
local teleportEnabled = false
local previousPosition = nil
local lastSelectedEvent = nil
local velocity = nil

local function trackMovingEntity(WorldEvent, entityName)
    local entity = WorldEvent:FindFirstChild(entityName)
    if entity then
        game:GetService("RunService").Heartbeat:Connect(function()
            if entity and entity.Parent then
                if velocity then velocity:Destroy() end
                local direction = (entity.Position - HumanoidRootPart.Position).unit
                local moveVelocity = Instance.new("BodyVelocity")
                moveVelocity.Velocity = direction * 50 -- Kecepatan bergerak
                moveVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
                moveVelocity.Parent = HumanoidRootPart
            end
        end)
    end
end

local function teleportToEvent(Values)
    if not Values or #Values == 0 then return end
    local Character = LocalPlayer.Character
    local HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
    local eventPositions = {
        ["Kraken Pool"] = {name = "Kraken Pool", offset = Vector3.new(0, 105, 0)},  
        ["Blue Whale"] = {name = "Blue Whale", offset = Vector3.new(0, 105, 0)},  
        ["Orcas Pool"] = {name = "Orcas Pool", offset = Vector3.new(0, 105, 0)}, 
        ["Strange Whirlpool"] = {name = "Isonade", offset = Vector3.new(25, 115, 25)},
        ["Great Hammerhead Shark"] = {name = "Great Hammerhead Shark", offset = Vector3.new(0, 115, 0)},
        ["Great White Shark"] = {name = "Great White Shark", offset = Vector3.new(0, 115, 0)},
        ["Whale Shark"] = {name = "Whale Shark", offset = Vector3.new(0, 115, 0)},
        ["The Depths - Serpent"] = {name = "The Depths - Serpent", offset = Vector3.new(0, 50, 0)},
        ["Megalodon"] = {name = "Megalodon Default", offset = Vector3.new(0, 50, 0)},
        ["Ancient Algae Pool"] = {name = "Ancient Algae Pool", offset = Vector3.new(0, 115, 0)},
        ["Mushgrove Algae Pool"] = {name = "Mushgrove Algae Pool", offset = Vector3.new(0, 115, 0)},
        ["Forsaken Algae Pool"] = {name = "Forsaken Algae Pool", offset = Vector3.new(0, 50, 0)},
        ["Snowcap Algae Pool"] = {name = "Snowcap Algae Pool", offset = Vector3.new(0, 50, 0)},
    }

    previousPosition = HumanoidRootPart.CFrame
    lastSelectedEvent = Values 

    for _, Value in ipairs(Values) do
        local eventInfo = eventPositions[Value]
        if not eventInfo then 
            ShowNotification("Event not found: " .. Value)
            return
        end

        local WorldEvent = game.Workspace.zones.fishing:FindFirstChild(eventInfo.name)
        if not WorldEvent then 
            ShowNotification("Not found: " .. Value)
            return
        end
        HumanoidRootPart.CFrame = CFrame.new(WorldEvent.Position + eventInfo.offset)
        if teleportEnabled then
            if velocity then velocity:Destroy() end
            velocity = Instance.new("BodyVelocity")
            velocity.Velocity = Vector3.new(0, 0, 0)
            velocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge) 
            velocity.Parent = HumanoidRootPart
        end
        if Value == "Orcas Pool" then
            trackMovingEntity(WorldEvent, "Orca")
        elseif Value == "Blue Whale" then
            trackMovingEntity(WorldEvent, "BlueWhale")
        end
    end
end

-- [[ NEW TELEPORT LOGIC START ]] --
local function FreezeCharacter1(freeze)
    local char = game.Players.LocalPlayer.Character
    if char then
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if hrp then
            hrp.Anchored = freeze
        end
    end
end

local function autoEquipRod()
    local backpack = game.Players.LocalPlayer.Backpack
    for _, tool in ipairs(backpack:GetChildren()) do
        if tool:IsA("Tool") and (tool.Name:find("Rod") or tool.Name:find("Fishing")) then
             game.Players.LocalPlayer.Character.Humanoid:EquipTool(tool)
             break
        end
    end
end

local function getFishingZones()
     local zones = workspace:WaitForChild("zones"):WaitForChild("fishing")
     local positions = {}
     for _, z in pairs(zones:GetChildren()) do
         if z:IsA("BasePart") then
             if not positions[z.Name] then positions[z.Name] = {} end
             table.insert(positions[z.Name], z)
         elseif z:IsA("Model") then    
             for _, p in pairs(z:GetChildren()) do
                 if p:IsA("BasePart") then
                      if not positions[z.Name] then positions[z.Name] = {} end
                      table.insert(positions[z.Name], p)
                 end
             end
         end
     end
     -- Flatten simple list
     local list = {}
     for k,v in pairs(positions) do table.insert(list, k) end
     table.sort(list)
     return list, positions
end

local function teleportToFishingZone(zoneName)
    local Character = LocalPlayer.Character
    if not Character then return end

    local HumanoidRootPart = Character:FindFirstChild('HumanoidRootPart')
    if not HumanoidRootPart then return end

    local zones = Workspace:WaitForChild('zones', 1)
    local FishingZonesFolder = zones and zones:FindFirstChild('fishing', 1)
    if not FishingZonesFolder then return end

    if zoneName == 'None' and previousLocation then
        HumanoidRootPart.CFrame = previousLocation
        FreezeCharacter1(false)
        return
    end

    local _, zonesData = getFishingZones()

    if zoneName == 'Crystal Cove' then
        previousLocation = HumanoidRootPart.CFrame
        local player = game.Players.LocalPlayer
        local boat
        repeat
            boat = workspace:FindFirstChild('active')
                and workspace.active:FindFirstChild('boats')
                and workspace.active.boats:FindFirstChild(player.Name)
                and workspace.active.boats[player.Name]:FindFirstChild(
                    'Rowboat'
                )
            if not boat then
                local Character = LocalPlayer.Character
                local HumanoidRootPart =
                    Character:FindFirstChild('HumanoidRootPart')
                HumanoidRootPart.CFrame = CFrame.new(362, 134, 259)
                task.wait(0.5)
                local args = {
                    {
                        voice = 8,
                        idle = workspace
                            :WaitForChild('world')
                            :WaitForChild('npcs')
                            :WaitForChild('Moosewood Shipwright')
                            :WaitForChild('description')
                            :WaitForChild('idle'),
                        npc = workspace
                            :WaitForChild('world')
                            :WaitForChild('npcs')
                            :WaitForChild('Moosewood Shipwright'),
                    },
                }
                workspace
                    :WaitForChild('world')
                    :WaitForChild('npcs')
                    :WaitForChild('Moosewood Shipwright')
                    :WaitForChild('shipwright')
                    :WaitForChild('giveUI')
                    :InvokeServer(unpack(args))
                task.wait(0.2)
                local args = {
                    'Rowboat',
                }
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RF/Boats/Purchase')
                    :InvokeServer(unpack(args))

                task.wait(0.5)

                local args = {
                    'Rowboat',
                }
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RF/Boats/Spawn')
                    :InvokeServer(unpack(args))
                task.wait(0.3)
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RE/Boats/Close')
                    :FireServer()
                task.wait(0.5)
                autoEquipRod()
                local player = game:GetService('Players').LocalPlayer
                local gui = player
                    :WaitForChild('PlayerGui')
                    :WaitForChild('hud')
                    :WaitForChild('safezone')
                    :WaitForChild('shipwright')

                gui.Visible = false
            end
        until boat
        for _, descendant in ipairs(boat:GetDescendants()) do
            local name = descendant.Name:lower()
            if name == 'sitprompt' or name == 'body' then
                descendant:Destroy()
            end
        end

        local customPos = Vector3.new(1375.483887, -603.664612, 2340.227783)
        targetCf = CFrame.new(customPos + Vector3.new(0, __var.floatHeight or 0, 0))
        boat:PivotTo(targetCf)
        task.wait(0.5)

        FreezeCharacter1(true)
        return
    end

    local targetParts = zonesData[zoneName]
    if targetParts and #targetParts > 0 then
        local foundValidPos = false
        local finalCFrame = nil
        for i = 1, 10 do
            local randomPart = targetParts[math.random(#targetParts)]
            local size = randomPart.Size
            local cf = randomPart.CFrame
            local randomOffset = Vector3.new(
                math.random() * size.X - size.X / 2,
                0,
                math.random() * size.Z - size.Z / 2
            )
            local testPos = (cf * CFrame.new(randomOffset)).Position
            local rayOrigin = Vector3.new(testPos.X, testPos.Y + 1000, testPos.Z)

            local rayParams = RaycastParams.new()
            rayParams.FilterType = Enum.RaycastFilterType.Exclude
            rayParams.FilterDescendantsInstances = { Character, boat }
            rayParams.IgnoreWater = false

            local rayResult = workspace:Raycast(rayOrigin, Vector3.new(0, -2000, 0), rayParams)
            
            if rayResult then
                if rayResult.Material == Enum.Material.Water then
                    -- Found water!
                    local currentY = rayResult.Position.Y
                    local heightOffset = (zoneName == 'Forsaken Veil') and 80 or (__var.floatHeight or 0)
                    finalCFrame = CFrame.new(testPos.X, currentY + heightOffset, testPos.Z)
                    foundValidPos = true
                    break
                end
            end
        end

        if not foundValidPos then
            local randomPart = targetParts[math.random(#targetParts)]
            local cf = randomPart.CFrame
            local rayParams = RaycastParams.new()
            rayParams.FilterType = Enum.RaycastFilterType.Whitelist
            rayParams.FilterDescendantsInstances = { workspace.Terrain }
            rayParams.IgnoreWater = false
            
            local currentY = cf.Y
            local rayResult = workspace:Raycast(Vector3.new(cf.X, 1000, cf.Z), Vector3.new(0, -2000, 0), rayParams)
            if rayResult and rayResult.Material == Enum.Material.Water then
                currentY = rayResult.Position.Y
            end
             
             local heightOffset = (zoneName == 'Forsaken Veil') and 80 or (__var.floatHeight or 0)
             finalCFrame = CFrame.new(cf.X, currentY + heightOffset, cf.Z)
        end

        previousLocation = HumanoidRootPart.CFrame

        local player = game.Players.LocalPlayer
        local boat
        repeat
            boat = workspace:FindFirstChild('active')
                and workspace.active:FindFirstChild('boats')
                and workspace.active.boats:FindFirstChild(player.Name)
                and workspace.active.boats[player.Name]:FindFirstChild(
                    'Rowboat'
                )
            if not boat then
                local Character = LocalPlayer.Character
                local HumanoidRootPart =
                    Character:FindFirstChild('HumanoidRootPart')
                HumanoidRootPart.CFrame = CFrame.new(362, 134, 259)
                task.wait(0.5)
                local args = {
                    {
                        voice = 8,
                        idle = workspace
                            :WaitForChild('world')
                            :WaitForChild('npcs')
                            :WaitForChild('Moosewood Shipwright')
                            :WaitForChild('description')
                            :WaitForChild('idle'),
                        npc = workspace
                            :WaitForChild('world')
                            :WaitForChild('npcs')
                            :WaitForChild('Moosewood Shipwright'),
                    },
                }
                workspace
                    :WaitForChild('world')
                    :WaitForChild('npcs')
                    :WaitForChild('Moosewood Shipwright')
                    :WaitForChild('shipwright')
                    :WaitForChild('giveUI')
                    :InvokeServer(unpack(args))
                task.wait(0.2)
                local args = {
                    'Rowboat',
                }
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RF/Boats/Purchase')
                    :InvokeServer(unpack(args))

                task.wait(0.5)

                local args = {
                    'Rowboat',
                }
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RF/Boats/Spawn')
                    :InvokeServer(unpack(args))
                task.wait(0.3)
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RE/Boats/Close')
                    :FireServer()
                task.wait(0.5)
                autoEquipRod()
                local player = game:GetService('Players').LocalPlayer
                local gui = player
                    :WaitForChild('PlayerGui')
                    :WaitForChild('hud')
                    :WaitForChild('safezone')
                    :WaitForChild('shipwright')

                gui.Visible = false
            end
        until boat
        for _, descendant in ipairs(boat:GetDescendants()) do
            local name = descendant.Name:lower()
            if name == 'sitprompt' or name == 'body' then
                descendant:Destroy()
            end
        end
        
        local checkParams = RaycastParams.new()
        checkParams.FilterType = Enum.RaycastFilterType.Whitelist
        checkParams.FilterDescendantsInstances = { workspace.Terrain }
        checkParams.IgnoreWater = false

        local bestY = -10000
        for i=1,3 do
            local finalPos = finalCFrame.Position
            local waterCheck = workspace:Raycast(Vector3.new(finalPos.X, 500, finalPos.Z), Vector3.new(0, -1000, 0), checkParams)
            if waterCheck and waterCheck.Material == Enum.Material.Water then
                if waterCheck.Position.Y > bestY then
                    bestY = waterCheck.Position.Y
                end
            end
            task.wait(0.1)
        end

        if bestY > -5000 then
            finalCFrame = CFrame.new(finalCFrame.X, bestY + 3.5, finalCFrame.Z) 
        end
        
        boat:PivotTo(finalCFrame)
        task.wait(0.5)
        
        local confirmCheck = workspace:Raycast(Vector3.new(finalCFrame.X, 500, finalCFrame.Z), Vector3.new(0, -1000, 0), checkParams)
        if confirmCheck and confirmCheck.Material == Enum.Material.Water then
             finalCFrame = CFrame.new(finalCFrame.X, confirmCheck.Position.Y + 3.5, finalCFrame.Z)
        end
        
        task.spawn(function()
             for _=1,20 do 
                local currentPos = boat.PrimaryPart.Position
                local check = workspace:Raycast(Vector3.new(currentPos.X, 500, currentPos.Z), Vector3.new(0, -1000, 0), checkParams)
                
                if check and check.Material == Enum.Material.Water then
                     local waterLevel = check.Position.Y
                     if currentPos.Y < waterLevel then
                         finalCFrame = CFrame.new(currentPos.X, waterLevel + 3.5, currentPos.Z)
                         boat:PivotTo(finalCFrame)
                     elseif (currentPos.Y - waterLevel) > 5 then
                         finalCFrame = CFrame.new(currentPos.X, waterLevel + 3.5, currentPos.Z)
                         boat:PivotTo(finalCFrame)
                     end
                end
                task.wait(0.2)
             end
        end)
        

        
        boat:PivotTo(finalCFrame)
        task.wait(0.25)
        boat:PivotTo(finalCFrame) 
        task.wait(0.25)
        
        if zoneName == "Terrapin Island" then
            pcall(function()
                local map = workspace.world.map
                if map and map:FindFirstChild("Terrapin Island") then
                     local children = map["Terrapin Island"]:GetChildren()
                     if children[138] then
                        children[138]:Destroy()
                     end
                end
            end)
        end
        
        local Character = LocalPlayer.Character
        if Character then
            task.wait(0.3) -- Wait for teleport to settle
            local backpack = LocalPlayer.Backpack
            local rod = nil
            for _, tool in pairs(backpack:GetChildren()) do
                if tool:IsA("Tool") and (tool.Name:find("Rod") or tool.Name:find("Fishing")) then
                    rod = tool
                    break
                end
            end
            
            if rod then
                 Character.Humanoid:EquipTool(rod)
            end
        end

        FreezeCharacter1(true)
    else
        warn('[ERROR] Zona memancing tidak ditemukan!')
    end
end

-- Simple Teleport (No Boat, No Freeze)
local function TeleportFishingZoneNoFrezeandNoBoat(zoneName)
    local Character = LocalPlayer.Character
    if not Character then return end

    local HumanoidRootPart = Character:FindFirstChild('HumanoidRootPart')
    if not HumanoidRootPart then return end

    local _, zonesData = getFishingZones()
    local targetParts = zonesData[zoneName]

    if targetParts and #targetParts > 0 then
        local foundValidPos = false
        local finalCFrame = nil
        
        -- Attempt to find a valid water position
        for i = 1, 10 do
            local randomPart = targetParts[math.random(#targetParts)]
            local size = randomPart.Size
            local cf = randomPart.CFrame
            local randomOffset = Vector3.new(
                math.random() * size.X - size.X / 2,
                0,
                math.random() * size.Z - size.Z / 2
            )
            local testPos = (cf * CFrame.new(randomOffset)).Position
            local rayOrigin = Vector3.new(testPos.X, testPos.Y + 1000, testPos.Z)

            local rayParams = RaycastParams.new()
            rayParams.FilterType = Enum.RaycastFilterType.Exclude
            rayParams.FilterDescendantsInstances = { Character }
            rayParams.IgnoreWater = false

            local rayResult = workspace:Raycast(rayOrigin, Vector3.new(0, -2000, 0), rayParams)
            
            if rayResult and rayResult.Material == Enum.Material.Water then
                local currentY = rayResult.Position.Y
                local heightOffset = 10 -- Offset above water
                finalCFrame = CFrame.new(testPos.X, currentY + heightOffset, testPos.Z)
                foundValidPos = true
                break
            end
        end

        if not foundValidPos then
             -- Fallback to part center + offset
            local randomPart = targetParts[math.random(#targetParts)]
            finalCFrame = randomPart.CFrame + Vector3.new(0, 10, 0)
        end
        
        if finalCFrame then
            HumanoidRootPart.CFrame = finalCFrame
        end
    else
        warn("Zone not found for simple teleport: " .. tostring(zoneName))
    end
end
-- [[ NEW TELEPORT LOGIC END ]] --
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local function unequipRod()
    local char = game.Players.LocalPlayer.Character
    if not char then return end
    
    for _, tool in ipairs(char:GetChildren()) do
        if tool:IsA("Tool") and tool:FindFirstChild("events") then
            tool.Parent = game.Players.LocalPlayer.Backpack
            return true
        end
    end
    return false
end
local function equipRod()
    local backpack = game.Players.LocalPlayer.Backpack
    
    for _, tool in ipairs(backpack:GetChildren()) do
        if tool:IsA("Tool") and tool:FindFirstChild("events") then
            tool.Parent = game.Players.LocalPlayer.Character
            print("✅ Rod equipped:", tool.Name)
            return true
        end
    end
    
    print("❌ No rod in backpack!")
    return false
end
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local head = workspace:WaitForChild(LocalPlayer.Name):WaitForChild("Head")
local NetFolder = ReplicatedStorage:FindFirstChild("packages") and ReplicatedStorage.packages:FindFirstChild("Net")
local EventsFolder = ReplicatedStorage:FindFirstChild("events")
if NetFolder and EventsFolder then
    local RequestCutsceneSync = NetFolder:FindFirstChild("RE/RequestCutsceneSync")
    local RequestCutscene = NetFolder:FindFirstChild("RE/RequestCutscene")
    local RequestCutNotif = EventsFolder:FindFirstChild("seraphiclaser")

    -- if RequestCutsceneSync then
    --     RequestCutsceneSync:Destroy()
    --     print("Deleted RequestCutsceneSync")
    -- end

    if RequestCutscene then
        RequestCutscene:Destroy()
        print("Deleted RequestCutscene")
    end

    -- if RequestCutNotif then
    --     RequestCutNotif:Destroy()
    --     print("Deleted RequestCutNotif")
    -- end
else
    warn("Net folder not found in ReplicatedStorage")
end
local activeFolder = game.Workspace:FindFirstChild("active")
local exceptions = {
    "Leaderboards",
    "WaterDetailModels",
    "boats",
    "bosses",
    "constant",
    "crabcages",
    "debrisfx",
    "meteorItems",
    "watertraps",
    "OceanPOI's"
}

local function isException(folderName)
    for _, exception in ipairs(exceptions) do
        if folderName == exception then
            return true
        end
    end
    return false
end
local caughtFish = {} 
local currentNotification = nil
local notificationTask = nil

local function createFishNotification(fishName, mutation)
    local playerGui = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    local screenGui = playerGui:FindFirstChild("FishNotificationUI")
    if not screenGui then
        screenGui = Instance.new("ScreenGui")
        screenGui.Name = "FishNotificationUI"
        screenGui.Parent = playerGui
        screenGui.ResetOnSpawn = false
    end

    -- Handle existing notification (Overlap logic)
    if currentNotification and currentNotification.Parent then
        -- If same fish, just pop the animation and reset timer (Duration logic)
        local display = currentNotification:GetAttribute("DisplayID")
        local newID = fishName .. mutation
        
        if display == newID then
            -- Cancel previous destroy task
            if notificationTask then task.cancel(notificationTask) end
            
            -- Pop animation to show "refresh"
            local s = currentNotification.Size
            game:GetService("TweenService"):Create(currentNotification, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out, 0, true), {
                Size = UDim2.new(s.X.Scale, s.X.Offset + 10, s.Y.Scale, s.Y.Offset + 2)
            }):Play()

            -- Reset timer
            notificationTask = task.delay(3, function()
                if currentNotification and currentNotification.Parent then
                    local tw = game:GetService("TweenService"):Create(currentNotification, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {
                        Position = UDim2.new(0, -250, 0.5, -21),
                        BackgroundTransparency = 1
                    })
                    tw:Play()
                    tw.Completed:Wait()
                    if currentNotification then currentNotification:Destroy() end
                    currentNotification = nil
                end
            end)
            return
        else
            currentNotification:Destroy()
            if notificationTask then task.cancel(notificationTask) end
        end
    end

    -- Create New Frame
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 190, 0, 50) -- Slightly taller for "Window" look
    frame.Position = UDim2.new(0, -250, 0.5, -25) 
    frame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    frame.BackgroundTransparency = 0.1
    frame.BorderSizePixel = 0
    frame.Parent = screenGui
    frame:SetAttribute("DisplayID", fishName .. mutation)

    currentNotification = frame

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = frame

    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 1.2
    stroke.Color = Color3.fromRGB(80, 80, 80)
    stroke.Transparency = 0.6
    stroke.Parent = frame

    -- Traffic Lights (Red, Yellow, Green)
    local function createDot(color, position)
        local dot = Instance.new("Frame")
        dot.Size = UDim2.new(0, 8, 0, 8)
        dot.Position = position
        dot.BackgroundColor3 = color
        dot.BorderSizePixel = 0
        dot.Parent = frame
        local c = Instance.new("UICorner")
        c.CornerRadius = UDim.new(1, 0)
        c.Parent = dot
    end

    createDot(Color3.fromRGB(255, 95, 87), UDim2.new(0, 8, 0, 6))   -- Red
    createDot(Color3.fromRGB(255, 189, 46), UDim2.new(0, 20, 0, 6)) -- Yellow
    createDot(Color3.fromRGB(40, 201, 64), UDim2.new(0, 32, 0, 6))  -- Green

    local icon = Instance.new("ImageLabel")
    icon.Size = UDim2.new(0, 28, 0, 28)
    icon.Position = UDim2.new(0, 10, 0.5, -4) -- Pushed down slightly below dots area
    icon.BackgroundTransparency = 1
    icon.Image = "rbxassetid://18820698114"
    icon.Parent = frame

    local title = Instance.new("TextLabel")
    title.Text = "Name: " .. fishName
    title.Size = UDim2.new(1, -50, 0, 14)
    title.Position = UDim2.new(0, 46, 0, 14)
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.GothamBold
    title.TextColor3 = Color3.fromRGB(240, 240, 240)
    title.TextSize = 10
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.TextTruncate = Enum.TextTruncate.AtEnd
    title.Parent = frame

    local subtitle = Instance.new("TextLabel")
    subtitle.Text = "Mutation: " .. (mutation ~= "None" and mutation or "-")
    subtitle.Size = UDim2.new(1, -50, 0, 12)
    subtitle.Position = UDim2.new(0, 46, 0, 30)
    subtitle.BackgroundTransparency = 1
    subtitle.Font = Enum.Font.GothamMedium
    subtitle.TextColor3 = mutation ~= "None" and Color3.fromRGB(130, 255, 150) or Color3.fromRGB(180, 180, 180)
    subtitle.TextSize = 9
    subtitle.TextXAlignment = Enum.TextXAlignment.Left
    subtitle.Parent = frame

    -- Animation In
    game:GetService("TweenService"):Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
        Position = UDim2.new(0, 20, 0.5, -25)
    }):Play()

    -- Auto Close Task
    notificationTask = task.delay(3, function()
        if currentNotification == frame then
            local tw = game:GetService("TweenService"):Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {
                Position = UDim2.new(0, -250, 0.5, -25),
                BackgroundTransparency = 1
            })
            tw:Play()
            tw.Completed:Wait()
            if currentNotification == frame then
                frame:Destroy()
                currentNotification = nil
            end
        end
    end)
end
local currentUiMutation = "None"

task.spawn(function()
    local Player = game:GetService("Players").LocalPlayer
    local PlayerGui = Player:WaitForChild("PlayerGui", 9e9)
    
    local function bindReel(reelGui)
        local function handleFish(descendant)
            task.wait()
            if descendant:GetAttribute("Shiny") then
                currentUiMutation = "Shiny"
                print("Shiny")
            elseif descendant:GetAttribute("Sparkling") then
                currentUiMutation = "Sparkling"
                print("Sparkling")
            else
                currentUiMutation = "None"
                print("None")
            end

            if __var.AutoSnapEnabled then
                local fishName = descendant:IsA("TextLabel") and descendant.Text or (descendant:IsA("StringValue") and descendant.Value)
                if fishName then
                    print(fishName)
                    local targetNames = {}
                    local targetMutations = {}
                    
                    if __var.SnapTarget and __var.SnapTarget ~= "" then
                        for t in string.gmatch(__var.SnapTarget, "([^,]+)") do
                            print(__var.SnapTarget)
                            table.insert(targetNames, t:match("^%s*(.-)%s*$"):lower())
                        end
                    end

                    if __var.SnapMutationPresets then
                        for k, v in pairs(__var.SnapMutationPresets) do
                            if type(k) == "string" and v == true then
                                table.insert(targetMutations, k:lower())
                            elseif type(v) == "string" then
                                    table.insert(targetMutations, v:lower())
                            end
                        end
                    end
                    
                    local nameMatch = (#targetNames == 0)
                    local mutationMatch = (#targetMutations == 0)
                    
                    local fName = fishName:lower()
                    local fMut = currentUiMutation:lower()
                    
                    if not nameMatch then
                            for _, t in ipairs(targetNames) do
                                if fName:find(t, 1, true) then nameMatch = true break end
                            end
                    end
                    if not mutationMatch then
                            for _, t in ipairs(targetMutations) do
                                if t == "any" and fMut ~= "none" then
                                    mutationMatch = true
                                    break
                                elseif fMut:find(t, 1, true) then 
                                    mutationMatch = true 
                                    break 
                                end
                            end
                    end
                    
                    if not (nameMatch and mutationMatch) then
                        unequipRod()
                        equipRod()
                    end
                end
            end
        end

        local function onInnerReelAdded(innerReel)
            if innerReel:FindFirstChild("fish") then
                handleFish(innerReel.fish)
            end
            innerReel.ChildAdded:Connect(function(child)
                if child.Name == "fish" then
                    handleFish(child)
                end
            end)
        end

        local function onBarAdded(bar)
            if bar:FindFirstChild("reel") then
                onInnerReelAdded(bar.reel)
            end
            bar.ChildAdded:Connect(function(child)
                if child.Name == "reel" then
                    onInnerReelAdded(child)
                end
            end)
        end

        if reelGui:FindFirstChild("bar") then
            onBarAdded(reelGui.bar)
        end
        reelGui.ChildAdded:Connect(function(child)
            if child.Name == "bar" then
                onBarAdded(child)
            end
        end)
    end

    if PlayerGui:FindFirstChild("reel") then
        bindReel(PlayerGui.reel)
    end
    
    PlayerGui.ChildAdded:Connect(function(child)
        if child.Name == "reel" then
            bindReel(child)
        end
    end)
end)

RunService.Heartbeat:Connect(function()
    if activeFolder then
        for _, item in ipairs(activeFolder:GetChildren()) do
            if not isException(item.Name) then
                local ownerId = item:GetAttribute("OwnerId")
                if ownerId == game.Players.LocalPlayer.UserId then
                if bugrod then
                    if finishCount < 300 then
                            finishCount = finishCount + 1
                            print(finishCount)
                            item:Destroy()
                            unequipRod()
                            equipRod()
                        else
                            print('Limit Reached - Resetting')
                            item:Destroy()
                            task.wait(4)
                            finishCount = 0

                        end
                else
                local mutation = "None"
                    for _, child in ipairs(item:GetDescendants()) do
                        if child.Name:lower():match("template") then
                                -- Jika namanya 'astraeustemplate', set jadi "Astraeus"
                            if child.Name == "astraeustemplate" then
                                mutation = "Astraeus"
                            else
                                    -- Format nama lain, misal 'bigtemplate' -> 'Big'
                                local pName = child.Name:gsub("template", "")
                                mutation = pName:gsub("^%l", string.upper)
                            end
                            break
                        end
                    end
                    
                    local isRainbow = false
                    if item:GetAttribute("PulseColor1") then
                        isRainbow = true
                    else
                        -- Check deeply (covers active.Mackerel.Fish children, e.g. index 9)
                        for _, desc in ipairs(item:GetDescendants()) do
                            if desc:GetAttribute("PulseColor1") then
                                isRainbow = true
                                break
                            end
                        end
                    end

                    if isRainbow and mutation == "None" then
                        local colorCount = 0
                        local hasPulse = false
                        for i = 1, 10 do
                            if item:GetAttribute("PulseColor" .. i) or (item:FindFirstChild("Body") and item.Body:GetAttribute("PulseColor"..i)) then
                                colorCount = colorCount + 1
                                hasPulse = true
                            end
                        end
                        
                        -- Cek descendants juga
                        if colorCount == 0 then
                             for _, desc in ipairs(item:GetDescendants()) do
                                if desc:IsA("BasePart") then
                                     for i = 1, 10 do
                                        if desc:GetAttribute("PulseColor" .. i) then
                                            colorCount = colorCount + 1
                                        end
                                    end
                                end
                             end
                        end

                        if colorCount >= 8 then
                            mutation = "Rainbow Cluster"
                        else
                            mutation = "Rainbow"
                        end
                    end
                    
                    if mutation == "None" then
                        -- Check for King's Blessing (Crown)
                        local hasCrown = false
                        if item:FindFirstChild("Crown") then
                            hasCrown = true
                        else
                            for _, desc in ipairs(item:GetDescendants()) do
                                if desc.Name == "Crown" then
                                    hasCrown = true
                                    break
                                end
                            end
                        end
                        
                        if hasCrown then
                            mutation = "King's Blessing"
                        end
                    end
                    -- Auto Snap (Filter)
                    if __var.AutoSnapEnabled then
                        local targetNames = {}
                        local targetMutations = {}
                        
                        if __var.SnapTarget and __var.SnapTarget ~= "" then
                            for t in string.gmatch(__var.SnapTarget, "([^,]+)") do
                                local cleanName = t:match("^%s*(.-)%s*$"):lower()
                                local hasPresets = false
                                if __var.SnapMutationPresets then
                                    for k, v in pairs(__var.SnapMutationPresets) do
                                        local pVal = (type(k) == "string" and v == true and k) or (type(v) == "string" and v)
                                        if pVal then
                                            hasPresets = true
                                            if pVal:lower() == "none" then
                                                table.insert(targetNames, cleanName)
                                            else
                                                table.insert(targetNames, pVal:lower())
                                            end
                                        end
                                    end
                                end
                                if not hasPresets then
                                    table.insert(targetNames, cleanName)
                                end
                            end
                        end
                        if __var.SnapMutation and __var.SnapMutation ~= "" then
                            for t in string.gmatch(__var.SnapMutation, "([^,]+)") do
                                table.insert(targetMutations, t:match("^%s*(.-)%s*$"):lower())
                            end
                        end
                        
                        local nameMatch = (#targetNames == 0)
                        local mutationMatch = (#targetMutations == 0)
                        
                        local fName = item.Name:lower()
                        local fMut = mutation:lower()

                        if not nameMatch then
                            for _, t in ipairs(targetNames) do
                                if fName:find(t, 1, true) then
                                    nameMatch = true
                                    break
                                end
                            end
                        end

                        if not mutationMatch then
                             for _, t in ipairs(targetMutations) do
                                if fMut:find(t, 1, true) then
                                    mutationMatch = true
                                    break
                                end
                            end
                        end
                        
                        if not (nameMatch and mutationMatch) then
                             item:Destroy()
                             unequipRod()
                             equipRod()
                             return 
                        end
                    end
                    table.insert(caughtFish, {
                        Name = item.Name,
                        Mutation = mutation,
                        Timestamp = os.time()
                    })
                    task.wait(0.2)
                    createFishNotification(item.Name, mutation)
                    
                end
                item:Destroy()
            end
            end
        end
    else
    end
end)

for _, d in pairs(head:GetDescendants()) do
    onSound(d)
end

head.DescendantAdded:Connect(onSound)


local function bugfishing()
    while _G.Config.isFishing and task.wait(DelayFasterReel) do
		local reel
		local startTime = tick()
		while not reel and tick() - startTime < 10 do
			reel = PlayerGui and PlayerGui:FindFirstChild("reel")
			task.wait(0.2) 
		end
		if reel then
			LocalPlayer.Character.Humanoid:UnequipTools()
			task.wait()
			reel:Destroy()
		else
			LocalPlayer.Character.Humanoid:UnequipTools()
			task.wait()
		end
	end
end


task.spawn(function()
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui", 9e9)
    if not PlayerGui then return end

    local function removeEffects(child)
        if child.Name == "SpecialContainer" then
            child:Destroy()
        -- Juga cek "over" gui untuk efek flash layar penuh
        elseif child.Name == "over" then 
             child.ChildAdded:Connect(function(sub)
                  -- Warna kuning shiny flash
                  if sub:IsA("Frame") and (sub.BackgroundColor3 == Color3.fromRGB(255, 225, 134) or sub.BackgroundColor3 == Color3.fromRGB(255, 184, 126)) then
                        sub:Destroy()
                  end
             end)
             for _, sub in ipairs(child:GetChildren()) do
                  if sub:IsA("Frame") and (sub.BackgroundColor3 == Color3.fromRGB(255, 225, 134) or sub.BackgroundColor3 == Color3.fromRGB(255, 184, 126)) then
                        sub:Destroy()
                  end
             end
        end
    end

    PlayerGui.ChildAdded:Connect(removeEffects)
    for _, child in ipairs(PlayerGui:GetChildren()) do
        removeEffects(child)
    end
end)

local function breakVelocity()
    local BeenASecond, V3 = false, Vector3.new(0, 0, 0)

    task.delay(1, function()
        BeenASecond = true
    end)

    while not BeenASecond do
        if speaker.Character then
            for _, v in ipairs(speaker.Character:GetDescendants()) do
                if v:IsA("BasePart") then
                    pcall(function()
                        v.Velocity = V3
                        v.RotVelocity = V3
                    end)
                end
            end
        end
        RunService.Heartbeat:Wait() 
    end
end
local function teleportToPlayer(playerName)
    local root = getRoot(speaker.Character)
    local targetPlayer = Players:FindFirstChild(playerName)

    if root and targetPlayer and targetPlayer.Character then
        local targetRoot = getRoot(targetPlayer.Character)
        if targetRoot then
            root.CFrame = targetRoot.CFrame + Vector3.new(3, 1, 0)
        end
    end
    breakVelocity()
end
-- Buy Item

-- require module items
local itemsModule = require(
    game:GetService("ReplicatedStorage")
        .shared.modules.library.items
)
local event = game:GetService("ReplicatedStorage").events.purchase

-- pastikan struktur benar
if not itemsModule or not itemsModule.Items then
    warn("Items module tidak valid")
    return
end

-- ambil nama item (KEY dari table Items)
local itemNames = {}

for itemName, _ in pairs(itemsModule.Items) do
    table.insert(itemNames, itemName)
end

-- optional: urutkan alfabet
table.sort(itemNames)

-- print hasil
for i, name in ipairs(itemNames) do
    print(i .. ".", name)
end
-- Require rods module
local rodsModule = require(
    game:GetService("ReplicatedStorage")
        .shared.modules.library.rods
)

-- Tentukan table rods (kadang ada di .Rods, kadang langsung di root)
local rodsTable = rodsModule.Rods or rodsModule

-- Validasi
if typeof(rodsTable) ~= "table" then
    warn("Rods module tidak valid atau struktur tidak dikenali")
    return
end

-- Ambil nama rod (KEY)
local rodNames = {}

for rodName in pairs(rodsTable) do
    table.insert(rodNames, rodName)
end

-- Optional: urutkan alfabet
table.sort(rodNames)

-- Print hasil
for i, name in ipairs(rodNames) do
    print(i .. ".", name)
end
-- Ambil daftar pemain
local function getPlayerNames()
    local names = {"None"}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= speaker then
            table.insert(names, player.Name)
        end
    end
    return names
end
-- BOOST FPS
local function BoostFpsFunc(state)
    if state then
        if Terrain then
            Terrain.WaterWaveSize = 0
            Terrain.WaterWaveSpeed = 0
            Terrain.WaterReflectance = 0
            Terrain.WaterTransparency = 0
        end
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 9e9
        pcall(function() settings().Rendering.QualityLevel = Enum.QualityLevel.Level01 end)

        -- Optimasi Part dan Efek
        for _, v in pairs(game:GetDescendants()) do
            if v:IsA("BasePart") then
                pcall(function()
                    v.Material = Enum.Material.Plastic
                    v.Reflectance = 0
                end)
            elseif v:IsA("Decal") then
                pcall(function() v.Transparency = 1 end)
            elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
                pcall(function() v.Lifetime = NumberRange.new(0) end)
            elseif v:IsA("Explosion") then
                pcall(function()
                    v.BlastPressure = 1
                    v.BlastRadius = 1
                end)
            end
        end

        -- Menonaktifkan efek pencahayaan
        for _, v in pairs(Lighting:GetDescendants()) do
            if v:IsA("BlurEffect") or v:IsA("SunRaysEffect") or v:IsA("ColorCorrectionEffect") 
            or v:IsA("BloomEffect") or v:IsA("DepthOfFieldEffect") then
                pcall(function() v.Enabled = false end)
            end
        end

        -- Hapus efek yang muncul setelahnya
        workspace.DescendantAdded:Connect(function(child)
            task.spawn(function()
                if child:IsA("ForceField") or child:IsA("Sparkles") 
                or child:IsA("Smoke") or child:IsA("Fire") then
                    RunService.Heartbeat:Wait()
                    pcall(function() child:Destroy() end)
                end
            end)
        end)

    else
        -- Jika FPS Boost dimatikan, reset beberapa efek dasar
        if Terrain then
            Terrain.WaterWaveSize = 1
            Terrain.WaterWaveSpeed = 1
            Terrain.WaterReflectance = 0.5
            Terrain.WaterTransparency = 0.3
        end

        Lighting.GlobalShadows = true
        Lighting.FogEnd = 100000
        pcall(function() settings().Rendering.QualityLevel = Enum.QualityLevel.Automatic end)
    end
end
-- Auto Sell Function
local autoSellRunning = false 
local function AutoSell()
    if autoSellRunning then return end  
    autoSellRunning = true

    task.spawn(function()
        while _G.Config.AutoSell do  
            ReplicatedStorage.events.SellAll:InvokeServer()
            task.wait(3)  
        end
        autoSellRunning = false 
    end)
end

-- Helper functions for UI
local function Toggle(section, name, desc, settingName, func)
    local toggle = section:AddToggle({
        Title = name,
        Content = desc,
        Default = _G.Config[settingName] or false
    })
    
    toggle:OnChanged(function(value)
        _G.Config[settingName] = value
        if func then
            func(value)
        end
    end)
    
    return toggle
end

local function TextBox(section, name, tooltip, placeholder, numberOnly, settingName)
    local box = section:AddInput({
        Title = name,
        Default = _G.Config[settingName] or "",
        Placeholder = placeholder,
        Numeric = numberOnly,
        Finished = true,
        Tooltip = tooltip
    })
    
    box:OnChanged(function(value)
        if numberOnly then
            _G.Config[settingName] = tonumber(value)
        else
            _G.Config[settingName] = value
        end
    end)
    
    return box
end
local function Button(section, name, callback)
    local button = section:AddButton({
        Title = name,
        Callback = function()
            callback()
        end
    })
    
    return button
end

local function Slider(section, name, min, max, roundValues, settingName)
    local slider = section:AddSlider({
        Title = name,
        Min = min,
        Max = max,
        Default = _G.Config[settingName] or min,
        Callback = function(value)
            _G.Config[settingName] = value
        end
    })
    
    return slider
end

local function Dropdown(section, Name, default, list, multi, ...)
    local SettingName, func = ...
    if not func and type(SettingName) == "function" then func = SettingName end
    SettingName = SettingName or Name

    if multi then
        default = (default or _G.Config[SettingName]) or {}
        if type(_G.Config[SettingName]) == "string" then
            _G.Config[SettingName] = {_G.Config[SettingName]}
        end
    else
        default = (default or _G.Config[SettingName]) or ""
    end

    local CreateDropdown = section:AddDropdown({
        Title = Name or "Null",
        Options = list or {"None"},
        Multi = multi or false,
        Default = default,
        Callback = function(v)
            if multi and type(v) == 'table' then
                _G.Config[SettingName] = {}
                for _, selectedValue in pairs(v) do
                    table.insert(_G.Config[SettingName], selectedValue)
                end
            else
                _G.Config[SettingName] = v
            end

            if func then
                func(v)
            end
        end
    })

    return CreateDropdown
end

local function setupGUI()
    local Window = Fluent:CreateWindow({
        Title = "ShieldTeam || Premium || Executor : "..executorName,
        ["Tab Width"] = 140,
        SizeUi = UDim2.fromOffset(550, 315)
    })
    local Info = Window:CreateTab({ Name = "Info", Icon = "🎣" })
    local Exclusive = Window:CreateTab({ Name = "Exclusive", Icon = "낚시" })
    local FishingTab = Window:CreateTab({ Name = "Fishing", Icon = "🎣" })
    local ShopTab = Window:CreateTab({ Name = "Shop", Icon = "⚙️" })
    local AutosTab = Window:CreateTab({ Name = "Autos", Icon = "⚙️" })
    local AreaTab = Window:CreateTab({ Name = "Area/TP", Icon = "⚙️" })
    local EspTab = Window:CreateTab({ Name = "ESP", Icon = "👁️" })
    local Misc = Window:CreateTab({ Name = "Misc", Icon = "⚙️" })
    local SettingsTab = Window:CreateTab({ Name = "Setting", Icon = "⚙️" })

    local Infr = Info:AddSection('Info Event', true)

    local MainSection = FishingTab:AddSection("Fishing", true)
    local ExclusiveSection = Exclusive:AddSection("Exclusive", true)

    -- [[ AUTO CLAIM ITEM LOGIC START ]] --
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local autoClaimMulti = false
    local targetItems = {"Lunar Thread", "Starfall Totem", "Cosmic Relic"}
    local function findAndClaimItems()
        local char = player.Character
        local hrp = char and char:FindFirstChild("HumanoidRootPart")
        if not hrp then return false end
        
        local oldCFrame = hrp.CFrame
        local itemsClaimed = false
        local function searchForItems(parent, depth)
            if depth > 10 then return false end
            
            for _, child in ipairs(parent:GetChildren()) do
                if not autoClaimMulti then return false end
                for _, itemName in ipairs(targetItems) do
                    if child.Name == itemName then
                        local prompt = nil
                        local targetPosition = nil
                        local center = child:FindFirstChild("Center")
                        if center then
                            for _, centerChild in ipairs(center:GetChildren()) do
                                if centerChild:IsA("ProximityPrompt") and centerChild.Enabled then
                                    prompt = centerChild
                                    break
                                end
                            end
                        end
                        if not prompt then
                            for _, itemChild in ipairs(child:GetChildren()) do
                                if itemChild:IsA("ProximityPrompt") and itemChild.Enabled then
                                    prompt = itemChild
                                    break
                                end
                            end
                        end
                        if child:IsA("BasePart") then
                            targetPosition = child.CFrame
                        elseif child:IsA("Model") and child.PrimaryPart then
                            targetPosition = child.PrimaryPart.CFrame
                        elseif child:IsA("Model") then
                            for _, modelChild in ipairs(child:GetChildren()) do
                                if modelChild:IsA("BasePart") then
                                    targetPosition = modelChild.CFrame
                                    break
                                end
                            end
                        end
                        if prompt and targetPosition then
                            print("Teleporting to claim " .. itemName .. "...")
                            hrp.CFrame = targetPosition + Vector3.new(0, 3, 0)
                            task.wait(0.5)
                            local claimAttempts = 0
                            while autoClaimMulti and prompt and prompt.Parent and prompt.Enabled and claimAttempts < 10 do
                                pcall(function()
                                    fireproximityprompt(prompt)
                                end)
                                task.wait(0.2)
                                claimAttempts = claimAttempts + 1
                            end
                            
                            if not prompt.Enabled then
                                print("Successfully claimed " .. itemName .. "!")
                                itemsClaimed = true
                            end
                            
                            task.wait(0.5)
                        end
                    end
                end
                if child:IsA("Folder") or child:IsA("Model") or child.Name == "StarCrater" or child.Name == "Root" then
                    if searchForItems(child, depth + 1) then
                        itemsClaimed = true
                    end
                end
            end
            
            return itemsClaimed
        end
        searchForItems(workspace, 0)
        if autoClaimMulti and hrp then
            hrp.CFrame = oldCFrame
            print("Returned to original position")
        end
        
        return itemsClaimed
    end

    ExclusiveSection:AddToggle({
        Title = "Auto Claim Items",
        Default = _G.Config.AutoClaimItems or false,
        Callback = function(Value)
            _G.Config.AutoClaimItems = Value
            autoClaimMulti = Value
            if Value then
                task.spawn(function()
                    while autoClaimMulti do
                        findAndClaimItems()
                        task.wait(2)
                    end
                end)
            end
        end
    })
    
    if _G.Config.AutoClaimItems then
        autoClaimMulti = true
        task.spawn(function()
            while autoClaimMulti do
                findAndClaimItems()
                task.wait(2)
            end
        end)
    end
    -- [[ AUTO CLAIM ITEM LOGIC END ]] --

    -- [[ AUTO HOP LOGIC START ]] --
    local API_URL_HOP = "https://api.thanhub.xyz/api/key/weebhooks"
    local TeleportService = game:GetService("TeleportService")
    local HttpService = game:GetService("HttpService")
    local request = (syn and syn.request) or (http and http.request) or request
    
    local autoHopEnabled = false
    local targetHopEvents = {}
    local isHopping = false

    local function parseHopData(apiResponse)
        local parsed = {}
        local success, err = pcall(function()
            if not apiResponse or type(apiResponse) ~= "table" then return end
            if not apiResponse.rows or type(apiResponse.rows) ~= "table" then return end
            
            for idx = 1, math.min(#apiResponse.rows, 50) do
                local row = apiResponse.rows[idx]
                if not row or not row.payload or not row.payload.embeds then continue end
                
                local embeds = row.payload.embeds
                if type(embeds) ~= "table" or #embeds == 0 then continue end
                local embed = embeds[1]
                if not embed then continue end
                
                local serverData = { event = "No Events", jobId = nil, placeId = game.PlaceId, playerCount = 0, maxPlayers = 20 }
                
                if embed.description then
                    local desc = tostring(embed.description)
                    local jobMatch = desc:match("`([a-f0-9%-]+)`")
                    if jobMatch and #jobMatch >= 36 then
                        serverData.jobId = jobMatch
                    end
                end
                
                if serverData.jobId then
                    local fields = embed.fields or {}
                    for _, field in ipairs(fields) do
                        if field and field.name then
                            local name = tostring(field.name)
                            local value = tostring(field.value)

                            if name:find("Active Events") then
                                local zones = value
                                zones = zones:match("```(.-)```") or zones
                                zones = zones:gsub("^[,%s]+", ""):gsub("%s+$", "")
                                if zones:find("No active") or zones:find("❌") or zones == "" then
                                    serverData.event = "No Events"
                                else
                                    serverData.event = zones
                                end
                            elseif name:find("Players") then
                                local pMatch = value:match("(%d+)%s*/%s*(%d+)")
                                if pMatch then
                                    local current, max = value:match("(%d+)%s*/%s*(%d+)")
                                    serverData.playerCount = tonumber(current) or 0
                                    serverData.maxPlayers = tonumber(max) or 20
                                end
                            elseif name:find("Cosmic Relics") then
                                local relics = value:match("```(%d+)```")
                                if relics then
                                    serverData.relics = tonumber(relics)
                                else
                                    serverData.relics = 0
                                end
                            end
                        end
                    end
                    table.insert(parsed, serverData)
                end
            end
        end)
        return parsed
    end

    local function fetchHopServers()
        if not request then return {} end
        local success, response = pcall(function()
            return request({
                Url = API_URL_HOP,
                Method = "GET",
                Headers = { ["Content-Type"] = "application/json" }
            })
        end)
        
        if success and response and response.StatusCode == 200 then
            local decodeSuccess, decoded = pcall(function()
                return HttpService:JSONDecode(response.Body)
            end)
            if decodeSuccess then
                return parseHopData(decoded)
            end
        end
        return {}
    end

    local function CheckCurrentServer()
        if not workspace:FindFirstChild("zones") or not workspace.zones:FindFirstChild("fishing") then return false end
        local zones = workspace.zones.fishing

        -- Check standard zones
        for k, v in pairs(targetHopEvents) do
            local targetName = ""
            if type(k) == "number" and type(v) == "string" then targetName = v
            elseif type(k) == "string" and v == true then targetName = k end

            if targetName == "Cosmic Relic" then
                 -- Check specifically for relics
                 for _, child in ipairs(workspace:GetChildren()) do
                     if child.Name == "StarCrater" and child:FindFirstChild("Root") and child.Root:FindFirstChild("Cosmic Relic") then
                         return true, "Cosmic Relic" -- Found it here!
                     end
                 end
            elseif targetName ~= "" and zones:FindFirstChild(targetName) then
                return true, targetName
            end
        end
        return false
    end

     blacklistedServers = {}
     currentHopNotification = nil
     hopNotificationTask = nil

     function createHopNotification(titleText, statusText, statusColor)
         playerGui = game.Players.LocalPlayer:WaitForChild("PlayerGui")
        local screenGui = playerGui:FindFirstChild("HopNotificationUI")
        if not screenGui then
            screenGui = Instance.new("ScreenGui")
            screenGui.Name = "HopNotificationUI"
            screenGui.Parent = playerGui
            screenGui.ResetOnSpawn = false
        end

        -- Handle overlap logic
        if currentHopNotification and currentHopNotification.Parent then
            if hopNotificationTask then task.cancel(hopNotificationTask) end
            currentHopNotification:Destroy()
            currentHopNotification = nil
        end

        -- Create New Frame
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0, 200, 0, 50)
        frame.Position = UDim2.new(0, -260, 0.7, 0) -- Slightly lower than fish notification
        frame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
        frame.BackgroundTransparency = 0.1
        frame.BorderSizePixel = 0
        frame.Parent = screenGui

        currentHopNotification = frame

        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 12)
        corner.Parent = frame

        local stroke = Instance.new("UIStroke")
        stroke.Thickness = 1.2
        stroke.Color = Color3.fromRGB(80, 80, 80)
        stroke.Transparency = 0.6
        stroke.Parent = frame

        -- Traffic Lights (Decoration)
        local function createDot(color, position)
            local dot = Instance.new("Frame")
            dot.Size = UDim2.new(0, 8, 0, 8)
            dot.Position = position
            dot.BackgroundColor3 = color
            dot.BorderSizePixel = 0
            dot.Parent = frame
            local c = Instance.new("UICorner")
            c.CornerRadius = UDim.new(1, 0)
            c.Parent = dot
        end

        createDot(Color3.fromRGB(255, 95, 87), UDim2.new(0, 8, 0, 6))   -- Red
        createDot(Color3.fromRGB(255, 189, 46), UDim2.new(0, 20, 0, 6)) -- Yellow
        createDot(Color3.fromRGB(40, 201, 64), UDim2.new(0, 32, 0, 6))  -- Green

        local icon = Instance.new("ImageLabel")
        icon.Size = UDim2.new(0, 24, 0, 24)
        icon.Position = UDim2.new(0, 12, 0.5, 0)
        icon.BackgroundTransparency = 1
        icon.Image = "rbxassetid://6034509923" -- Globe Icon
        icon.ImageColor3 = statusColor or Color3.fromRGB(200, 200, 200)
        icon.Parent = frame

        local titleVal = Instance.new("TextLabel")
        titleVal.Text = titleText
        titleVal.Size = UDim2.new(1, -50, 0, 14)
        titleVal.Position = UDim2.new(0, 46, 0, 14)
        titleVal.BackgroundTransparency = 1
        titleVal.Font = Enum.Font.GothamBold
        titleVal.TextColor3 = Color3.fromRGB(240, 240, 240)
        titleVal.TextSize = 10
        titleVal.TextXAlignment = Enum.TextXAlignment.Left
        titleVal.Parent = frame

        local subtitle = Instance.new("TextLabel")
        subtitle.Text = statusText
        subtitle.Size = UDim2.new(1, -50, 0, 12)
        subtitle.Position = UDim2.new(0, 46, 0, 30)
        subtitle.BackgroundTransparency = 1
        subtitle.Font = Enum.Font.GothamMedium
        subtitle.TextColor3 = statusColor or Color3.fromRGB(180, 180, 180)
        subtitle.TextSize = 9
        subtitle.TextXAlignment = Enum.TextXAlignment.Left
        subtitle.TextTruncate = Enum.TextTruncate.AtEnd
        subtitle.Parent = frame

        -- Animation In
        game:GetService("TweenService"):Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
            Position = UDim2.new(0, 20, 0.7, 0)
        }):Play()

        -- Auto Close Task
        hopNotificationTask = task.delay(4, function()
            if currentHopNotification == frame then
                local tw = game:GetService("TweenService"):Create(frame, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {
                    Position = UDim2.new(0, -260, 0.7, 0),
                    BackgroundTransparency = 1
                })
                tw:Play()
                tw.Completed:Wait()
                if currentHopNotification == frame then
                    frame:Destroy()
                    currentHopNotification = nil
                end
            end
        end)
    end

    local function StartAutoHop()
        if isHopping then return end
        isHopping = true
        
        local currentTargetJobId = nil
        local failed = false

        -- Event listener untuk teleport gagal
        local connection
        connection = TeleportService.TeleportInitFailed:Connect(function(player, result, errorMessage)
            if player == game.Players.LocalPlayer then
                createHopNotification("Teleport Failed", "Error: " .. tostring(errorMessage), Color3.fromRGB(255, 80, 80))
                
                -- Jika gagal (Unauthorized, Full, dll), masukkan ke blacklist
                if currentTargetJobId then
                    blacklistedServers[currentTargetJobId] = true
                end
                failed = true
            end
        end)

        while autoHopEnabled do
            -- 1. Cek Server Sendiri
            local found, eventName = CheckCurrentServer()
            if found then
                createHopNotification("Event Found!", "Stay here! " .. tostring(eventName), Color3.fromRGB(80, 255, 100))
                autoHopEnabled = false
                isHopping = false
                if connection then connection:Disconnect() end
                break 
            end

            -- 2. Cari Server Baru
            createHopNotification("Auto Hop", "Scanning servers...", Color3.fromRGB(255, 200, 50))
            local servers = fetchHopServers()
            local targetServer = nil
            
            for _, srv in ipairs(servers) do
                -- Skip server blacklist
                if blacklistedServers[srv.jobId] then
                    continue
                end

                -- Skip server penuh (misal sisa slot < 1)
                if srv.maxPlayers - srv.playerCount < 1 then
                    continue 
                end

                for k, v in pairs(targetHopEvents) do
                    local targetName = ""
                    if type(k) == "number" and type(v) == "string" then targetName = v
                    elseif type(k) == "string" and v == true then targetName = k end

                if targetName ~= "" then
                        if srv.event then
                            -- Pecah srv.event berdasarkan koma
                            for serverEvent in string.gmatch(srv.event, "([^,]+)") do
                                serverEvent = serverEvent:gsub("^%s+", ""):gsub("%s+$", "")
                                if serverEvent:lower() == targetName:lower() then
                                    targetServer = srv
                                    break
                                end
                            end
                            if targetServer then break end
                        end
                    end
                end
                if targetServer then break end
            end

            if targetServer then
                createHopNotification("Server Found!", "Joining " .. targetServer.event, Color3.fromRGB(0, 170, 255))
                
                currentTargetJobId = targetServer.jobId -- Simpan ID target saat ini
                
                -- Coba Teleport
                failed = false
                TeleportService:TeleportToPlaceInstance(targetServer.placeId, targetServer.jobId, game.Players.LocalPlayer)
                
                -- Tunggu proses teleport (Maksimal 8 detik, tapi kalau error langsung lanjut)
                local startWait = tick()
                repeat 
                    task.wait(0.5)
                until failed or tick() - startWait > 8

                if failed then
                    createHopNotification("Failed", "Retrying search...", Color3.fromRGB(255, 100, 100))
                    -- Loop akan terus lanjut
                else
                     createHopNotification("Status", "Teleport timeout...", Color3.fromRGB(255, 150, 50))
                     blacklistedServers[currentTargetJobId] = true
                end
            else
                createHopNotification("Not Found", "Retrying in 5s...", Color3.fromRGB(150, 150, 150))
                task.wait(5)
            end
        end
        
        if connection then connection:Disconnect() end
        isHopping = false
    end
    
    local autoHopCosmicEnabled = false
    local function StartAutoHopCosmic()
        if isHopping then return end
        isHopping = true
        
        local currentTargetJobId = nil
        local failed = false

        -- Event listener untuk teleport gagal
        local connection
        connection = TeleportService.TeleportInitFailed:Connect(function(player, result, errorMessage)
            if player == game.Players.LocalPlayer then
                createHopNotification("Teleport Failed", "Error: " .. tostring(errorMessage), Color3.fromRGB(255, 80, 80))
                if currentTargetJobId then
                    blacklistedServers[currentTargetJobId] = true
                end
                failed = true
            end
        end)

        while autoHopCosmicEnabled do
            -- 1. Cek Server Sendiri (Cosmic)
            for _, child in ipairs(workspace:GetChildren()) do
                if child.Name == "StarCrater" and child:FindFirstChild("Root") and child.Root:FindFirstChild("Cosmic Relic") then
                    createHopNotification("Event Found!", "Cosmic Relic is here!", Color3.fromRGB(80, 255, 100))
                    autoHopCosmicEnabled = false
                    isHopping = false
                    if connection then connection:Disconnect() end
                    return 
                end
            end

            -- 2. Cari Server Baru
            createHopNotification("Cosmic Hop", "Scanning for Relics...", Color3.fromRGB(155, 89, 182))
            local servers = fetchHopServers()
            local targetServer = nil
            
            for _, srv in ipairs(servers) do
                if blacklistedServers[srv.jobId] then continue end
                if srv.maxPlayers - srv.playerCount < 1 then continue end

                if srv.relics and srv.relics > 0 then
                    targetServer = srv
                    break 
                end
            end

            if targetServer then
                createHopNotification("Cosmic Found!", "Relics: " .. tostring(targetServer.relics), Color3.fromRGB(155, 89, 182))
                currentTargetJobId = targetServer.jobId
                
                failed = false
                TeleportService:TeleportToPlaceInstance(targetServer.placeId, targetServer.jobId, game.Players.LocalPlayer)
                
                -- Smart Wait (up to 8s, break early on fail)
                 local startWait = tick()
                 repeat 
                     task.wait(0.5)
                 until failed or tick() - startWait > 8

                if failed then
                    createHopNotification("Failed", "Retrying...", Color3.fromRGB(255, 100, 100))
                else
                     createHopNotification("Status", "Teleport timeout...", Color3.fromRGB(255, 150, 50))
                     blacklistedServers[currentTargetJobId] = true
                end
            else
                createHopNotification("No Cosmic", "Retrying in 5s...", Color3.fromRGB(150, 150, 150))
                task.wait(5)
            end
        end
        
        if connection then connection:Disconnect() end
        isHopping = false
    end

    ExclusiveSection:AddToggle({
        Title = "Auto Hop Cosmic",
        Description = "Specifically searches for Cosmic Relics",
        Default = _G.Config.AutoHopCosmic or false,
        Callback = function(state)
            _G.Config.AutoHopCosmic = state
            autoHopCosmicEnabled = state
            if state then
                _G.Config.AutoHopEnabled = false -- Turn off main hop to avoid conflict
                task.spawn(StartAutoHopCosmic)
            end
        end
    })
    
    if _G.Config.AutoHopCosmic then
         autoHopCosmicEnabled = true
         task.spawn(StartAutoHopCosmic)
    end

    -- UI Elements
    ExclusiveSection:AddDropdown({
        Title = "Select Target Event",
        Description = "Auto Hop will search for these events",
        Options = {
            'Baby Bloop Fish', 
            'Bloop Fish',
            'Whales Pool',
            'Orcas Pool',
            'The Kraken Pool',
            'Animal Pool',
            'Animal Pool - Second Sea',
            'Octophant Pool Without Elephant',
            'Sea Leviathan Pool',
            'Isonade',
            'Forsaken Veil - Scylla',
            'Blue Moon - Second Sea',
            'Blue Moon - First Sea',
            'LEGO',
            'LEGO - Studolodon',
            'Mosslurker',
            'Narwhal',
            'Whale Shark',
            'Birthday Megalodon',
            'Colossal Blue Dragon',
            'Colossal Ancient Dragon',
            'Colossal Ethereal Dragon'
        },
        Multi = true,
        Default = _G.Config.AutoHopEvents or {},
        Callback = function(val)
            targetHopEvents = val
            _G.Config.AutoHopEvents = val
        end
    })

    ExclusiveSection:AddToggle({
        Title = "Enable Auto Hop",
        Description = "Will keep hopping until target event is found in server list or current server",
        Default = _G.Config.AutoHopEnabled or false,
        Callback = function(state)
            autoHopEnabled = state
            _G.Config.AutoHopEnabled = state
            if state then
                task.spawn(StartAutoHop)
            end
        end
    })

    if _G.Config.AutoHopEnabled then
        autoHopEnabled = true
        task.spawn(StartAutoHop)
    end

    ExclusiveSection:AddToggle({
        Title = "Anti AFK",
        Description = "Prevents being kicked for idleness",
        Default = true,
        Callback = function(state)
            if state then
                local speaker = game.Players.LocalPlayer
                local VirtualUser = game:GetService("VirtualUser")
                
                if getconnections then
                    for _, connection in pairs(getconnections(speaker.Idled)) do
                        if connection["Disable"] then
                            connection["Disable"](connection)
                        elseif connection["Disconnect"] then
                            connection["Disconnect"](connection)
                        end
                    end
                else
                    speaker.Idled:Connect(function()
                        VirtualUser:CaptureController()
                        VirtualUser:ClickButton2(Vector2.new())
                    end)
                end
            end
        end
    })
    ExclusiveSection:AddToggle({
        Title = "Abuse Thalassar's Ruin",
        Default = false,
        Callback = function(state)
            bugrod = state
        end
    })
    -- [[ AUTO HOP LOGIC END ]] --
    local SettingFish = FishingTab:AddSection("Fishing Setting", true)
    local FishingZone = FishingTab:AddSection("Fishing Zone", true)
    local FishingEventZone = FishingTab:AddSection("Fishing Event Zone", true)

    local ShopBait = ShopTab:AddSection("Bait", true)
    local ShopItem = ShopTab:AddSection("Shop Item", true)
    local Merlin = ShopTab:AddSection("Merlin", true)
    local AutosQuest = AutosTab:AddSection("Auto Quest", true)
    local AutosJack = AutosTab:AddSection("Auto Treasure", true)
    local AutosFavorit = AutosTab:AddSection("Auto Fav Item/Fish", true)
    local AutosAppraise = AutosTab:AddSection("Appraise Treasure", true)
    local AutoAppraise = AutosTab:AddSection("Appraise", true)
    local AutoEnchant = AutosTab:AddSection("Enchant", true)
    local Collect = AutosTab:AddSection("Collect", true)
    local AutosSection = AutosTab:AddSection("Auto Sell", true)
    local AuraSection = AutosTab:AddSection("Totem", true)

    -- [[ ESP LOGIC START ]] --
    EspPlayers = false
    EspZone = false
    EspNpc = false
    
    function AddEsp(target, name, color, offset)
        if not target then return end
        if target:FindFirstChild("BF_ESP") then return end
        
        bill = Instance.new("BillboardGui")
        bill.Name = "BF_ESP"
        bill.AlwaysOnTop = true
        bill.Size = UDim2.new(0, 200, 0, 50)
        bill.Adornee = target
        bill.StudsOffset = offset or Vector3.new(0, 3, 0)
        
        text = Instance.new("TextLabel", bill)
        text.Size = UDim2.new(1, 0, 1, 0)
        text.BackgroundTransparency = 1
        text.TextColor3 = color
        text.TextStrokeTransparency = 0
        text.TextStrokeColor3 = Color3.new(0,0,0)
        text.Font = Enum.Font.GothamBold
        text.TextSize = 13
        text.Text = name
        
        bill.Parent = target
        
        if target.Parent and target.Parent:IsA("Model") then
             h = Instance.new("Highlight")
             h.Name = "BF_Highlight"
             h.FillColor = color
             h.OutlineColor = color
             h.FillTransparency = 0.8
             h.Adornee = target.Parent
             h.Parent = target
        end
    end

    function RemoveEsp(target)
         if target and target:FindFirstChild("BF_ESP") then
            target.BF_ESP:Destroy()
         end
         if target and target:FindFirstChild("BF_Highlight") then
            target.BF_Highlight:Destroy()
         end
    end
    
    task.spawn(function()
        while true do
            -- 1. Player ESP
            if EspPlayers then
                for _, p in pairs(game.Players:GetPlayers()) do
                    if p ~= game.Players.LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                         hrp = p.Character.HumanoidRootPart
                         AddEsp(hrp, p.Name, Color3.fromRGB(255, 0, 0))
                         -- Update distance text
                         if hrp:FindFirstChild("BF_ESP") then
                              myRoot = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                              if myRoot then
                                  dist = (myRoot.Position - hrp.Position).Magnitude
                                  hrp.BF_ESP.TextLabel.Text = p.Name .. " ["..math.floor(dist).."m]"
                              end
                         end
                    end
                end
            else
                for _, p in pairs(game.Players:GetPlayers()) do
                    if p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                        RemoveEsp(p.Character.HumanoidRootPart)
                    end
                end
            end
            
            -- 2. Zone/Event ESP
            if EspZone then
                 zones = workspace:FindFirstChild("zones") and workspace.zones:FindFirstChild("fishing")
                 if zones then
                    local targetEvents = {
                        ["Orca"] = true, ["Baby Bloop Fish"] = true, ["Bloop Fish"] = true, ["Moby"] = true, 
                        ["Megalodon"] = true, ["Mossjaw"] = true, ["Megalodon Ancient"] = true, 
                        ["Megalodon Phantom"] = true, ["Great White Shark"] = true, ["Hammerhead Shark"] = true, 
                        ["Whale Shark"] = true, ["The Depths - Serpent"] = true, ["Isonade"] = true, 
                        ["Forsaken Veil - Scylla"] = true, ["Blarney McBreeze"] = true, ["Sea Leviathan Pool"] = true, 
                        ["Animal Pool"] = true, ["Octophant Pool Without Elephant"] = true, ["Kraken Pool"] = true, 
                        ["Blue Moon - Second Sea"] = true, ["Blue Moon - First Sea"] = true, 
                        ["LEGO"] = true, ["LEGO - Studolodon"] = true, ["Mosslurker"] = true, ["Narwhal"] = true,
                        ["Megalodon Default"] = true
                    }
                    for _, z in pairs(zones:GetChildren()) do
                         if targetEvents[z.Name] then
                             if z:IsA("BasePart") then 
                                 AddEsp(z, z.Name, Color3.fromRGB(0, 255, 255))
                             elseif z:IsA("Model") and z.PrimaryPart then
                                 AddEsp(z.PrimaryPart, z.Name, Color3.fromRGB(0, 255, 255))
                             end
                         end
                    end
                 end
            elseif EspZoneAll then
                 zones = workspace:FindFirstChild("zones") and workspace.zones:FindFirstChild("fishing")
                 if zones then
                    for _, z in pairs(zones:GetChildren()) do
                         if z:IsA("BasePart") then 
                             AddEsp(z, z.Name, Color3.fromRGB(200, 200, 200))
                         elseif z:IsA("Model") and z.PrimaryPart then
                             AddEsp(z.PrimaryPart, z.Name, Color3.fromRGB(200, 200, 200))
                         end
                    end
                 end
            else
                 zones = workspace:FindFirstChild("zones") and workspace.zones:FindFirstChild("fishing")
                 if zones then
                    for _, z in pairs(zones:GetChildren()) do
                        if z:IsA("BasePart") then RemoveEsp(z) 
                        elseif z:IsA("Model") and z.PrimaryPart then RemoveEsp(z.PrimaryPart) end
                    end
                 end
            end

            -- 3. NPC ESP
            if EspNpc then
                 npcFolder = workspace:FindFirstChild("world") and workspace.world:FindFirstChild("npcs")
                 if npcFolder then
                    for _, n in pairs(npcFolder:GetChildren()) do
                        if n:FindFirstChild("HumanoidRootPart") then
                             AddEsp(n.HumanoidRootPart, n.Name, Color3.fromRGB(0, 255, 0))
                             if n.HumanoidRootPart:FindFirstChild("BF_ESP") then
                                  myRoot = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                                  if myRoot then
                                      dist = (myRoot.Position - n.HumanoidRootPart.Position).Magnitude
                                      n.HumanoidRootPart.BF_ESP.TextLabel.Text = n.Name .. " ["..math.floor(dist).."m]"
                                  end
                             end
                        end
                    end
                 end
            else
                  npcFolder = workspace:FindFirstChild("world") and workspace.world:FindFirstChild("npcs")
                 if npcFolder then
                    for _, n in pairs(npcFolder:GetChildren()) do
                        if n:FindFirstChild("HumanoidRootPart") then
                            RemoveEsp(n.HumanoidRootPart)
                        end
                    end
                 end
            end
            
            task.wait(1)
        end
    end)

    EspCharacterSection = EspTab:AddSection("ESP Character", true)
    EspCharacterSection:AddToggle({
        Title = "Enable ESP Character",
        Default = false,
        Callback = function(v)
            EspPlayers = v
        end
    })

    EspEventSection = EspTab:AddSection("ESP Zone", true)
    EspEventSection:AddToggle({
        Title = "Enable ESP Zone Event",
        Default = false,
        Callback = function(v)
            EspZone = v
        end
    })
    EspEventSection:AddToggle({
        Title = "Enable ESP Zone",
        Default = false,
        Callback = function(v)
            EspZoneAll = v
        end
    })

    EspNpcSection = EspTab:AddSection("ESP NPC", true)
    EspNpcSection:AddToggle({
        Title = "Enable ESP NPC",
        Default = false,
        Callback = function(v)
            EspNpc = v
        end
    })
    -- [[ ESP LOGIC END ]] --

    local MiscSection = Misc:AddSection("Misc", true)
    local MiscPlayerSection = Misc:AddSection("Misc Player", true)
    
    local SettingsSection = SettingsTab:AddSection("Settings", true)
    local CreditsSection = SettingsTab:AddSection("Credits", true)


    modeReel = "Instant"
    
    local pool_names = {
        'Baby Bloop Fish', 
        'Bloop Fish',
        'Whales Pool',
        'Orcas Pool',
        'The Kraken Pool',
        'Animal Pool',
        'Animal Pool - Second Sea',
        'Octophant Pool Without Elephant',
        'Sea Leviathan Pool',
        'Isonade',
        'Forsaken Veil - Scylla',
        'Blue Moon - Second Sea',
        'Blue Moon - First Sea',
        'LEGO',
        'LEGO - Studolodon',
        'Mosslurker',
        'Narwhal',
        'Whale Shark',
        'Birthday Megalodon',
        'Colossal Blue Dragon',
        'Colossal Ancient Dragon',
        'Colossal Ethereal Dragon',
    }

    local megalodon_pool_names = {
        Default = 'Megalodon Default',
        Ancient = 'Megalodon Ancient',
        Phantom = 'Megalodon Phantom',
    }

    local function getStatus(obj)
        return obj and '✓' or 'x'
    end

    local function getPlayerHeader()
        local placeId = game.PlaceId
        local l = LocalPlayer and LocalPlayer:FindFirstChild('leaderstats')

        if placeId == 16732694052 then
            return string.format(
                'Username: %s\nC$: %s\nLevel: %s\n\n',
                LocalPlayer and LocalPlayer.Name or 'N/A',
                l and l:FindFirstChild('C$') and l['C$'].Value or 'N/A',
                l and l:FindFirstChild('Level') and l.Level.Value or 'N/A'
            )
        elseif placeId == 72907489978215 then
            return string.format(
                'Username: %s\nE$: %s\nLevel: %s\n\n',
                LocalPlayer and LocalPlayer.Name or 'N/A',
                l and l:FindFirstChild('E$') and l['E$'].Value or 'N/A',
                l and l:FindFirstChild('Level') and l.Level.Value or 'N/A'
            )
        else
            return 'Unknown Place ID'
        end
    end

    local eventParagraph
    local EventStatusParagraph = Infr:AddParagraph({
        Title = 'INFORMATION',
        Content = 'Loading...',
    })
    local function updateEventStatus()
        local success, errorMessage = pcall(function()
            local content = getPlayerHeader()

            for _, name in ipairs(pool_names) do
                content ..= string.format(
                    '%s: %s\n',
                    name,
                    getStatus(workspace.zones.fishing:FindFirstChild(name))
                )
            end

            for key, name in pairs(megalodon_pool_names) do
                content ..= string.format(
                    'Megalodon %s: %s\n',
                    key,
                    getStatus(workspace.zones.fishing:FindFirstChild(name))
                )
            end
            EventStatusParagraph:Set({
                Content = content,
                RichText = true,
                TextWrapped = true,
                Size = UDim2.new(1, 0, 0, 200),
            })
        end)
    end
    task.spawn(function()
        while true do
            updateEventStatus()
            task.wait(0.5)
        end
    end)

    local function startAutoClaimMulti()
        task.spawn(function()
            while autoClaimMulti do
                local char = player.Character
                local hrp = char and char:FindFirstChild("HumanoidRootPart")
                
                if hrp then
                    local foundItems = findAndClaimItems()
                    if foundItems then
                        print("Claimed available items, waiting before next scan...")
                        task.wait(1)
                    else
                        print("No items found, scanning again...")
                        task.wait(1)
                    end
                else
                    print("Character not ready, waiting...")
                    task.wait(1)
                end
            end
        end)
    end
    Collect:AddToggle({
        Title = "Auto Claim Multi Items",
        Default = false,
        Content = "Otomatis claim Lunar Thread, Starfall Totem, dan Cosmic Relic",
        Callback = function(state)
            task.spawn(function()
                autoClaimMulti = state
                if autoClaimMulti then
                    startAutoClaimMulti()
                else
                    print("Auto Claim Multi Items: DISABLED")
                end
            end)
        end
    })
    MainSection:AddInput({
        Title = 'Delay Instant Reel (s)',
        Default = tostring(__var.DelayTimeFaster or 5),
        Placeholder = 'Masukkan delay (contoh: 3.5)',
        Callback = function(value)
            local num = tonumber(value)
            if num and num >= 0.1 and num <= 5 then
                __var.DelayTimeFaster = num
            else
                warn(
                    '[Instant Reel Delay] Nilai tidak valid, harus antara 0.1 - 5 detik'
                )
            end
        end,
    })--// ======= CONFIG / STATE =======


function isReelOpen(reel)
	if not reel or not reel.Parent then return false end
	if reel:IsA("ScreenGui") then
		return reel.Enabled
	elseif reel:IsA("GuiObject") then
		return reel.Visible
	end
	return false
end

function setReelOpen(reel, open)
	if not reel or not reel.Parent then return end
	if reel:IsA("ScreenGui") then
		reel.Enabled = open
	elseif reel:IsA("GuiObject") then
		reel.Visible = open
	end
end

function getReelRatio(reel)
	-- expects: reel.bar.progress.bar
	barFolder = reel:FindFirstChild("bar")
	progressFolder = barFolder and barFolder:FindFirstChild("progress")
	progressBar = progressFolder and progressFolder:FindFirstChild("bar")

	if not (progressFolder and progressBar) then
		return nil
	end

	total = progressFolder.AbsoluteSize.X
	if total <= 0 then return 0 end

	return progressBar.AbsoluteSize.X / total
end

local function safeCallEndMinigame(reel, instantFlag)
	if typeof(EndMinigame) ~= "function" then
		warn("EndMinigame is not a function / not in scope:", EndMinigame)
		return false
	end

	local ok, err = pcall(function()
		EndMinigame(reel, instantFlag)
	end)


	if not ok then
		warn("EndMinigame error:", err)
	end
	return ok
end

function checkReel(reel)
	if not _G.Config.InstantReel then return end
	if not reel or not reel.Parent then return end

	task.spawn(function()
		-- tunggu UI ada (pakai WaitForChild biar konsisten)
		barFolder = reel:WaitForChild("bar", 5)
		progressFolder = barFolder and barFolder:WaitForChild("progress", 5)
		progressBar = progressFolder and progressFolder:WaitForChild("bar", 5)
		if not (progressFolder and progressBar) then return end

		fired = false
		local connection
		connection = RunService.Heartbeat:Connect(function()
			if not reel.Parent or not _G.Config.InstantReel then
				if connection then connection:Disconnect() end
				return
			end

			-- hitung ratio
			total = progressFolder.AbsoluteSize.X
			ratio = 0
			if total > 0 then
				ratio = progressBar.AbsoluteSize.X / total
			end

			-- Threshold
			if ratio >= 0.45 and not fired then
				fired = true
                if _G.Config.InstantReel and reel and reel.Parent and isReelOpen(reel) then
					safeCallEndMinigame(reel, true)
                    print("Instant Reel")
                end
			end
		end)
	end)
end

function startInstantLoop()
	task.spawn(function()
		while _G.Config.InstantReel do
			task.wait(0.1)

			player = Players.LocalPlayer
			gui = player and player:FindFirstChild("PlayerGui")
			reel = gui and gui:FindFirstChild("reel")

			if reel and isReelOpen(reel) then
				task.wait(0.1)

				successCount = 0
				while _G.Config.InstantReel and reel and reel.Parent and isReelOpen(reel) do
					ratio = getReelRatio(reel)
					if ratio then
						if ratio >= 0.40 then
							successCount += 1
						else
							successCount = 0
						end

						if successCount >= 5 then
							safeCallEndMinigame(reel, true)
							break
						end
					else
						successCount = 0
					end

					task.wait(0.05)
				end
			end
		end
	end)
end

Players.LocalPlayer.PlayerGui.ChildAdded:Connect(function(child)
	if child and child.Name == "reel" and _G.Config.InstantReel then
		checkReel(child)
	end
end)

--// ======= UI DROPDOWN =======
MainSection:AddDropdown({
	Title = "Mode Reel",
	Content = "Select Mode Reel.",
	Options = {"Super Instant", "Legit"},
	Multi = false,
	Default = "Super Instant",
	Callback = function(value)
		modeReel = value

		-- Reset
		_G.Config.InstantReel = false
		LegitReel = false
		__var.autoReelEnabled = false

		if modeReel == "Super Instant" then
			_G.Config.InstantReel = true
			__var.autoReelEnabled = true

			-- Start watchers
			-- startInstantLoop()

			-- also check if reel already exists
			player = Players.LocalPlayer
			gui = player and player:FindFirstChild("PlayerGui")
			existing = gui and gui:FindFirstChild("reel")
			if existing then checkReel(existing) end

		elseif modeReel == "Legit" then
			LegitReel = true
			if typeof(StartAutoReel) == "function" then
				StartAutoReel()
			else
				warn("StartAutoReel is not a function / not in scope:", StartAutoReel)
			end
		end
	end
})
        AutoCastToggle = MainSection:AddToggle({
        Title = "Instant Bobber", 
        Default = _G.Config.AutoCast,
        Callback = function(values)
            _G.Config.AutoCast = values
        end
    })
    

    V_FreezeCharacter = false
    -- MiscSection:AddToggle({
    --     Title = "DUPE FISCHHH",
    --     Default = false,
    --     Content = "",
    --     Callback = function(isEnabled)
    --         task.spawn(function()
    --             if isEnabled then
    --                 task.spawn(function()
    --                     local ReplicatedStorage = game:GetService("ReplicatedStorage")
    --                     local remote = ReplicatedStorage:WaitForChild("packages"):WaitForChild("Net"):WaitForChild("RE/SpearFishing/Minigame")
    --                     local spearfishing = workspace:WaitForChild("Spearfishing Water")
    --                     local targetCF = CFrame.new(
    --                         -2775.89648, 465.842285, -2121.5957, 
    --                         1, 0, 0, 
    --                         0, 1, 0, 
    --                         0, 0, 1
    --                     )

    --                     local player = game.Players.LocalPlayer
    --                     local char = player.Character or player.CharacterAdded:Wait()
    --                     local hrp = char:WaitForChild("HumanoidRootPart")
    --                     hrp.CFrame = targetCF

    --                     task.spawn(function()
    --                         while isEnabled do
    --                             for _, zone in ipairs(spearfishing:GetChildren()) do
    --                                 local zoneFish = zone:FindFirstChild("ZoneFish")
    --                                 if zoneFish then
    --                                     for _, fish in ipairs(zoneFish:GetChildren()) do
    --                                         local fishName = fish.Name -- atau fish:GetAttribute("Name")
    --                                         if string.find(fishName, "Piraiba") or string.find(fishName, "Motoro") then
    --                                             local uid = fish:GetAttribute("UID")
    --                                             if uid then
    --                                                 remote:FireServer(uid)
    --                                                 task.wait(0)
    --                                                 remote:FireServer(uid, true)
    --                                             end
    --                                         end
    --                                     end
    --                                 end
    --                             end
    --                             task.wait(0.1)
    --                         end
    --                     end)
    --                 end)
    --             end
    --         end)
    --     end
    -- })

    
    MiscSection:AddToggle({
        Title = "Freeze Character",
        Default = false,
        Content = "",
        Callback = function(isEnabled)
            V_FreezeCharacter = isEnabled
            local oldpos = nil
            task.spawn(function()
                while V_FreezeCharacter do
                    local player = LocalPlayer
                    local character = player.Character or player.CharacterAdded:Wait()
                    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
                    local humanoid = character:FindFirstChildOfClass("Humanoid")

                    if oldpos == nil then
                        oldpos = humanoidRootPart.CFrame
                    end

                    humanoidRootPart.CFrame = oldpos
                    humanoidRootPart.AssemblyLinearVelocity = Vector3.zero
                    humanoidRootPart.AssemblyAngularVelocity = Vector3.zero
                    if humanoid then
                        humanoid:ChangeState(Enum.HumanoidStateType.Seated)
                    end

                    task.wait()
                end
            end)
        end
    })

    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer

    local function autoEquipRod()
        local rodName = workspace.PlayerStats[LocalPlayer.Name].T[LocalPlayer.Name].Stats.rod.Value
        if rodName and rodName ~= "" then
            local backpack = LocalPlayer:WaitForChild("Backpack")
            local rod = backpack:FindFirstChild(rodName)
            task.wait(0.02)
            if rod then
                LocalPlayer.Character.Humanoid:EquipTool(rod)
            end
        end
    end

    local FishingToggle = MainSection:AddToggle({
        Title = "Auto Equip Rod",
        Default = _G.Config.isEquipRpd,
        Callback = function(value)
            _G.Config.isEquipRpd = value
            if _G.Config.isEquipRpd then
                task.spawn(function()
                    while _G.Config.isEquipRpd do
                        autoEquipRod()
                        task.wait(0.01)
                    end
                end)
            end
        end
    })
    local AutoShakeFunc = MainSection:AddToggle({
        Title = "Auto Shake",
        Default = _G.Config.AutoShake,
        Callback = function(value)
            task.spawn(function()
                _G.Config.AutoShake = value
                if value then
                    Shake() -- Start Shake if true
                end
            end)
        end
    })
    -- MainSection:AddSeperator({
    --     Title = 'Super Instant Reel',
    -- })
    -- MainSection:AddInput({
    --     Title = "Delay Super Instant Reel",
    --     Default = tostring(superinstantreeldelay or 2),
    --     Callback = function(value)
    --         local num = tonumber(value)
    --         if num then
    --             superinstantreeldelay = num
    --         end
    --     end
    -- })
    
    -- local AutoShakeFunc = MainSection:AddToggle({
    --     Title = "Super Instant Reel",
    --     Default = superinstantreeel,
    --     Callback = function(value)
    --         task.spawn(function()
    --             superinstantreeel = value
    --         end)
    --     end
    -- })
    local AutoShakeFunc = MainSection:AddButton({
        Title = "Cancel Fishing",
        Callback = function()
            task.spawn(function()
                unequipRod()
                equipRod()
            end)
        end
    })
    MainSection:AddSeperator({
        Title = 'Snap Fish',
    })
    MainSection:AddDropdown({
        Title = "Trait Preset",
        Multi = true,
        Options = {"Shiny", "Sparkling", "None"},
        Default = __var.SnapMutationPresets or {"Shiny", "Sparkling"},
        Callback = function(val)
            __var.SnapMutationPresets = val
        end
    })
    MainSection:AddInput({
        Title = "Snap Filter Fish",
        Default = __var.SnapTarget or "",
        Placeholder = "Example: Salmon, Shark, Relic",
        Callback = function(v)
            __var.SnapTarget = v
        end
    })
    local templateOptions = {}
    local succeeded, err = pcall(function()
        local generalPath = game:GetService("ReplicatedStorage"):WaitForChild("resources"):WaitForChild("replicated"):WaitForChild("instances"):WaitForChild("general")
        for _, child in ipairs(generalPath:GetChildren()) do
             if child.Name:match("template$") then
                local name = child.Name:gsub("template", "")
                local formattedName = name:gsub("^%l", string.upper)
                table.insert(templateOptions, formattedName)
             end
        end
    end)
    if not succeeded then warn("Failed to fetch templates: " .. tostring(err)) end
    
    -- Manual additions for mutations without standard templates
    table.insert(templateOptions, "Rainbow Cluster")
    table.insert(templateOptions, "Rainbow")
    table.insert(templateOptions, "Blue Moon")
    table.insert(templateOptions, "King's Blessing")
    
    table.sort(templateOptions)

    MainSection:AddDropdown({
        Title = "Snap Filter Mutation",
        Multi = true,
        Options = templateOptions,
        Default = {},
        Callback = function(v)
            local strTable = {}
            for k, val in pairs(v) do
                if type(k) == "string" and val == true then
                    table.insert(strTable, k)
                elseif type(k) == "number" and type(val) == "string" then
                    table.insert(strTable, val)
                end
            end
            __var.SnapMutation = table.concat(strTable, ", ")
        end
    })
    MainSection:AddToggle({
        Title = "Auto Snap Line (Filter)",
        Content = "Automatically reset rod if fish is NOT in the filter list",
        Default = __var.AutoSnapEnabled or false,
        Callback = function(v)
            __var.AutoSnapEnabled = v
        end
    })
    MainSection:AddSeperator({
        Title = 'Spear',
    })
    dupeFischToggle = false
    MainSection:AddToggle({
        Title = 'Spear Exploits',
        Content = 'High Risk',
        Value = false,
        Callback = function(value)
            dupeFischToggle = value

            if value then
                task.spawn(function()
                    remote = ReplicatedStorage:WaitForChild('packages')
                        :WaitForChild('Net')
                        :WaitForChild('RE/SpearFishing/Minigame')
                    spearfishing = workspace:WaitForChild('Spearfishing Water')

                    player = game.Players.LocalPlayer
                    char = player.Character or player.CharacterAdded:Wait()
                    hrp = char:WaitForChild('HumanoidRootPart')

                    hrp.CFrame = CFrame.new(-2775.89648, 465.842285, -2121.5957)

                    while dupeFischToggle do
                        for _, zone in ipairs(spearfishing:GetChildren()) do
                            zoneFish = zone:FindFirstChild('ZoneFish')
                            if zoneFish then
                                for _, fish in ipairs(zoneFish:GetChildren()) do
                                    uid = fish:GetAttribute('UID')
                                    if uid then
                                        remote:FireServer(uid)
                                        task.wait(0.1)
                                        remote:FireServer(uid, true)
                                    end
                                end
                            end
                        end
                        task.wait(0.1)
                    end
                end)
            else
                dupeFischToggle = false
            end
        end,
    })
    
    SettingFish:AddSlider({
        Title = "Shake Speed (Click/Frame)",
        Description = "Adjust spam intensity.",
        Default = 10,
        Min = 1,
        Max = 100,
        Callback = function(v)
            shakeSpeed = v
        end
    })
    SettingFish:AddSlider({
        Title = "Bar Size",
        Description = "Adjust the size of the fishing bar.",
        Default = 2,
        Min = 0.1,
        Max = 20,
        Callback = function(v)
            __var.barSize = v
        end
    })
    local AutoShakeFunc = SettingFish:AddToggle({
        Title = "Perfect Catch (high risk)",
        Default = __var.perfectCatchEnabled,
        Callback = function(value)
            __var.perfectCatchEnabled = value
        end
    })
    SettingFish:AddButton({
        Title = "Finish Fishing",
        Callback = function()
            pcall(function()
                local args = {
                    {
                        e = 100,
                        p = true,
                        l = {}
                    }
                }
                game:GetService("ReplicatedStorage"):WaitForChild("packages"):WaitForChild("Net"):WaitForChild("RE/Reel/Finish"):FireServer(unpack(args))
            end)
        end
    })
    oxygenVar = true
    local DisableOxygen = MiscSection:AddToggle({
        Title = "Infinite Oxygen", 
        Default = true,
        Callback = function(state)
            oxygenVar = state
             local function DisableOxygenScript()
                local char = LocalPlayer.Character
                if char then
                    local resources = char:FindFirstChild("Resources")
                    if resources then
                        local oxygen = resources:FindFirstChild("oxygen")
                        if oxygen and oxygen:IsA("LocalScript") then
                            oxygen.Disabled = true
                        end

                        local oxygenPeaks = resources:FindFirstChild("oxygen(peaks)")
                        if oxygenPeaks and oxygenPeaks:IsA("LocalScript") then
                            oxygenPeaks.Disabled = true
                        end

                        local gas = resources:FindFirstChild("gas")
                        if gas and gas:IsA("LocalScript") then
                            gas.Disabled = true
                        end

                        local temperature = resources:FindFirstChild("temperature")
                        if temperature and temperature:IsA("LocalScript") then
                            temperature.Disabled = true
                        end

                        local temperatureHeat = resources:FindFirstChild("temperature(heat)")
                        if temperatureHeat and temperatureHeat:IsA("LocalScript") then
                            temperatureHeat.Disabled = true
                        end

                    end
                end
            end
            DisableOxygenScript()
            LocalPlayer.CharacterAdded:Connect(function()
                task.wait(1)
                DisableOxygenScript()
            end)
        end
     })
     
    function updateCanCollide(value)
        local fishingZone = workspace:FindFirstChild("zones"):FindFirstChild("fishing")
        if fishingZone then
            for _, descendant in ipairs(fishingZone:GetDescendants()) do
                if descendant:IsA("Part") then
                    descendant.CanCollide = value
                end
            end
        end
    end

    -- Player Movement Hacks System
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

-- Movement Settings
local MovementSettings = {
    Speed = {
        Enabled = false,
        Value = 50, -- Default speed multiplier
        Connection = nil
    },
    Jump = {
        Enabled = false,
        Value = 50, -- Default jump power
        Connection = nil
    },
    InfJump = {
        Enabled = false,
        Connection = nil
    },
    Fly = {
        Enabled = false,
        Speed = 1,
        QEfly = true,
        Connection = nil,
        InputConnections = {}
    }
}
local FLYING = false
local flyKeyDown, flyKeyUp
-- Speed Hack Function
local function updateSpeed(enabled)
    MovementSettings.Speed.Enabled = enabled
    
    if MovementSettings.Speed.Connection then
        MovementSettings.Speed.Connection:Disconnect()
        MovementSettings.Speed.Connection = nil
    end
    
    if enabled then
        MovementSettings.Speed.Connection = RunService.Heartbeat:Connect(function()
            local character = player.Character
            local humanoid = character and character:FindFirstChild("Humanoid")
            
            if humanoid then
                humanoid.WalkSpeed = MovementSettings.Speed.Value
            end
        end)
    else
        -- Reset to default speed
        local character = player.Character
        local humanoid = character and character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = 16 -- Default Roblox speed
        end
    end
end

-- Jump Power Function
local function updateJump(enabled)
    MovementSettings.Jump.Enabled = enabled
    
    if MovementSettings.Jump.Connection then
        MovementSettings.Jump.Connection:Disconnect()
        MovementSettings.Jump.Connection = nil
    end
    
    if enabled then
        MovementSettings.Jump.Connection = RunService.Heartbeat:Connect(function()
            local character = player.Character
            local humanoid = character and character:FindFirstChild("Humanoid")
            
            if humanoid then
                humanoid.JumpPower = MovementSettings.Jump.Value
            end
        end)
    else
        -- Reset to default jump
        local character = player.Character
        local humanoid = character and character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.JumpPower = 50 -- Default Roblox jump power
        end
    end
end

-- Infinite Jump Function
local function updateInfJump(enabled)
    MovementSettings.InfJump.Enabled = enabled
    
    if MovementSettings.InfJump.Connection then
        MovementSettings.InfJump.Connection:Disconnect()
        MovementSettings.InfJump.Connection = nil
    end
    
    if enabled then
        MovementSettings.InfJump.Connection = UserInputService.JumpRequest:Connect(function()
            local character = player.Character
            local humanoid = character and character:FindFirstChild("Humanoid")
            
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end)
    end
end

local function sFLY()
    repeat task.wait() until player and player.Character and getRoot(player.Character) and player.Character:FindFirstChildOfClass("Humanoid")
    
    if flyKeyDown then flyKeyDown:Disconnect() end
    if flyKeyUp then flyKeyUp:Disconnect() end

    local T = getRoot(player.Character)
    local CONTROL = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0}
    local lCONTROL = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0}
    local SPEED = 0

    local function FLY()
        FLYING = true
        local BG = Instance.new('BodyGyro')
        local BV = Instance.new('BodyVelocity')
        BG.P = 9e4
        BG.Parent = T
        BV.Parent = T
        BG.maxTorque = Vector3.new(9e9, 9e9, 9e9)
        BG.cframe = T.CFrame
        BV.velocity = Vector3.new(0, 0, 0)
        BV.maxForce = Vector3.new(9e9, 9e9, 9e9)
        
        task.spawn(function()
            repeat task.wait()
                if player.Character:FindFirstChildOfClass('Humanoid') then
                    player.Character:FindFirstChildOfClass('Humanoid').PlatformStand = true
                end
                if CONTROL.L + CONTROL.R ~= 0 or CONTROL.F + CONTROL.B ~= 0 or CONTROL.Q + CONTROL.E ~= 0 then
                    SPEED = 50
                elseif not (CONTROL.L + CONTROL.R ~= 0 or CONTROL.F + CONTROL.B ~= 0 or CONTROL.Q + CONTROL.E ~= 0) and SPEED ~= 0 then
                    SPEED = 0
                end
                if (CONTROL.L + CONTROL.R) ~= 0 or (CONTROL.F + CONTROL.B) ~= 0 or (CONTROL.Q + CONTROL.E) ~= 0 then
                    BV.velocity = ((workspace.CurrentCamera.CoordinateFrame.lookVector * (CONTROL.F + CONTROL.B)) + ((workspace.CurrentCamera.CoordinateFrame * CFrame.new(CONTROL.L + CONTROL.R, (CONTROL.F + CONTROL.B + CONTROL.Q + CONTROL.E) * 0.2, 0).p) - workspace.CurrentCamera.CoordinateFrame.p)) * SPEED
                    lCONTROL = {F = CONTROL.F, B = CONTROL.B, L = CONTROL.L, R = CONTROL.R}
                elseif (CONTROL.L + CONTROL.R) == 0 and (CONTROL.F + CONTROL.B) == 0 and (CONTROL.Q + CONTROL.E) == 0 and SPEED ~= 0 then
                    BV.velocity = ((workspace.CurrentCamera.CoordinateFrame.lookVector * (lCONTROL.F + lCONTROL.B)) + ((workspace.CurrentCamera.CoordinateFrame * CFrame.new(lCONTROL.L + lCONTROL.R, (lCONTROL.F + lCONTROL.B + CONTROL.Q + CONTROL.E) * 0.2, 0).p) - workspace.CurrentCamera.CoordinateFrame.p)) * SPEED
                else
                    BV.velocity = Vector3.new(0, 0, 0)
                end
                BG.cframe = workspace.CurrentCamera.CoordinateFrame
            until not FLYING
            CONTROL = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0}
            lCONTROL = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0}
            SPEED = 0
            BG:Destroy()
            BV:Destroy()
            if player.Character:FindFirstChildOfClass('Humanoid') then
                player.Character:FindFirstChildOfClass('Humanoid').PlatformStand = false
            end
        end)
    end
    
    flyKeyDown = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        local KEY = input.KeyCode.Name:lower()
        
        if KEY == 'w' then
            CONTROL.F = MovementSettings.Fly.Speed
        elseif KEY == 's' then
            CONTROL.B = -MovementSettings.Fly.Speed
        elseif KEY == 'a' then
            CONTROL.L = -MovementSettings.Fly.Speed
        elseif KEY == 'd' then 
            CONTROL.R = MovementSettings.Fly.Speed
        elseif MovementSettings.Fly.QEfly and KEY == 'e' then
            CONTROL.Q = MovementSettings.Fly.Speed * 2
        elseif MovementSettings.Fly.QEfly and KEY == 'q' then
            CONTROL.E = -MovementSettings.Fly.Speed * 2
        end
        pcall(function() workspace.CurrentCamera.CameraType = Enum.CameraType.Track end)
    end)
    
    flyKeyUp = UserInputService.InputEnded:Connect(function(input, gameProcessed)
        local KEY = input.KeyCode.Name:lower()
        
        if KEY == 'w' then
            CONTROL.F = 0
        elseif KEY == 's' then
            CONTROL.B = 0
        elseif KEY == 'a' then
            CONTROL.L = 0
        elseif KEY == 'd' then
            CONTROL.R = 0
        elseif KEY == 'e' then
            CONTROL.Q = 0
        elseif KEY == 'q' then
            CONTROL.E = 0
        end
    end)
    
    FLY()
end

-- Updated Fly Function
local function updateFly(enabled)
    MovementSettings.Fly.Enabled = enabled
    
    if enabled then
        sFLY()
    else
        FLYING = false
        if flyKeyDown then flyKeyDown:Disconnect() end
        if flyKeyUp then flyKeyUp:Disconnect() end
    end
end


-- UI Toggles
local Toggle1 = MiscSection:AddToggle({
    Title = "Walk On Water", 
    Content = "if you are underwater and turn this on, it will automatically be above", 
    Default = false,
    Callback = function(state)
        task.spawn(function()
            updateCanCollide(state)
        end)
    end
})
MiscPlayerSection:AddSlider({
    Title = "Speed Value",
    Min = 16,
    Max = 1000,
    Default = 50,
    Callback = function(value)
        MovementSettings.Speed.Value = value
    end
})
local Toggle2 = MiscPlayerSection:AddToggle({
    Title = "Walk Speed",
    Content = "Increases your movement speed",
    Default = false,
    Callback = function(state)
        task.spawn(function()
            updateSpeed(state)
        end)
    end
})
MiscPlayerSection:AddSlider({
    Title = "Jump Power",
    Min = 50,
    Max = 1000,
    Default = 200,
    Callback = function(value)
        MovementSettings.Jump.Value = value
    end
})

local Toggle3 = MiscPlayerSection:AddToggle({
    Title = "Jump Power",
    Content = "Increases your jump height",
    Default = false,
    Callback = function(state)
        task.spawn(function()
            updateJump(state)
        end)
    end
})

MiscPlayerSection:AddSlider({
    Title = "Fly Speed",
    Min = 0.1,
    Max = 5,
    Default = 1,
    Callback = function(value)
        MovementSettings.Fly.Speed = value
    end
})

local Toggle5 = MiscPlayerSection:AddToggle({
    Title = "Fly",
    Content = "Advanced fly system (WASD + Q/E for up/down, follows camera direction)",
    Default = false,
    Callback = function(state)
        task.spawn(function()
            updateFly(state)
        end)
    end
})
local Toggle4 = MiscPlayerSection:AddToggle({
    Title = "Infinite Jump",
    Content = "Jump as many times as you want in mid-air",
    Default = false,
    Callback = function(state)
        task.spawn(function()
            updateInfJump(state)
        end)
    end
})
-- Cleanup when player leaves
player.CharacterRemoving:Connect(function()
    updateSpeed(false)
    updateJump(false)
    updateInfJump(false)
    updateFly(false)
end)
    ItemDropdown = nil
    local selectedBait = nil
	local baitBuyAmount = 1
	ShopBait:AddDropdown({
		Title = "Select Bait",
		Content = "Choose a Bait to Purchase",
		Multi = false,
		Options = {
			"Common Crate",
			"Tropical Bait Crate",
			"Carbon Crate",
			"Bait Crate",
			"Quality Bait Crate",
			"Coral Geode",
			"Volcanic Geode",
			"Festive Bait Crate"
		},
		Callback = function(v)
			selectedBait = v
		end
	})

	ShopBait:AddInput({
		Title = "Buy Amount",
		Content = "Amount To Buy Bait",
		Value = "1",
		Callback = function(Text)
			local amount = tonumber(Text)
			if amount then
				baitBuyAmount = Text
			end
		end
	})
		
	ShopBait:AddButton({
		Title = "Buy Bait",
		Content = "Buy selected bait as much as you want.",
		Callback = function()
			if tonumber(baitBuyAmount) > 0 and selectedBait then
				for i = 1, tonumber(baitBuyAmount) do
					game:GetService("ReplicatedStorage").events.purchase:FireServer(selectedBait, "Fish")
					task.wait()
				end
			end
		end
	})
    PurchaseQuantity = 1
    ShopItem:AddInput({
        Title = "Purchase Quantity",
        Default = tostring(PurchaseQuantity or 2),
        Callback = function(value)
            local num = tonumber(value)
            if num then
                PurchaseQuantity = num
            end
        end
    })
    ShopItem:AddDropdown({
        Title = "Select an Item",
        Content = "Choose an item from the shop to purchase.", 
        Options = itemNames,
        Multi = false,
        Default = nil,
        Callback = function(value)
            ItemDropdown = value
        end
    })
    ShopItem:AddButton({
        Title = "Buy Selected Item",
        Content = "Click this button to purchase the selected item.", 
        Callback = function()
            local selectedItem = ItemDropdown
            if selectedItem and selectedItem ~= "Witches Ingredient" then
                local args = {
                    selectedItem,
                    "Item",
                    [4] = PurchaseQuantity
                }
                event:FireServer(unpack(args))
            else
                warn("No Item selected!")
            end
        end
    })
    BlackMarketGui = PlayerGui:WaitForChild("hud"):WaitForChild("safezone"):WaitForChild("BlackMarket")
    ListFrame = BlackMarketGui:WaitForChild("List")

    PurchaseRemote = ReplicatedStorage:WaitForChild("packages"):WaitForChild("Net"):WaitForChild("RE/BlackMarket/Purchase")

    AutoBM = {
        Enabled = false,
        TargetItem = nil,
        Items = {},
        ItemIDs = {}
    }

    function RefreshItemList()
        AutoBM.Items = {}
        AutoBM.ItemIDs = {}

        for _, child in ipairs(ListFrame:GetChildren()) do
            if child:IsA("Frame") and child:FindFirstChild("ItemPreview") then
                titleLabel = child.ItemPreview:FindFirstChild("ItemHeader")
                    and child.ItemPreview.ItemHeader:FindFirstChild("ItemTitle")

                if titleLabel then
                    displayName = titleLabel.Text
                    table.insert(AutoBM.Items, displayName)
                    AutoBM.ItemIDs[displayName] = child.Name -- UUID
                end
            end
        end

        if #AutoBM.Items == 0 then
            table.insert(AutoBM.Items, "No items found")
        end

        if AutoBM.DropdownUI then
            AutoBM.DropdownUI:Refresh(AutoBM.Items)
        end
    end

    AutoBM.DropdownUI = ShopItem:AddDropdown({
        Title = "Select Item Black Market",
        Options = AutoBM.Items,
        Multi = false,
        Value = nil,
        Callback = function(value)
            if value and AutoBM.ItemIDs[value] then
                AutoBM.TargetItem = value
            end
        end
    })

    ShopItem:AddButton({
        Title = "Refresh Item List Black Market",
        Callback = function()
            RefreshItemList()
        end
    })

    ShopItem:AddToggle({
        Title = "Auto Buy Selected Item Black Market",
        Content = "Automatically buy selected item repeatedly",
        Default = false,
        Callback = function(state)
            AutoBM.Enabled = state

            if state then
                task.spawn(function()
                    while AutoBM.Enabled do
                        if AutoBM.TargetItem and AutoBM.ItemIDs[AutoBM.TargetItem] then
                            local uuid = AutoBM.ItemIDs[AutoBM.TargetItem]

                            pcall(function()
                                PurchaseRemote:FireServer(uuid)
                            end)

                            task.wait(1)
                        else
                            task.wait(0.5)
                        end
                    end
                end)
            end
        end
    })
    local function FireProximity(proximity)
				if proximity:IsA("ProximityPrompt") and proximity.Enabled then
					proximity:InputHoldBegin()
					proximity.HoldDuration = 0
					proximity:InputHoldEnd()
				end
			end
    local merlinOptions = {"1", "2", "5", "10", "25", "50"}
    local selectedMerlinOpt = 1
    Merlin:AddDropdown({
        Title = "Merlin Option",
        Options = merlinOptions,
        Default = "1",
        Callback = function(v)
            for i, option in ipairs(merlinOptions) do
                if option == v then
                    selectedMerlinOpt = i
                    break
                end
            end
        end
    })

    Merlin:AddToggle({
        Title = "Auto Buy Merlin",
        Default = false,
        Callback = function(state)
            _G.Config.AutoBuyMerlin = state
            if state then
                task.spawn(function()
                    local lp = game.Players.LocalPlayer
                    if lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") then
                        lp.Character.HumanoidRootPart.CFrame = CFrame.new(-952, 223, -987)
                    end
                    task.wait(0.5)

                    local merlin = workspace:FindFirstChild("world") and workspace.world:FindFirstChild("npcs") and workspace.world.npcs:FindFirstChild("Merlin")
                    local prompt = merlin and merlin:FindFirstChild("ProximityPrompt")
                    if prompt then
                        FireProximity(prompt)
                    end
                    task.wait(0.5)

                    while _G.Config.AutoBuyMerlin do
                        local args = {
                            3,
                            selectedMerlinOpt
                        }
                        game:GetService("ReplicatedStorage"):WaitForChild("packages"):WaitForChild("Net"):WaitForChild("RF/DialogInteract"):InvokeServer(unpack(args))
                        task.wait(0.5)
                    end
                end)
            end
        end
    })
    

    MiscSection:AddButton({
        Title = "Reset Player",
        Content = "Click this button to Reset Player", 
        Callback = function()
            LocalPlayer.Character:WaitForChild("Humanoid").Health = 0
        end
    })
    -- MiscSection:AddButton({
    --     Title = "GET PRIVATE SERVER",
    --     Content = "Click this button to get private server", 
    --     Callback = function()
    --         loadstring(game:HttpGet("https://raw.githubusercontent.com/Kanvret12/loli/refs/heads/main/aeradsasdasdsasd"))()
    --     end
    -- })

    MiscSection:AddToggle({
        Title = "No Clip",
        Content = "Enable/Disable No Clip",
        Default = false,
        Callback = function(state)
            task.spawn(function()
                toggleNoClip(state)
            end)
        end
    })

    

    local streamerModeEnabled = false
		local originalTexts = {}
		local replacementText = "SHIELD TEAM PROTECT"
		
		-- 🌈 Rainbow Effect
		local function RainbowColor()
			return Color3.fromHSV(tick() % 10 / 10, 1, 1)
		end
		
		-- Hapus Pakaian dan Rambut
		local function RemoveClothingAndHair(character)
			-- Hapus Shirt, Pants, dan ShirtGraphic (jika ada)
			for _, item in pairs(character:GetChildren()) do
				if item:IsA("Shirt") or item:IsA("Pants") or item:IsA("ShirtGraphic") then
					item:Destroy()
				end
			end
			
			-- Hapus semua aksesori rambut
			for _, accessory in pairs(character:GetChildren()) do
				if accessory:IsA("Accessory") then
					local handle = accessory:FindFirstChild("Handle")
					if handle then
						accessory:Destroy()
					end
				end
			end
		end
		
		local function makeCharacterBoxy(character)
			for _, part in ipairs(character:GetChildren()) do
				if part:IsA("MeshPart") or part:IsA("Part") then
					part.Size = Vector3.new(2, 2, 2) 
					part.Shape = Enum.PartType.Block
					part.Color = RainbowColor()
				end
			end
		end
		local function updateTextLabel(label)
			if streamerModeEnabled then
				if string.find(label.Text, LocalPlayer.Name) or string.find(label.Text, LocalPlayer.DisplayName) then
					label.Text = replacementText -- Ganti dengan teks proteksi
				end
			else
				-- Kembalikan teks asli jika streamer mode dinonaktifkan
				if originalTexts[label] then
					label.Text = originalTexts[label]
				end
			end
		end
		
		-- Update GUI jika Streamer Mode aktif
		local function updateGUITexts()
			local hudCoinsText = LocalPlayer.PlayerGui:FindFirstChild("hud") and LocalPlayer.PlayerGui.hud.safezone.coins
			local hudLevelText = LocalPlayer.PlayerGui:FindFirstChild("hud") and LocalPlayer.PlayerGui.hud.safezone.lvl
		
			if streamerModeEnabled then
				if hudCoinsText then
					hudCoinsText.Text = replacementText
				end
				if hudLevelText then
					hudLevelText.Text = replacementText
				end
			else
				if hudCoinsText and originalTexts["coins"] then
					hudCoinsText.Text = originalTexts["coins"]
				end
				if hudLevelText and originalTexts["level"] then
					hudLevelText.Text = originalTexts["level"]
				end
			end
		end
		
		local function toggleStreamerMode(state)
			streamerModeEnabled = state
			for _, obj in ipairs(game:GetDescendants()) do
				if obj:IsA("TextLabel") then
					updateTextLabel(obj)
				end
			end
			game.DescendantAdded:Connect(function(descendant)
				if descendant:IsA("TextLabel") then
					updateTextLabel(descendant)
				end
			end)
			updateGUITexts()
		
			-- Terapkan efek pada karakter player jika streamer mode aktif
			if streamerModeEnabled then
				-- Efek pada karakter yang sudah ada
				if LocalPlayer.Character then
					RemoveClothingAndHair(LocalPlayer.Character) -- Hapus pakaian dan rambut
					makeCharacterBoxy(LocalPlayer.Character) -- Ubah karakter menjadi kotak
				end
		
				-- Efek saat karakter spawn
				LocalPlayer.CharacterAdded:Connect(function(newCharacter)
					task.wait(1) -- Tunggu agar karakter ter-load dulu
					RemoveClothingAndHair(newCharacter) -- Hapus pakaian dan rambut
					makeCharacterBoxy(newCharacter) -- Ubah karakter menjadi kotak
				end)
			end
		end
		
		
		RunService.RenderStepped:Connect(function()
			if streamerModeEnabled then
				-- Update TextColor3 untuk teks
				local hudCoinsText = LocalPlayer.PlayerGui:FindFirstChild("hud") and LocalPlayer.PlayerGui.hud.safezone.coins
				local hudLevelText = LocalPlayer.PlayerGui:FindFirstChild("hud") and LocalPlayer.PlayerGui.hud.safezone.lvl
				if hudCoinsText then hudCoinsText.TextColor3 = RainbowColor() end
				if hudLevelText then hudLevelText.TextColor3 = RainbowColor() end
		
				-- Update warna tubuh player
				if LocalPlayer.Character then
					for _, part in ipairs(LocalPlayer.Character:GetChildren()) do
						if part:IsA("MeshPart") or part:IsA("Part") then
							part.Color = RainbowColor() -- Terapkan warna rainbow pada setiap part
							part.Size = Vector3.new(2, 2, 2) -- Mengubah ukuran menjadi kotak (tanpa merusak fungsionalitas)
						end
					end
				end
			end
		end)
    -- BOAT MODIFIER VARIABLES
    local BoatModEnabled = false
    local currentSpeedBoost = 5
    local currentAccelBoost = 3
    local currentTurnBoost = 2
    local monitoredBoats = {}

    -- Cleanup previous execution to prevent stacking
    if _G.BoatModifierCleanup then 
        _G.BoatModifierCleanup() 
    end

    _G.BoatModifierConnections = {}
    _G.BoatModifierCleanup = function()
        for _, conn in pairs(_G.BoatModifierConnections) do
            if conn then conn:Disconnect() end
        end
        _G.BoatModifierConnections = {}
        monitoredBoats = {}
    end

    local function applyBoatStatsOverride()
        local success, vessels = pcall(function() 
            return require(game:GetService("ReplicatedStorage").shared.modules.vessels) 
        end)
        if not success or not vessels then return end

        for boatName, boatData in pairs(vessels.library) do
            if not boatData._OriginalStats then
                boatData._OriginalStats = {
                    MaxSpeed = boatData.MaxSpeed,
                    Accel = boatData.Accel,
                    TurningSpeed = boatData.TurningSpeed
                }
            end

            if BoatModEnabled then
                if boatData.MaxSpeed then boatData.MaxSpeed = boatData._OriginalStats.MaxSpeed * currentSpeedBoost end
                if boatData.Accel then boatData.Accel = boatData._OriginalStats.Accel * currentAccelBoost end
                if boatData.TurningSpeed then boatData.TurningSpeed = boatData._OriginalStats.TurningSpeed * currentTurnBoost end
            else
                -- Restore
                if boatData.MaxSpeed then boatData.MaxSpeed = boatData._OriginalStats.MaxSpeed end
                if boatData.Accel then boatData.Accel = boatData._OriginalStats.Accel end
                if boatData.TurningSpeed then boatData.TurningSpeed = boatData._OriginalStats.TurningSpeed end
            end
        end
    end

    local function monitorBoat(boat)
        if not boat or not boat:IsA("Model") or monitoredBoats[boat] then return end
        monitoredBoats[boat] = true

        local primaryPart = boat.PrimaryPart or boat:FindFirstChild("Main")
        if not primaryPart then
            for _, child in pairs(boat:GetChildren()) do
                if child:IsA("BasePart") then
                    primaryPart = child
                    break
                end
            end
        end
        if not primaryPart then return end
        local conn = game:GetService("RunService").Heartbeat:Connect(function(deltaTime)
            if not BoatModEnabled then return end
            if not boat or not boat.Parent or not primaryPart.Parent then return end

            -- Force velocity boost
            local velocity = primaryPart.AssemblyLinearVelocity
            if velocity.Magnitude > 1 then
                local direction = velocity.Unit
                -- Use a slightly safer boost calculation to prevent infinite stacking in physics engine
                -- We apply force relative to base speed, capped at 500
                local boostFactor = 1 + (currentSpeedBoost - 1) * deltaTime * 5
                local newSpeed = velocity.Magnitude * boostFactor
                
                if newSpeed > 500 then newSpeed = 500 end
                
                primaryPart.AssemblyLinearVelocity = direction * newSpeed
            end

            -- Boost BodyMovers
            for _, obj in pairs(boat:GetDescendants()) do
                if obj:IsA("BodyVelocity") then
                    if obj.MaxForce.X < 1e6 then obj.MaxForce = Vector3.new(1e6, 1e6, 1e6) end
                elseif obj:IsA("BodyGyro") then
                    if obj.MaxTorque.X < 1e6 then obj.MaxTorque = Vector3.new(1e6, 1e6, 1e6) end
                elseif obj:IsA("VectorForce") then
                    if obj.Force.Magnitude > 0 then obj.Force = obj.Force * 1.05 end
                end
            end
        end)
        table.insert(_G.BoatModifierConnections, conn)
    end
    
    -- Global Watcher for new boats
    workspace.ChildAdded:Connect(function(child)
        if BoatModEnabled then
            task.wait(0.5)
            if child:IsA("Model") and (child.Name:lower():find("boat") or child.Name:lower():find("ship")) then
                monitorBoat(child)
            end
        end
    end)

    -- Initial Scan
    task.spawn(function()
        for _, child in pairs(workspace:GetChildren()) do
            if child:IsA("Model") and (child.Name:lower():find("boat") or child.Name:lower():find("ship")) then
                monitorBoat(child)
            end
        end
    end)

    SettingsSection:AddSeperator({
        Title = 'Boat Modifier',
    })
    

    SettingsSection:AddSlider({
        Title = "Speed Boost Multiplier",
        Description = "Multiplies max boat speed",
        Default = 5,
        Min = 1,
        Max = 20,
        Rounding = 1,
        Callback = function(val)
            currentSpeedBoost = val
            if BoatModEnabled then applyBoatStatsOverride() end
        end
    })

    SettingsSection:AddSlider({
        Title = "Accel Boost Multiplier",
        Description = "Multiplies boat acceleration",
        Default = 3,
        Min = 1,
        Max = 10,
        Rounding = 1,
        Callback = function(val)
            currentAccelBoost = val
            if BoatModEnabled then applyBoatStatsOverride() end
        end
    })

    SettingsSection:AddSlider({
        Title = "Turn Speed Multiplier",
        Description = "Multiplies turning speed",
        Default = 2,
        Min = 1,
        Max = 10,
        Rounding = 1,
        Callback = function(val)
            currentTurnBoost = val
            if BoatModEnabled then applyBoatStatsOverride() end
        end
    })
    SettingsSection:AddToggle({
        Title = "Boat Speed Modifier",
        Default = false,
        Callback = function(state)
            BoatModEnabled = state
            applyBoatStatsOverride()
        end
    })

    SettingsSection:AddToggle({
			Title = "Protect Identity",
			Value = false,
			Callback = function (value)
				task.spawn(function()
					toggleStreamerMode(value)
				end)
			end
		})
    SpamEnabled = false
    -- SettingsSection:AddToggle({
    --         Title = 'Dupe Bait Tryhard Worm',
    --         Content = 'U must clear minim 1 quest tryhard rod',
    --         Value = false,
    --         Callback = function(value)
    --             SpamEnabled = value

    --             if SpamEnabled then
    --                 print('started')
    --                 task.spawn(function()
    --                     while SpamEnabled do
    --                         task.wait(0)
    --                         args = { 1, 1 }
    --                         task.spawn(function()
    --                             for v= 1,10 do
    --                             pcall(function()
    --                             game:GetService('ReplicatedStorage'):WaitForChild('packages'):WaitForChild('Net'):WaitForChild('RF/DialogInteract'):InvokeServer(unpack(args))
    --                             end)
    --                         end
    --                         end)
    --                     end
    --                 end)
    --             end
    --         end,
    --     })
    SettingsSection:AddToggle({
        Title = "Delete All Map",
        Default = false,
        Callback = function(value)
            task.spawn(function()
                if value then
                    if workspace:FindFirstChild("world") and workspace.world:FindFirstChild("map") then
                        workspace.world.map:Destroy()
                    end
                end
            end)
        end
    })
    local DeleteAllCharsToggle = SettingsSection:AddToggle({
        Title = "Delete All Characters",
        Default = false,
        Callback = function(value)
            task.spawn(function()
                if value then
                    for _, obj in pairs(workspace:GetChildren()) do
                        if obj:IsA("Model") and obj:FindFirstChild("Humanoid") and obj ~= player.Character then
                            obj:Destroy()
                        end
                    end
                    for _, plr in pairs(game.Players:GetPlayers()) do
                        if plr ~= player and plr.Character then
                            plr.Character:Destroy()
                        end
                    end
                else
                    for _, plr in pairs(game.Players:GetPlayers()) do
                        if plr ~= player then
                            plr:LoadCharacter()
                        end
                    end
                end
            end)
        end
    })
    local function toggleSoloServer(state)
        if state then
            local gameId = game.PlaceId
            local httpService = game:GetService("HttpService")
            
            local success, result = pcall(function()
                return httpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..gameId.."/servers/Public?sortOrder=Asc&limit=100"))
            end)
            
            if success and result.data then
                local validServers = {}
                
                for _, server in ipairs(result.data) do
                    if server.playing == 1 and server.id ~= game.JobId then
                        -- Tambahkan server dengan 1 player ke list
                        table.insert(validServers, server)
                    end
                end
                
                if #validServers > 0 then
                    table.sort(validServers, function(a, b)
                        if a.maxPlayers ~= b.maxPlayers then
                            return a.maxPlayers > b.maxPlayers
                        end
                        return a.id < b.id
                    end)
                    local targetServer = validServers[1]
                    print("Found solo server! MaxPlayers: " .. targetServer.maxPlayers .. ", ID: " .. targetServer.id)
                    game:GetService("TeleportService"):TeleportToPlaceInstance(gameId, targetServer.id)
                    return
                else
                    warn("No solo servers found. Trying to find old empty server...")
                    local emptyServers = {}
                    for _, server in ipairs(result.data) do
                        if server.playing == 0 then
                            table.insert(emptyServers, server)
                        end
                    end
                    
                    if #emptyServers > 0 then
                        table.sort(emptyServers, function(a, b)
                            if a.maxPlayers ~= b.maxPlayers then
                                return a.maxPlayers > b.maxPlayers
                            end
                            return a.id < b.id
                        end)
                        
                        local targetServer = emptyServers[1]
                        print("Found old empty server! MaxPlayers: " .. targetServer.maxPlayers .. ", ID: " .. targetServer.id)
                        game:GetService("TeleportService"):TeleportToPlaceInstance(gameId, targetServer.id)
                        return
                    end
                    
                    warn("No suitable servers found.")
                end
            else
                warn("Failed to fetch server list")
            end
        else
            print("Solo server feature disabled")
        end
    end
    local function findOldSoloServer()
        local gameId = game.PlaceId
        local httpService = game:GetService("HttpService")
        for page = 0, 2 do
            local cursor = page > 0 and "&cursor=" .. (page * 100) or ""
            local url = "https://games.roblox.com/v1/games/"..gameId.."/servers/Public?sortOrder=Asc&limit=100" .. cursor
            
            local success, result = pcall(function()
                return httpService:JSONDecode(game:HttpGet(url))
            end)
            
            if success and result.data then
                for _, server in ipairs(result.data) do
                    if server.playing == 1 and server.id ~= game.JobId then
                        if server.maxPlayers >= 25 then
                            print("Found old solo server! Page: " .. page .. ", MaxPlayers: " .. server.maxPlayers)
                            game:GetService("TeleportService"):TeleportToPlaceInstance(gameId, server.id)
                            return true
                        end
                    end
                end
            end
            wait(0.5)
        end
        
        return false
    end

    SettingsSection:AddToggle({
        Title = "Join Lowest Server",
        Content = "Join Lowest Player Server",
        Default = false,
        Callback = function(state)
            if state then
                spawn(function()
                    if not findOldSoloServer() then
                        toggleSoloServer(true)
                    end
                end)
            end
        end
    })
    local playerCheckConnection = nil
    local rejoinCooldown = false

    local function rejoinServer()
        if rejoinCooldown then return end
        rejoinCooldown = true
        wait(2)
        spawn(function()
            if not findOldSoloServer() then
                toggleSoloServer(true)
            end
        end)
        wait(5)
        rejoinCooldown = false
    end

    local function startPlayerDetection()
        if playerCheckConnection then
            playerCheckConnection:Disconnect()
        end
        
        playerCheckConnection = game:GetService("RunService").Heartbeat:Connect(function()
            if _G.Config.playerDetectionEnabled then
                local playerCount = #game.Players:GetPlayers()
                
                if playerCount >= 3 then
                    print("Player count: " .. playerCount .. " - Initiating rejoin...")
                    playerCheckConnection:Disconnect()
                    toggleSoloServer(true)
                end
            end
        end)
    end

    local function stopPlayerDetection()
        if playerCheckConnection then
            playerCheckConnection:Disconnect()
            playerCheckConnection = nil
        end
    end

    local function togglePlayerDetection(state)
        _G.Config.playerDetectionEnabled = state
        if state then
            print("Player detection enabled - Will rejoin if 3+ players join")
            startPlayerDetection()
            game.Players.PlayerAdded:Connect(function(player)
                if _G.Config.playerDetectionEnabled then
                    wait(1)
                    local playerCount = #game.Players:GetPlayers()
                    print("New player joined: " .. player.Name .. " | Total players: " .. playerCount)
                    
                    if playerCount >= 3 then
                        toggleSoloServer(true)
                    end
                end
            end)
        else
            print("Player detection disabled")
            stopPlayerDetection()
        end
    end

    SettingsSection:AddToggle({
        Title = "Auto Rejoin (3+ Players)",
        Content = "Automatically rejoin when 3 or more players are detected",
        Default = _G.Config.playerDetectionEnabled,
        Callback = function(state)
            task.spawn(function()
                togglePlayerDetection(state)
            end)
        end
    })
    SettingsSection:AddToggle({
        Title = "Auto Save Config",
        Content = "Save configuration using while loop",
        Default = _G.Config.AutoSaveConfig or false,
        Callback = function(state)
            _G.Config.AutoSaveConfig = state
            
            if state then
                autoSaveEnabled = true                
                autoSaveConnection = spawn(function()
                    while autoSaveEnabled and _G.Config.AutoSaveConfig do
                        manualSaveConfig()
                        wait(saveInterval)
                        if not autoSaveEnabled or not _G.Config.AutoSaveConfig then
                            break
                        end
                    end
                    print("[Auto Save] While loop stopped")
                end)
            else
                autoSaveEnabled = false
                manualSaveConfig()
                if autoSaveConnection then
                    autoSaveConnection = nil
                end
            end
        end
    })
    

    RodDropdown = nil
    ShopItem:AddDropdown({
        Title = "Select a Rod",
        Content = "Choose a fishing rod from the shop to purchase.", 
        Options = rodNames,
        Multi = false,
        Default = nil,
        Callback = function(value)
            RodDropdown = value
        end
    })
    
    ShopItem:AddButton({
        Title = "Buy Selected Rod",
        Content = "Click this button to purchase the selected fishing rod.", 
        Callback = function()
             selectedRod = RodDropdown
            if selectedRod then
                local args = {
                    selectedRod,
                    "Rod",
                    [4] = 1
                }
                event:FireServer(unpack(args))
            else
                warn("No Rod selected!")
            end
        end
    })
    -- local selectedMerlin = "Enchant Relic" -- Default value
    -- local MerlinDropdown = Merlin:AddDropdown({
    --     Title = "Merlin Magic",
    --     Content = "Select a magic option to purchase",
    --     Options = {"Enchant Relic", "Luck"},
    --     Multi = false,
    --     Default = selectedMerlin,
    -- })

    -- Merlin:AddButton({
    --     Title = "Purchase - Merlin",
    --     Content = "Click this button to purchase the selected item.",
    --     Callback = function()
    --         local selection = selectedMerlin -- Get value directly from dropdown object
    --         print("Attempting to purchase:", selection)
            
    --         if selection == "Enchant Relic" then
    --             workspace:WaitForChild("world"):WaitForChild("npcs"):WaitForChild("Merlin"):WaitForChild("Merlin"):WaitForChild("power"):InvokeServer()
    --         elseif selection == "Luck" then
    --             game:GetService("ReplicatedStorage").events.purchase:FireServer("Luck", "Item", nil, 1)
    --             workspace:WaitForChild("world"):WaitForChild("npcs"):WaitForChild("Merlin"):WaitForChild("Merlin"):WaitForChild("luck"):InvokeServer()
    --         else
    --             print("No valid selection")
    --         end
    --     end
    -- })
    
    local function getFishingFolder()
        return ReplicatedStorage:FindFirstChild("resources")
            and ReplicatedStorage.resources:FindFirstChild("sounds")
            and ReplicatedStorage.resources.sounds:FindFirstChild("sfx")
            and ReplicatedStorage.resources.sounds.sfx:FindFirstChild("fishing")
    end
    local function restoreFishingFolder()
        local resources = ReplicatedStorage:FindFirstChild("resources") or Instance.new("Folder", ReplicatedStorage)
        resources.Name = "resources"
        local sounds = resources:FindFirstChild("sounds") or Instance.new("Folder", resources)
        sounds.Name = "sounds"
    
        local sfx = sounds:FindFirstChild("sfx") or Instance.new("Folder", sounds)
        sfx.Name = "sfx"
    
        local fishingFolder = sfx:FindFirstChild("fishing") or Instance.new("Folder", sfx)
        fishingFolder.Name = "fishing"
    
        print("Fishing folder restored successfully.")
    end
    
    local BoostFpsToggle = SettingsSection:AddToggle({ 
        Title = "Boost FPS", 
        Default = false,
        Callback = function(value)
            task.spawn(function()
                BoostFpsFunc(value)
            end)
        end
    })
    Appraise = false
		local trackedItems = {}

		local function getCurrentBackpackItems()
			local items = {}
			local backpack = LocalPlayer:FindFirstChild("Backpack")
			if backpack then
				for _, item in pairs(backpack:GetChildren()) do
					if item:IsA("Tool") then
						items[item.Name] = true
					end
				end
			end
			return items
		end

		local function autoEquipNewItem(item)
			if item:IsA("Tool") then
				local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
				if humanoid then
					humanoid:EquipTool(item)
					print("[AUTO EQUIP] Equipped:", item.Name)
				end
			end
		end
		local selectAppraise = {}
		local selectAppraise1 = {}
		local appraiseOptions = {
            "Mourned",
            "Fallen",
            "Coral",
            "Spooky",
            "Frightful",
            "Vined",
            "Poisoned",
            "Shrouded",
			"Spirit",
			"Beachy",
			"Popsicle",
			"Summer", 
			"Mythical",
			"Greedy",
			"Abyssal",
			"Fossilized",
			"Lunar",
			"Midas",
			"Sparkling",
			"Shiny",
			"Glossy",
			"Silver",
			"Mosaic",
			"Hexed",
			"Electric",
			"Crimson",
			"Festive",
			"Jolly",
			"Scorched",
			"Darkened",
			"Translucent",
			"Frozen",
			"Negative",
			"Albino",
			"Amber",
			"Big",
			"Giant"
		}
		AutoAppraise:AddDropdown({
			Title = "Select Multi Appraise",
            Content = "Select a multi appraise",
            Options = appraiseOptions,
            Multi = true,
            Default ={ "None"},
            Callback = function(v)
				selectAppraise = v
			end
		})
		
		AutoAppraise:AddToggle({
			Title = "Auto Appraise on held",
			Default = false,
			Callback = function(value)
				Appraise = value
                task.spawn(function()
                    local player = game.Players.LocalPlayer
                    local DialogInteract = game:GetService("ReplicatedStorage").packages.Net["RF/DialogInteract"]

                    if value then
                        local char = player.Character or player.CharacterAdded:Wait()
                        local hrp = char:WaitForChild("HumanoidRootPart")
                        local appraiser = workspace.world.npcs:WaitForChild("Appraiser")
                        local appraiserHRP = appraiser:WaitForChild("HumanoidRootPart")
                        hrp.CFrame = CFrame.new(
                            448.786102, 150.529297, 206.834045,
                            -0.617013216, 6.03e-08, -0.786952794,
                            5.42e-08, 1, 3.40e-08,
                            0.786952794, -2.16e-08, -0.617013216
                        )
                        task.wait(0.2)

                        if appraiserHRP then
                            FireProximity(appraiser.ProximityPrompt)
                            DialogInteract:InvokeServer(6, 1)
                        end

                        trackedItems = getCurrentBackpackItems and getCurrentBackpackItems() or {}
                        local backpack = player:FindFirstChild("Backpack")
                        local connection
                        if backpack then
                            connection = backpack.ChildAdded:Connect(function(newItem)
                                if Appraise and newItem:IsA("Tool") then
                                    task.wait(0.7)
                                    autoEquipNewItem(newItem)
                                end
                            end)
                        end
                        task.spawn(function()
                            local hotbar = player.PlayerGui.backpack.hotbar
                            local inventory = player.PlayerGui.backpack.inventory.itemContainer

                            while Appraise do
                                task.wait(0.3)

                                local function checkItemsInContainer(container, containerName)
                                    for _, child in ipairs(container:GetChildren()) do
                                        local stroke = child:FindFirstChildOfClass("UIStroke")
                                        if stroke and stroke.Color == Color3.fromRGB(255, 255, 255) then
                                            local text = child.ItemName.Text
                                            for _, keyword in ipairs(selectAppraise or {}) do
                                                if string.find(string.lower(text), string.lower(keyword)) then
                                                    print("[DEBUG] Teks mengandung:", keyword, "di", containerName, "-> Auto Appraise dimatikan")
                                                    return true
                                                end
                                            end
                                        end
                                    end
                                    return false
                                end
                                if checkItemsInContainer(hotbar, "hotbar") then
                                    Appraise = false
                                    break
                                elseif checkItemsInContainer(inventory, "inventory") then
                                    Appraise = false
                                    break
                                else
                                    DialogInteract:InvokeServer(1, 1)
                                    DialogInteract:InvokeServer(6, 1)
                                end
                            end
                            if connection then
                                connection:Disconnect()
                                print("[DEBUG] Backpack connection disconnected")
                            end
                        end)

                    else
                        trackedItems = {}
                        print("[DEBUG] Auto Appraise disabled, cleared tracked items")
                    end
                end)
			end
		})


		local Players = game:GetService("Players")
		local player = Players.LocalPlayer
		local backpack = player:WaitForChild("Backpack")

		local function buildAppraiseOptions()
			local counts = {}
			local options = {}
			for _, tool in ipairs(backpack:GetChildren()) do
				local name = tool.Name
				counts[name] = (counts[name] or 0) + 1
			end
			for name, count in pairs(counts) do
				local display = name
				if count > 1 then
					display = string.format("%s [%dx]", name, count)
				end
				table.insert(options, {Display = display, Value = name})
			end

			return options
		end

		local function refreshDropdown(dropdown)
			local opts = buildAppraiseOptions()
			local values = {}
			for _, opt in ipairs(opts) do
				table.insert(values, opt.Display)
			end

			dropdown:Refresh(values)
			dropdown.ItemMap = {}
			for _, opt in ipairs(opts) do
				dropdown.ItemMap[opt.Display] = opt.Value
			end
		end
		local dropdown

		dropdown = AutoAppraise:AddDropdown({
			Title = "Select Fisch Appraise",
			Multi = true, 
			Options = {},
			Callback = function(v)
				if type(v) == "table" then
					selectAppraise1 = {}
					for _, picked in ipairs(v) do
						table.insert(selectAppraise1, dropdown.ItemMap[picked] or picked)
					end
					print("Selected:", table.concat(selectAppraise1, ", "))
				else
					selectAppraise1 = dropdown.ItemMap[v] or v
					print("Selected:", selectAppraise1)
				end
			end
		})
        refreshDropdown(dropdown)

		local appraiseConnection = nil
		local appraiseLoops = {}
		local appraiseNext = false 
		appraise = AutoAppraise:AddToggle({
			Title = "Auto Appraise All Selected Fisch",
			Default = false,
			Callback = function(value)
				Appraise = value
                task.spawn(function()
                    if value then
                        local player = game.Players.LocalPlayer
                        local backpack = player:WaitForChild("Backpack")
                        local char = player.Character or player.CharacterAdded:Wait()
                        local DialogInteract = game:GetService("ReplicatedStorage").packages.Net["RF/DialogInteract"]

                        local function equipAllMatchingItems()
                            for _, tool in ipairs(backpack:GetChildren()) do
                                if tool:IsA("Tool") then
                                    for _, keyword in ipairs(selectAppraise1 or {}) do
                                        if string.find(string.lower(tool.Name), string.lower(keyword)) then
                                            autoEquipNewItem(tool)
                                            task.wait()
                                        end
                                    end
                                end
                            end
                        end
                        equipAllMatchingItems()
                        local player = game.Players.LocalPlayer
                        local DialogInteract = game:GetService("ReplicatedStorage").packages.Net["RF/DialogInteract"]

                        if value then
                            local char = player.Character or player.CharacterAdded:Wait()
                            local hrp = char:WaitForChild("HumanoidRootPart")
                            local appraiser = workspace.world.npcs:WaitForChild("Appraiser")
                            local appraiserHRP = appraiser:FindFirstChild("HumanoidRootPart")
                            hrp.CFrame = CFrame.new(
                                448.786102, 150.529297, 206.834045,
                                -0.617013216, 6.03e-08, -0.786952794,
                                5.42e-08, 1, 3.40e-08,
                                0.786952794, -2.16e-08, -0.617013216
                            )
                            task.wait(0.2)

                            if appraiserHRP then
                                FireProximity(appraiser.ProximityPrompt)
                                DialogInteract:InvokeServer(6, 1)
                            end

                            trackedItems = getCurrentBackpackItems and getCurrentBackpackItems() or {}
                            local backpack = player:FindFirstChild("Backpack")
                            local connection
                            if backpack then
                                connection = backpack.ChildAdded:Connect(function(newItem)
                                    if Appraise and newItem:IsA("Tool") then
                                        task.wait(0.7)
                                        autoEquipNewItem(newItem)
                                    end
                                end)
                            end
                            task.spawn(function()
                                local hotbar = player.PlayerGui.backpack.hotbar
                                local inventory = player.PlayerGui.backpack.inventory.itemContainer

                                while Appraise do
                                    task.wait(0.2)

                                    local function checkItemsInContainer(container, containerName)
                                        for _, child in ipairs(container:GetChildren()) do
                                            local stroke = child:FindFirstChildOfClass("UIStroke")
                                            if stroke and stroke.Color == Color3.fromRGB(255, 255, 255) then
                                                local text = child.ItemName.Text
                                                for _, keyword in ipairs(selectAppraise or {}) do
                                                    if string.find(string.lower(text), string.lower(keyword)) then
                                                        print("[DEBUG] Teks mengandung:", keyword, "di", containerName, "-> Auto Appraise dimatikan")
                                                        return true
                                                    end
                                                end
                                            end
                                        end
                                        return false
                                    end
                                    if checkItemsInContainer(hotbar, "hotbar") then
                                        appraiseNext = true
                                        break
                                    elseif checkItemsInContainer(inventory, "inventory") then
                                        appraiseNext = true
                                        break
                                    else
                                        DialogInteract:InvokeServer(1, 1)
                                        DialogInteract:InvokeServer(6, 1)
                                    end
                                end
                                if connection then
                                    connection:Disconnect()
                                    print("[DEBUG] Backpack connection disconnected")
                                end
                            end)

                        else
                            trackedItems = {}
                            print("[DEBUG] Auto Appraise disabled, cleared tracked items")
                        end
                    end
                end)
			end
		})
		task.spawn(function()
			while true do
				task.wait(0.1)
				if appraiseNext then
					appraise:SetValue(true) 
					appraiseNext = false 
					Appraise = true
				end
			end
		end)
    whileEnchant = false
    targetEnc = {}
    local enchanList = {
        "Frightful",
        "Blessed Song",
        "Sea King",
        "Swift",
        "Long",
        "Ghastly",
        "Lucky",
        "Divine",
        "Mutated",
        "Unbreakable",
        "Steady",
        "Blessed",
        "Wormhole",
        "Resilient",
        "Controlled",
        "Storming",
        "Scrapper",
        "Breezed",
        "Insight",
        "Clever",
        "Noir",
        "Hasty",
        "Quality",
        "Abyssal",
        "Herculean",
        "Mystical",
        "Quantum",
        "Invincible",
        "Piercing",
        "Anomalous",
        "Sea Overlord",
        "Immortal",
        "Flashline",
        "Scavenger",
        "Chaotic",
        "Blood Reckoning",
        "Chronos",
        "Momentum",
        "Overclocked",
        "Tenacity",
        "Tryhard",
        "Wise",
        "Cryogenic",
        "Sea Prince",
        "Glittered"
    }

    AutoEnchant:AddDropdown({
        Title = "Select Multi Enchant",
        Content = "Select a multi Enchant",
        Options = enchanList,
        Default = {"None"},
        Multi = true,
        Callback = function(v)
            targetEnc = v
        end
    })
    local function hasSameEnchant()
        local playerGui = player:FindFirstChild("PlayerGui")
		local RodName = workspace.PlayerStats[LocalPlayer.Name].T[LocalPlayer.Name].Stats.rod.Value
		local enchantContainer = game:GetService("Players").LocalPlayer.PlayerGui.hud.safezone.equipment.rods.scroll.safezone[RodName].rod.enchants

		for _, v in pairs(enchantContainer:GetChildren()) do
			if v:IsA("TextLabel") or v:IsA("TextButton") then
				for _, iv in pairs(targetEnc) do
					if string.find(v.Text, iv) then
						return true
					end
				end
			end
		end
		return false
    end

    AutoEnchant:AddToggle({
        Title = "Auto Enchant", 
        Default = false,
        Callback = function(value)
            whileEnchant = value
            task.spawn(function()
                local enchant = game:GetService("ReplicatedStorage"):WaitForChild("events"):WaitForChild("enchant")
                enchant.OnClientInvoke = function()
                    return true
                end
                if value then
                    local hrp = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        hrp.CFrame = CFrame.new(1310.5, -799.4, -82.7) * CFrame.new(0, 0, -5)
                    end
                    task.spawn(function()
                        while whileEnchant do
                            local cycleObj = 
                                game:GetService("ReplicatedStorage"):FindFirstChild("world") and
                                game:GetService("ReplicatedStorage").world:FindFirstChild("cycle")
                            local cycle = cycleObj and cycleObj.Value or nil
                            task.wait(0.3)
                            if cycle == "Night" then
                                task.wait(0.5)
                                if hasSameEnchant() then
                                    print('tesssssssssssssss')
                                    break
                                end
                                local altar = workspace:WaitForChild("world"):WaitForChild("interactables"):WaitForChild("Enchant Altar")
                                if altar and altar:FindFirstChild("PromptTemplate") then
                                    local prompt = altar and altar:FindFirstChildWhichIsA("ProximityPrompt", true)
                                    pcall(function()
                                        fireproximityprompt(prompt)
                                    end)
                                    task.wait(0.1)
                                end
                            end
                        end
                    end)
                end
            end)
        end
    })
    Net = ReplicatedStorage:WaitForChild('packages'):WaitForChild('Net')
    EventAppraiseGui = LocalPlayer.PlayerGui:WaitForChild('EventAppraise')
    AppraiseUI = EventAppraiseGui.EventAppraise

    StartAppraise = Net:WaitForChild('RE/EventAppraiseService/StartAppraise')
    RequestUI = Net:WaitForChild('RE/EventAppraiseService/RequestAppraiseUI')
    TakeNow = Net:WaitForChild('RE/EventAppraiseService/TakeNow')
    SelectIndex = Net:WaitForChild('RF/EventAppraiseService/SelectIndex')

    TOTAL_ROWS = 7
    SLOTS_PER_ROW = 3
    SelectedTreasure = 'Big'
    AutoAppraiseActive = false
    mutationFilters = { 'Big', 'Giant' }

    function AutoSelectRow(rowIndex)
        startSlot = (rowIndex - 1) * SLOTS_PER_ROW + 1
        endSlot = startSlot + SLOTS_PER_ROW - 1

        for slot = startSlot, endSlot do
            local success, result = pcall(function()
                return SelectIndex:InvokeServer(slot)
            end)
            if success and result then
                print(
                    string.format(
                        '[AutoAppraise] Row %d, Slot %d selected: %s',
                        rowIndex,
                        slot,
                        tostring(result)
                    )
                )
                break
            end
        end
    end

    function WaitForAppraiseItems(timeout)
        timeout = timeout or 5
        local timer = 0
        repeat
            local ready = true
            for _, child in ipairs(AppraiseUI.List:GetChildren()) do
                local itemName = child:FindFirstChild('ItemName')
                if not itemName or itemName.Text == '' then
                    ready = false
                    break
                end
            end
            if ready and #AppraiseUI.List:GetChildren() > 0 then
                break
            end
            task.wait(0.1)
            timer = timer + 0.1
        until timer >= timeout
    end

    function CheckMutationsInventory()
        local player = Players.LocalPlayer
        local hotbar =
            player.PlayerGui:WaitForChild('backpack'):WaitForChild('hotbar')
        local inventory = player.PlayerGui.backpack
            :WaitForChild('inventory')
            :WaitForChild('itemContainer')

        local function checkContainer(container, name)
            for _, child in ipairs(container:GetChildren()) do
                local stroke = child:FindFirstChildOfClass('UIStroke')
                if
                    stroke
                    and stroke.Color == Color3.fromRGB(255, 255, 255)
                    and child:FindFirstChild('ItemName')
                then
                    local text = child.ItemName.Text
                    if string.find(string.lower(text), string.lower(SelectedTreasure)) then
                        AutoAppraiseActive = false
                        return true
                    end
                end
            end
            return false
        end

        return checkContainer(hotbar, 'hotbar')
            or checkContainer(inventory, 'inventory')
    end

    function CheckMutationUI(filter)
        WaitForAppraiseItems(1)
        for _, child in ipairs(AppraiseUI.List:GetChildren()) do
            local itemName = child:FindFirstChild('ItemName')
            if itemName and itemName.Text ~= '' then
                if
                    string.find(string.lower(itemName.Text), string.lower(filter))
                then
                    AutoAppraiseActive = false
                    return true
                end
            end
        end
        return false
    end

    function StartAutoAppraise(filter)
        if CheckMutationsInventory() then
            return
        end

        RequestUI:FireServer()
        task.wait(0.3)
        StartAppraise:FireServer()
        task.wait(0.5)

        for row = 1, TOTAL_ROWS do
            if not AutoAppraiseActive then
                break
            end
            AutoSelectRow(row)
            task.wait(0.1)
            if CheckMutationsInventory() then
                return
            end
        end

        if not AutoAppraiseActive then
            return
        end
        if CheckMutationUI(filter) then
            return
        end

        TakeNow:FireServer()
        print('[AutoAppraise] Appraise completed for filter:', filter)
    end
    AutosJack:AddButton({
        Title = 'Teleport to Jack Marrow',
        Callback = function()
            local lp = game.Players.LocalPlayer
            if lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") then
                lp.Character.HumanoidRootPart.CFrame = CFrame.new(-2826, 215, 1518)
            end
        end,
    })
    AutosJack:AddButton({
        Title = 'Repair Map',
        Callback = function()
            for i, v in pairs(game.Players.LocalPlayer.Backpack:GetChildren()) do
                if v.Name == 'Treasure Map' then
                    game.Players.LocalPlayer.Character.Humanoid:EquipTool(v)
                    workspace.world.npcs['Jack Marrow'].treasure.repairmap:InvokeServer()
                end
            end
        end,
    })
    AutosJack:AddButton({
        Title = 'Collect Treasure',
        Callback = function()
            for i, v in ipairs(game:GetService('Workspace'):GetDescendants()) do
                if v.ClassName == 'ProximityPrompt' then
                    v.HoldDuration = 0
                end
            end
            for i, v in pairs(workspace.world.chests:GetDescendants()) do
                if v:IsA('Part') and v:FindFirstChild('ChestSetup') then
                    game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame =
                        v.CFrame
                    for _, v in pairs(workspace.world.chests:GetDescendants()) do
                        if v.Name == 'ProximityPrompt' then
                            fireproximityprompt(v)
                        end
                    end
                    task.wait(1)
                end
            end
        end,
    })
    AutosAppraise:AddDropdown({
        Title = 'Select Appraise Treasure',
        Multi = false,
        Options = { 'Big', 'Giant' },
        Default = 'Big',
        Callback = function(selection)
            SelectedTreasure = selection
            print('[AutoAppraise] Filter changed to:', selection)
        end,
    })

    AutosAppraise:AddToggle({
        Title = 'Auto Treasure Appraise',
        Value = false,
        Callback = function(value)
            AutoAppraiseActive = value
            if value then
                task.spawn(function()
                    while AutoAppraiseActive do
                        StartAutoAppraise(SelectedTreasure)
                        task.wait(1)
                    end
                end)
            end
        end,
    })
    AutosQuest:AddSeperator({
    Title = 'Quest Angler',
})
    local isFrozen1 = false
    local isFrozen1 = false
local frozenPosition1
local freezeBlock
local Area = {
    { NAME = 'None', CFrame = nil },
    {
        NAME = 'Forsaken Veil',
        CFrame = CFrame.new(-2418.1167, -11223.5098, 7033.7627),
    },
    {
        NAME = 'Antlean Storm',
        CFrame = CFrame.new(-3665.85889, 141.195038, 738.876343),
    },
    {
        NAME = 'Podium 3',
        CFrame = CFrame.new(
            -13589.2578,
            -11050.2227,
            71.2485275,
            -0.0684822872,
            8.76760069e-08,
            0.997652352,
            5.31155342e-09,
            1,
            -8.75177264e-08,
            -0.997652352,
            -6.94330093e-10,
            -0.0684822872
        ),
    },
}
-- Fungsi untuk Membuat Blok di Bawah Kaki
local function createFreezeBlock(position)
    if freezeBlock then
        freezeBlock:Destroy()
    end

    freezeBlock = Instance.new('Part')
    freezeBlock.Size = Vector3.new(10, 1, 10)
    freezeBlock.Position = position - Vector3.new(0, 3, 0)
    freezeBlock.Anchored = true
    freezeBlock.Transparency = 1
    freezeBlock.CanCollide = true
    freezeBlock.Parent = game.Workspace
end

local previousLocation = nil
local teleportSpots = { 'None' }
local teleportData = {}

local function getTpSpots()
    local world = Workspace:WaitForChild('world', 5)
    local spawns = world and world:WaitForChild('spawns', 5)
    local TpSpotsFolder = spawns and spawns:WaitForChild('TpSpots', 5)

    if not TpSpotsFolder then
        return { 'None' }
    end

    local spots = {}
    local children = TpSpotsFolder:GetChildren()
    for _, spot in pairs(children) do
        if spot:IsA('Part') or spot:IsA('CFrameValue') then
            table.insert(spots, spot.Name)
            if spot:IsA('Part') then
                teleportData[spot.Name] = spot.CFrame
            elseif spot:IsA('CFrameValue') then
                teleportData[spot.Name] = spot.Value
            end
        end
    end
    table.sort(spots)
    table.insert(spots, 1, 'None')
    return spots
end
local function teleportTo(areaName)
    local Character = LocalPlayer.Character
    if not Character then
        return
    end

    local HumanoidRootPart = Character:FindFirstChild('HumanoidRootPart')
    if not HumanoidRootPart then
        return
    end
    if areaName == 'None' and previousLocation then
        HumanoidRootPart.CFrame = previousLocation
        return
    end
    local targetCFrame = teleportData[areaName]
    if targetCFrame then
        previousLocation = HumanoidRootPart.CFrame
        HumanoidRootPart.CFrame = targetCFrame
    else
    end
end
local RunService = game:GetService('RunService')
local Players = game:GetService('Players')
local LocalPlayer = Players.LocalPlayer

local isFrozen1 = false

local function FreezeCharacter1(state)
    local Character = LocalPlayer.Character
    if not Character then
        return
    end

    local HumanoidRootPart = Character:FindFirstChild('HumanoidRootPart')
    local Humanoid = Character:FindFirstChildOfClass('Humanoid')
    if not HumanoidRootPart or not Humanoid then
        return
    end

    local basePart
    local rowboat
    local active = workspace:FindFirstChild('active')

    if active then
        local boats = active:FindFirstChild('boats')
        if boats then
            local playerBoat = boats:FindFirstChild(LocalPlayer.Name)
            if playerBoat then
                rowboat = playerBoat:FindFirstChild('Rowboat')
                if rowboat then
                    basePart = rowboat:FindFirstChild('HitBox')
                end
            end
        end
    end

    if not basePart then
        warn('⚠️ Tidak ditemukan part HitBox di lokasi yang disebut.')
        return
    end

    if state then
        isFrozen1 = true

        task.spawn(function()
            while isFrozen1 and basePart and basePart.Parent do
                local partTopY = basePart.Position.Y + basePart.Size.Y / 2
                local targetPos = Vector3.new(
                    basePart.Position.X,
                    partTopY + 2,
                    basePart.Position.Z
                )
                local targetCFrame = CFrame.new(targetPos)
                HumanoidRootPart.CFrame = targetCFrame

                for _, part in ipairs(rowboat:GetDescendants()) do
                    if part:IsA('BasePart') then
                        part.Velocity = Vector3.zero
                        part.RotVelocity = Vector3.zero
                    end
                end

                RunService.Heartbeat:Wait()
            end
        end)
    else
        isFrozen1 = false
    end
end
local function getFishingZones()
    local zones = Workspace:WaitForChild('zones', 5)
    local FishingZonesFolder = zones and zones:FindFirstChild('fishing', 5)
    if not FishingZonesFolder then
        return { 'None' }
    end
    local spots = {}
    local zonesData = {}
    local children = FishingZonesFolder:GetChildren()
    for _, spot in pairs(children) do
        if spot:IsA('Part') then
            if not zonesData[spot.Name] then
                zonesData[spot.Name] = {}
                table.insert(spots, spot.Name)
            end
            table.insert(zonesData[spot.Name], spot)
        end
    end

    table.sort(spots)
    table.insert(spots, 1, 'None')
    local sortedZonesData = {}
    for _, name in ipairs(spots) do
        if zonesData[name] then
            sortedZonesData[name] = zonesData[name]
        end
    end

    return spots, sortedZonesData
end

local function RemoveRocks()
    task.spawn(function()
        pcall(function()
            local radius = 30
            local Character = LocalPlayer.Character
            local root = Character and Character:FindFirstChild("HumanoidRootPart")
            
            if root then
                 -- Define what we MUST NOT destroy
                 local criticalFolders = {
                    workspace:FindFirstChild("zones"),
                    workspace:FindFirstChild("active"), -- Boats usually here
                    Character,
                    workspace.Terrain
                 }
                 
                 local overlapParams = OverlapParams.new()
                 overlapParams.FilterDescendantsInstances = criticalFolders
                 overlapParams.FilterType = Enum.RaycastFilterType.Exclude

                 -- Check multiple times to clear potential clusters
                 for i=1,5 do
                     local parts = workspace:GetPartBoundsInRadius(root.Position, radius, overlapParams)
                     if #parts == 0 then break end
                     
                     for _, part in ipairs(parts) do
                         if part:IsA("BasePart") then
                             local isCritical = false
                             for _, crit in ipairs(criticalFolders) do
                                 if crit and part:IsDescendantOf(crit) then
                                     isCritical = true
                                     break
                                 end
                             end
                             
                             if not isCritical then
                                 if part:IsDescendantOf(workspace) then
                                    part:Destroy()
                                 end
                             end
                         end
                     end
                     task.wait(0.1)
                 end
            end
        end)
    end)
end

local noclipConnection = nil
local function EnableNoclip()
    if noclipConnection then return end
    local RunService = game:GetService("RunService")
    noclipConnection = RunService.Stepped:Connect(function()
        local Character = LocalPlayer.Character
        if Character then
            for _, part in ipairs(Character:GetDescendants()) do
                if part:IsA("BasePart") and part.CanCollide then
                    part.CanCollide = false
                end
            end
        end
    end)
end

local function DisableNoclip()
    if noclipConnection then
        noclipConnection:Disconnect()
        noclipConnection = nil
    end
end

local function teleportToFishingZone(zoneName)
    local Character = LocalPlayer.Character
    if not Character then
        return
    end

    local HumanoidRootPart = Character:FindFirstChild('HumanoidRootPart')
    if not HumanoidRootPart then
        return
    end

    local zones = Workspace:WaitForChild('zones', 1)
    local FishingZonesFolder = zones and zones:FindFirstChild('fishing', 1)
    if not FishingZonesFolder then
        return
    end

    if zoneName == 'None' and previousLocation then
        HumanoidRootPart.CFrame = previousLocation
        FreezeCharacter1(false)
        return
    end

    local _, zonesData = getFishingZones()

    if zoneName == 'Crystal Cove' then
        previousLocation = HumanoidRootPart.CFrame
        local player = game.Players.LocalPlayer
        local boat
        repeat
            boat = workspace:FindFirstChild('active')
                and workspace.active:FindFirstChild('boats')
                and workspace.active.boats:FindFirstChild(player.Name)
                and workspace.active.boats[player.Name]:FindFirstChild(
                    'Rowboat'
                )
            if not boat then
                local Character = LocalPlayer.Character
                local HumanoidRootPart =
                    Character:FindFirstChild('HumanoidRootPart')
                HumanoidRootPart.CFrame = CFrame.new(362, 134, 259)
                task.wait(0.5)
                local args = {
                    {
                        voice = 8,
                        idle = workspace
                            :WaitForChild('world')
                            :WaitForChild('npcs')
                            :WaitForChild('Moosewood Shipwright')
                            :WaitForChild('description')
                            :WaitForChild('idle'),
                        npc = workspace
                            :WaitForChild('world')
                            :WaitForChild('npcs')
                            :WaitForChild('Moosewood Shipwright'),
                    },
                }
                workspace
                    :WaitForChild('world')
                    :WaitForChild('npcs')
                    :WaitForChild('Moosewood Shipwright')
                    :WaitForChild('shipwright')
                    :WaitForChild('giveUI')
                    :InvokeServer(unpack(args))
                task.wait(0.2)
                local args = {
                    'Rowboat',
                }
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RF/Boats/Purchase')
                    :InvokeServer(unpack(args))

                task.wait(0.5)

                local args = {
                    'Rowboat',
                }
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RF/Boats/Spawn')
                    :InvokeServer(unpack(args))
                task.wait(0.3)
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RE/Boats/Close')
                    :FireServer()
                task.wait(0.5)
                autoEquipRod()
                local player = game:GetService('Players').LocalPlayer
                local gui = player
                    :WaitForChild('PlayerGui')
                    :WaitForChild('hud')
                    :WaitForChild('safezone')
                    :WaitForChild('shipwright')

                gui.Visible = false
            end
        until boat
        for _, descendant in ipairs(boat:GetDescendants()) do
            local name = descendant.Name:lower()
            if name == 'sitprompt' or name == 'body' then
                print('Destroyed:', descendant:GetFullName())
                descendant:Destroy()
            end
        end

        local customPos = Vector3.new(1375.483887, -603.664612, 2340.227783)
        targetCf = CFrame.new(customPos + Vector3.new(0, __var.floatHeight, 0))
        boat:PivotTo(targetCf)
        task.wait(0.5)

        FreezeCharacter1(true)
        return
    end

    local targetParts = zonesData[zoneName]
    if targetParts and #targetParts > 0 then
        local foundValidPos = false
        local finalCFrame = nil
        for i = 1, 10 do
            local randomPart = targetParts[math.random(#targetParts)]
            local size = randomPart.Size
            local cf = randomPart.CFrame
            local randomOffset = Vector3.new(
                math.random() * size.X - size.X / 2,
                0,
                math.random() * size.Z - size.Z / 2
            )
            local testPos = (cf * CFrame.new(randomOffset)).Position
            local rayOrigin = Vector3.new(testPos.X, testPos.Y + 1000, testPos.Z)

            local rayParams = RaycastParams.new()
            rayParams.FilterType = Enum.RaycastFilterType.Exclude
            rayParams.FilterDescendantsInstances = { Character, boat }
            rayParams.IgnoreWater = false

            local rayResult = workspace:Raycast(rayOrigin, Vector3.new(0, -2000, 0), rayParams)
            
            if rayResult then
                if rayResult.Material == Enum.Material.Water then
                    -- Found water!
                    local currentY = rayResult.Position.Y
                    local heightOffset = (zoneName == 'Forsaken Veil') and 80 or (__var.floatHeight or 0)
                    finalCFrame = CFrame.new(testPos.X, currentY + heightOffset, testPos.Z)
                    foundValidPos = true
                    break
                end
            end
        end

        if not foundValidPos then
            local randomPart = targetParts[math.random(#targetParts)]
            local cf = randomPart.CFrame
            local rayParams = RaycastParams.new()
            rayParams.FilterType = Enum.RaycastFilterType.Whitelist
            rayParams.FilterDescendantsInstances = { workspace.Terrain }
            rayParams.IgnoreWater = false
            
            local currentY = cf.Y
            local rayResult = workspace:Raycast(Vector3.new(cf.X, 1000, cf.Z), Vector3.new(0, -2000, 0), rayParams)
            if rayResult and rayResult.Material == Enum.Material.Water then
                currentY = rayResult.Position.Y
            end
             
             local heightOffset = (zoneName == 'Forsaken Veil') and 80 or (__var.floatHeight or 0)
             finalCFrame = CFrame.new(cf.X, currentY + heightOffset, cf.Z)
        end

        previousLocation = HumanoidRootPart.CFrame

        local player = game.Players.LocalPlayer
        local boat
        repeat
            boat = workspace:FindFirstChild('active')
                and workspace.active:FindFirstChild('boats')
                and workspace.active.boats:FindFirstChild(player.Name)
                and workspace.active.boats[player.Name]:FindFirstChild(
                    'Rowboat'
                )
            if not boat then
                local Character = LocalPlayer.Character
                local HumanoidRootPart =
                    Character:FindFirstChild('HumanoidRootPart')
                HumanoidRootPart.CFrame = CFrame.new(362, 134, 259)
                task.wait(0.5)
                local args = {
                    {
                        voice = 8,
                        idle = workspace
                            :WaitForChild('world')
                            :WaitForChild('npcs')
                            :WaitForChild('Moosewood Shipwright')
                            :WaitForChild('description')
                            :WaitForChild('idle'),
                        npc = workspace
                            :WaitForChild('world')
                            :WaitForChild('npcs')
                            :WaitForChild('Moosewood Shipwright'),
                    },
                }
                workspace
                    :WaitForChild('world')
                    :WaitForChild('npcs')
                    :WaitForChild('Moosewood Shipwright')
                    :WaitForChild('shipwright')
                    :WaitForChild('giveUI')
                    :InvokeServer(unpack(args))
                task.wait(0.2)
                local args = {
                    'Rowboat',
                }
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RF/Boats/Purchase')
                    :InvokeServer(unpack(args))

                task.wait(0.5)

                local args = {
                    'Rowboat',
                }
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RF/Boats/Spawn')
                    :InvokeServer(unpack(args))
                task.wait(0.3)
                game:GetService('ReplicatedStorage')
                    :WaitForChild('packages')
                    :WaitForChild('Net')
                    :WaitForChild('RE/Boats/Close')
                    :FireServer()
                task.wait(0.5)
                autoEquipRod()
                local player = game:GetService('Players').LocalPlayer
                local gui = player
                    :WaitForChild('PlayerGui')
                    :WaitForChild('hud')
                    :WaitForChild('safezone')
                    :WaitForChild('shipwright')

                gui.Visible = false
            end
        until boat
        for _, descendant in ipairs(boat:GetDescendants()) do
            local name = descendant.Name:lower()
            if name == 'sitprompt' or name == 'body' then
                print('Destroyed:', descendant:GetFullName())
                descendant:Destroy()
            end
        end
        
        local checkParams = RaycastParams.new()
        checkParams.FilterType = Enum.RaycastFilterType.Whitelist
        checkParams.FilterDescendantsInstances = { workspace.Terrain }
        checkParams.IgnoreWater = false

        local bestY = -10000
        for i=1,3 do
            local finalPos = finalCFrame.Position
            local waterCheck = workspace:Raycast(Vector3.new(finalPos.X, 500, finalPos.Z), Vector3.new(0, -1000, 0), checkParams)
            if waterCheck and waterCheck.Material == Enum.Material.Water then
                if waterCheck.Position.Y > bestY then
                    bestY = waterCheck.Position.Y
                end
            end
            task.wait(0.1)
        end

        if bestY > -5000 then
            finalCFrame = CFrame.new(finalCFrame.X, bestY + 3.5, finalCFrame.Z) 
        end
        
        boat:PivotTo(finalCFrame)
        task.wait(0.5)
        
        local confirmCheck = workspace:Raycast(Vector3.new(finalCFrame.X, 500, finalCFrame.Z), Vector3.new(0, -1000, 0), checkParams)
        if confirmCheck and confirmCheck.Material == Enum.Material.Water then
             finalCFrame = CFrame.new(finalCFrame.X, confirmCheck.Position.Y + 3.5, finalCFrame.Z)
        end
        
        task.spawn(function()
             for _=1,20 do 
                local currentPos = boat.PrimaryPart.Position
                local check = workspace:Raycast(Vector3.new(currentPos.X, 500, currentPos.Z), Vector3.new(0, -1000, 0), checkParams)
                
                if check and check.Material == Enum.Material.Water then
                     local waterLevel = check.Position.Y
                     if currentPos.Y < waterLevel then
                         finalCFrame = CFrame.new(currentPos.X, waterLevel + 3.5, currentPos.Z)
                         boat:PivotTo(finalCFrame)
                     elseif (currentPos.Y - waterLevel) > 5 then
                         finalCFrame = CFrame.new(currentPos.X, waterLevel + 3.5, currentPos.Z)
                         boat:PivotTo(finalCFrame)
                     end
                end
                task.wait(0.2)
             end
        end)
        

        
        boat:PivotTo(finalCFrame)
        task.wait(0.25)
        boat:PivotTo(finalCFrame) 
        task.wait(0.25)
        
        if zoneName == "Terrapin Island" then
            pcall(function()
                local map = workspace.world.map
                if map and map:FindFirstChild("Terrapin Island") then
                     local children = map["Terrapin Island"]:GetChildren()
                     if children[138] then
                        children[138]:Destroy()
                     end
                end
            end)
        end
        
        local Character = LocalPlayer.Character
        if Character then
            task.wait(0.3) -- Wait for teleport to settle
            local backpack = LocalPlayer.Backpack
            local rod = nil
            for _, tool in pairs(backpack:GetChildren()) do
                if tool:IsA("Tool") and (tool.Name:find("Rod") or tool.Name:find("Fishing")) then
                    rod = tool
                    break
                end
            end
            
            if rod then
                 Character.Humanoid:EquipTool(rod)
            end
        end

        FreezeCharacter1(true)
    else
        warn('[ERROR] Zona memancing tidak ditemukan!')
    end
end

    local fishingSpots, _ = getFishingZones()
    local function AddZone(name)
        for _, spot in ipairs(fishingSpots) do
            if spot == name then
                return 
            end
        end
        table.insert(fishingSpots, name)
    end
    AddZone("Crystal Cove")
    local Players = game:GetService("Players")
    local lp = Players.LocalPlayer

    local optionQuestAngler = {
        ["Moosewood Village"] = CFrame.new(481, 151, 299),
        ["Roslit Hamlet"] = CFrame.new(-1512, 140, 688),
        ["Sunstone Island"] = CFrame.new(-885, 135, -1115),
        ["Terrapin Island"] = CFrame.new(-153, 144, 1954),
        ["The Depths"] = CFrame.new(980, -700, 1230),
        ["Ancient Isles"] = CFrame.new(5737, 177, -57),
        ["Forsaken Shores"] = CFrame.new(-2702, 169, 1798),
        ["Crimson Cavern"] = CFrame.new(-1069, -361, -4811),
        ["Luminescent Cavern"] = CFrame.new(-1050, -337, -4078),
        ["Lost Jungle"] = CFrame.new(-2726, 226, -2186)
    }

    local anglerOptions = {"None"}
    for name in pairs(optionQuestAngler) do
        table.insert(anglerOptions, name)
    end

    local lastSelectedAngler = "None"
    local AutoAngler = false

    local function teleportToAngler(name)
        local cf = optionQuestAngler[name]
        if not cf then return end

        local char = lp.Character or lp.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")

        hrp.CFrame = cf
    end
    Dropdown(FishingZone, "Fishing Zone", _G.Config.selectedZone, fishingSpots, false, function(selected)
        _G.Config.selectedZone = selected
    end)
    fishingzones2 = FishingZone:AddToggle({
        Title = "Auto Fishing Teleport",
        Content = "Enable/Disable Teleport",
        Default = _G.Config.selectedZoneADS,
        Callback = function(Value)
            task.spawn(function()
                _G.Config.selectedZoneADS = Value
                if _G.Config.selectedZoneADS then
                    teleportToFishingZone(_G.Config.selectedZone)
                else
                    teleportToFishingZone("None")
                end
            end)
        end
    })
    AutosQuest:AddDropdown({
        Title = "Select Quest Angler Location",
        Content = "Select Quest Angler",
        Options = anglerOptions,
        Default = {"None"},
        Multi = false,
        Callback = function(v)
            lastSelectedAngler = v
        end
    })

_G.QuestData = {
    Name = "None",
    Target = "None",
    Cooldown = "Ready",
    Status = "Idle"
}

local function ToggleStatusWidget(visible)
    local player = game:GetService("Players").LocalPlayer
    local playerGui = player:WaitForChild("PlayerGui")
    local existing = playerGui:FindFirstChild("QuestStatusWidget")
    
    if not visible then
        if existing then existing:Destroy() end
        return
    end
    
    if existing then return end 
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "QuestStatusWidget"
    screenGui.Parent = playerGui
    screenGui.DisplayOrder = 99999999
    screenGui.IgnoreGuiInset = true
    screenGui.ResetOnSpawn = false
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 180, 0, 100) 
    mainFrame.Position = UDim2.new(0, 10, 1, -130)
    mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    mainFrame.BackgroundTransparency = 0.25
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, 18) 
    uiCorner.Parent = mainFrame
    
    local uiStroke = Instance.new("UIStroke")
    uiStroke.Color = Color3.fromRGB(255, 255, 255)
    uiStroke.Thickness = 1.2
    uiStroke.Transparency = 0.85
    uiStroke.Parent = mainFrame
    
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(45, 45, 45)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(15, 15, 15))
    }
    gradient.Rotation = 45
    gradient.Parent = mainFrame
    
    local decorFrame = Instance.new("Frame")
    decorFrame.BackgroundTransparency = 1
    decorFrame.Size = UDim2.new(1, 0, 0, 20)
    decorFrame.Parent = mainFrame 
    
    local function makeDot(color, x)
        local dot = Instance.new("Frame")
        dot.Size = UDim2.new(0, 8, 0, 8)
        dot.Position = UDim2.new(0, x, 0, 10) 
        dot.BackgroundColor3 = color
        dot.BorderSizePixel = 0
        Instance.new("UICorner", dot).CornerRadius = UDim.new(1, 0)
        dot.Parent = decorFrame
    end
    makeDot(Color3.fromRGB(255, 95, 87), 12)
    makeDot(Color3.fromRGB(255, 189, 46), 26)
    makeDot(Color3.fromRGB(40, 201, 64), 40)

    local contentFrame = Instance.new("Frame")
    contentFrame.BackgroundTransparency = 1
    contentFrame.Size = UDim2.new(1, 0, 1, -28)
    contentFrame.Position = UDim2.new(0, 0, 0, 28) 
    contentFrame.Parent = mainFrame

    local listLayout = Instance.new("UIListLayout")
    listLayout.Parent = contentFrame
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Padding = UDim.new(0, 2)
    listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
    listLayout.VerticalAlignment = Enum.VerticalAlignment.Top
    
    local padding = Instance.new("UIPadding")
    padding.PaddingLeft = UDim.new(0, 15)
    padding.PaddingTop = UDim.new(0, 0)
    padding.Parent = contentFrame
    local function createLabel(name, text, color, order)
        local label = Instance.new("TextLabel")
        label.Name = name
        label.Size = UDim2.new(1, -15, 0, 14)
        label.BackgroundTransparency = 1
        label.TextColor3 = color
        label.TextSize = 11
        label.Font = Enum.Font.GothamBold
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Text = text
        label.LayoutOrder = order
        label.Parent = contentFrame
        return label
    end
    
    local purple = Color3.fromRGB(180, 80, 255)
    local lblQuest = createLabel("QuestLabel", "Quest: ...", purple, 1)
    local lblTarget = createLabel("TargetLabel", "Target: ...", purple, 2)
    local lblBackpack = createLabel("BackpackLabel", "Have: false", purple, 3)
    local lblStatus = createLabel("StatusLabel", "Status: Idle", purple, 4)
    task.spawn(function()
        while screenGui and screenGui.Parent do
            lblQuest.Text = "Quest: " .. (_G.QuestData.Name or "None")
            lblTarget.Text = "Target: " .. (_G.QuestData.Target or "None")
            lblBackpack.Text = "Have Fish: " .. tostring(_G.QuestData.HaveFish or "false")
            lblStatus.Text = "Status: " .. (_G.QuestData.Status or "Idle")
            task.wait(0.2)
        end
    end)
end

    AutosQuest:AddToggle({
        Title = "Auto Angler",
        Default = false,
        Callback = function(toggleValue)
            AutoAngler = toggleValue
            ToggleStatusWidget(toggleValue)
            if not AutoAngler then
                task.spawn(function()
                    _G.Config.selectedZoneADS = false
                    teleportToFishingZone("None")
                end)
                return
            end

            task.spawn(function()
                while AutoAngler do
                    local Players = game:GetService("Players")
                    local LocalPlayer = Players.LocalPlayer
                    local questValueObj
                    local function getQuest()
                        local playerStats = workspace:FindFirstChild("PlayerStats")
                        if not playerStats then return nil end
                        
                        local myStats = playerStats:FindFirstChild(LocalPlayer.Name)
                        if not myStats then return nil end

                        -- Try explicit path first: PlayerStats.Name.T.Name.Quests
                        local tFolder = myStats:FindFirstChild("T")
                        if tFolder then
                            local innerPlayer = tFolder:FindFirstChild(LocalPlayer.Name)
                            if innerPlayer then
                                local quests = innerPlayer:FindFirstChild("Quests")
                                if quests then
                                    for _, child in ipairs(quests:GetChildren()) do
                                         if child.Name:find("Angler Quest") then
                                            return child
                                         end
                                    end
                                end
                            end
                        end
                        
                        return nil
                    end

                    local function triggerAnglerPrompt()
                        for _, npc in pairs(workspace.world.npcs:GetChildren()) do
                            if npc:IsA("Model") and npc.Name:lower():find("angler") then
                                local prompt = npc:FindFirstChildWhichIsA("ProximityPrompt", true)
                                if prompt then
                                    FireProximity(prompt)
                                    return true
                                end
                            end
                        end
                        return false
                    end
                    _G.QuestData.Status = "Searching..."
                    _G.QuestData.Name = "None"
                    while AutoAngler do
                        questValueObj = getQuest()
                         if questValueObj then
                            print("✅ Quest Angler Found/Active")
                            _G.QuestData.Status = "Quest Active!"
                            _G.QuestData.Name = "Angler Quest"
                            break
                        end
                        if lastSelectedAngler ~= "None" then
                            _G.QuestData.Status = "Going to Angler..."
                            teleportToAngler(lastSelectedAngler)
                            task.wait(1.5)

                            local start = tick()
                            _G.QuestData.Status = "Interacting..."
                            while tick() - start < 5 do
                                if triggerAnglerPrompt() then
                                    local DialogInteract = game:GetService("ReplicatedStorage"):WaitForChild("packages"):WaitForChild("Net"):WaitForChild("RF/DialogInteract")
                                    pcall(function()
                                        DialogInteract:InvokeServer(1, 1)
                                    end)
                                    break
                                end
                                task.wait(0.4)
                            end
                        end
                        task.wait(1)
                    end
                    
                    if not AutoAngler then return end
                    
                    local value = questValueObj.Value:gsub(":$", "")
                    local valueLower = value:lower()

                    local detected = false

                    for _, phrase in ipairs(anglerOptions) do
                        for word in phrase:lower():gmatch("%S+") do
                            if valueLower:find(word, 1, true) then
                                if phrase ~= "None" then
                                    detected = true
                                    break
                                end
                            end
                        end
                        if detected then break end
                    end
                    local targetFish = nil
                    if questValueObj then
                        for _, child in ipairs(questValueObj:GetChildren()) do
                            if child.Name ~= "AutoComplete" and 
                               child.Name ~= "Icon" and 
                               child.Name ~= "Tracking" and 
                               not child.Name:find("_Goal") then
                                targetFish = child.Name
                                break
                            end
                        end
                    end
                    
                    if targetFish then
                        _G.QuestData.Target = targetFish
                        _G.QuestData.Status = "Target Identified"
                    end

                    local fishActioned = false
                    if targetFish then
                        local backpack = LocalPlayer.Backpack
                        local character = LocalPlayer.Character
                        local fishTool = backpack:FindFirstChild(targetFish) or (character and character:FindFirstChild(targetFish))
                        
                        _G.QuestData.HaveFish = (fishTool ~= nil)
                        
                        if fishTool then
                            print("🐟 Got Target Fish:", targetFish)
                            fishActioned = true
                            _G.QuestData.Status = "Fish Caught! Returning..."
                            _G.Config.selectedZoneADS = false
                            teleportToFishingZone("None")
                            if lastSelectedAngler ~= "None" then
                                _G.QuestData.Status = "Going to Angler..."
                                teleportToAngler(lastSelectedAngler)
                                task.wait(1.5)
                            end
                            _G.QuestData.Status = "Equipping Fish..."
                            local human = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid")
                            if human then
                                human:EquipTool(fishTool)
                            end
                            task.wait(0.5)
            
                            _G.QuestData.Status = "Turning In Quest..."
                            local claimStart = tick()
                            while tick() - claimStart < 10 do
                                if triggerAnglerPrompt() then
                                    local function selectOption(optionName)
                                        local playerGui = LocalPlayer:WaitForChild("PlayerGui")
                                        local hud = playerGui:FindFirstChild("HUD")
                                        local dialogue = hud and hud:FindFirstChild("Dialogue")
                                        local options = dialogue and dialogue:FindFirstChild("Options")
                                        
                                        if options then
                                            for _, child in ipairs(options:GetChildren()) do
                                                if child:IsA("Frame") and child.Name ~= "UIListLayout" then
                                                    local textLabel = child:FindFirstChild("TextLabel")
                                                    if textLabel and textLabel.Text:lower():find(optionName:lower()) then
                                                        child.Selectable = true
                                                        game:GetService("GuiService").SelectedObject = child

                                                        keypress(0x0D)
                                                        keyrelease(0x0D)
                                                        return true
                                                    end
                                                end
                                            end
                                        end
                                        return false
                                    end

                                    local DialogInteract = game:GetService("ReplicatedStorage"):WaitForChild("packages"):WaitForChild("Net"):WaitForChild("RF/DialogInteract")
                                    DialogInteract:InvokeServer(1, 1)
                                    print("✅ Quest Claimed (UI)!")
                                    
                                    task.wait(0.5)
                                    
                                    local seenButton = false
                                    local closed = false
                                    for i=1, 20 do
                                        local pGui = LocalPlayer:FindFirstChild("PlayerGui")
                                        local optGui = pGui and pGui:FindFirstChild("options")
                                        local safezone = optGui and optGui:FindFirstChild("safezone")
                                        local optionFrame = safezone and safezone:FindFirstChild("2option")
                                        local btn = optionFrame and optionFrame:FindFirstChild("button")
                                        
                                        if btn then
                                            seenButton = true
                                            print("Clicking 'Not yet'...")
                                            btn.Selectable = true
                                            game:GetService("GuiService").SelectedObject = btn
                                            
                                            keypress(0x0D)
                                            keyrelease(0x0D)
                                        elseif seenButton then
                                            print("Dialogue closed (Button disappeared).")
                                            closed = true
                                            break
                                        end
                                        task.wait(0.2)
                                    end
                                    
                                    if not closed then
                                        print("⚠️ Failed to close 'Not yet' after 20 attempts")
                                    end
                                    
                                    break
                                end
                                task.wait(0.4)
                            end
                            
                            _G.QuestData.Status = "Claimed!"
                            task.wait(2) 
                        end
                    end
 
                    if not fishActioned and detected then
                        local spotDetected = false
                        for _, v in pairs(fishingSpots) do
                            local vLower = v:lower()
                            if valueLower:find(vLower, 1, true) then
                                spotDetected = true
                                _G.Config.selectedZone = v
                                break
                            end
                        end
                        
                        if not spotDetected then
                             for _, v in pairs(fishingSpots) do
                                local vLower = v:lower()
                                local mainSpot = vLower:match("^(%S+)")
                                if mainSpot and #mainSpot > 3 and valueLower:find(mainSpot, 1, true) then
                                    if vLower == "terrapin olm" and not valueLower:find("olm") then
                                        continue
                                    end

                                    spotDetected = true
                                    _G.Config.selectedZone = v
                                    break
                                end
                            end
                        end

                        if spotDetected then
                            if not _G.Config.selectedZoneADS then
                                _G.Config.selectedZoneADS = true
                                _G.QuestData.Status = "Traveling to: " .. _G.Config.selectedZone
                                teleportToFishingZone(_G.Config.selectedZone)
                            end
                        else
                            if _G.Config.selectedZoneADS then
                                _G.Config.selectedZoneADS = false
                                teleportToFishingZone("None")
                            end
                        end
                    end
                    task.wait(1.5)
                end
            end)
        end
    })

    namefish = {"Frank", "Mustard Hat", "Freezing Shroom", "Glacial Fragment", "Penguin", "White Sturgeon", "Charybdis", "Lusca", "Akkorokamui", "Beach Crate", "Sunsquid", "Surfboard Ray", "Beach Ball Pufferfish", "Sunglasses", "Sea Sponge", "Lifeguard Whistle", "Sand Castle", "Sunscreen Bottle", "Tidepopper", "Coconut", "Shellphone", "Popsicle", "Message in a Bottle", "Tiki Mask", "Sandslasher", "Mango Smoothie", "Mango", "Mango Whale", "Black Iron Bucket", "Flashlight", "Singularity", "Snowflake", "Snowman", "Fridge", "Ghost", "Ghoul", "Poltergeist", "Golden Nessie", "Golden Scylla", "Golden Coin", "Slenderfish", "String", "Opalescent Catfish", "Pufferflute", "Mutated Crystal Shrimp", "Crystal Lobster", "Stringed Grouper", "Crystal Frilled Shark", "Musical Crab", "DJ Spinopus", "Blobfish", "Manatee", "Doubloon", "Friend Fish", "Squirrelfish", "French Grunt", "Sergeant Major", "Coney Grouper", "Doctorfish Tang", "Bluehead Wrasse", "Islandhopper Butterflyfish", "Stoplight Parrotfish", "Scrawled Filefish", "Spadefish", "Ocean Triggerfish", "Rock Hind", "Rainbow Grouper", "Spotted Moray Eel", "Great Barracuda", "Tilefish", "Black Grouper", "Clowned Triggerfish", "Flamekissed Hawkfish", "Mandarinfish", "Cobalt Angelfish", "Trevally", "Warty Frogfish", "Hidden Pipefish", "Mirage Toadfish", "Scalloped Hammerhead", "Great Goldcursed Shark", "Bloop Fish", "Baby Bloop Fish", "Magician Narwhal", "Beluga", "Narwhal", "Apex Leviathan", "Mosslurker", "Carrot Goldfish", "Carrot Pufferfish", "Carrot Minnow", "Carrot Eel", "Carrot Salmon", "Carrot Turtle", "Carrot Snapper", "Carrot Shark", "Moon Idol Sea 1", "Moon Idol", "Moon Arctic Char", "Silver Scuttler", "Pale Ghost Lumpfish", "Frost Ray", "Blue Langanose", "Starbellied Wolf Fish", "Icy Daggerfish", "Lunar Monkfish", "Moon Idol Sea 2", "Moonveil Killifish", "Gloamfin Gar", "Lurking Crescent Pike", "Moonridge Catfish", "Crescent Madtom", "Bog Lantern Goby", "Tarnished Moongill", "Shell", "Shrimpanzee", "Royal Tigerfish", "Slurpfloth", "Flamangler", "Orcanda", "Octophant", "Wretched Guppy", "Hollow Gazer", "Eldritch Spineback", "Abyssal Maw", "Bloodscript Eel", "Veilborn Parasite", "Profane Ray", "The Whispering One", "Minnowse", "Kittyfish", "Parrotfish", "Pengwhal", "Racuda", "Crocokoi", "Krabbit", "Siren Sheep", "Capybass", "Cluckfin", "Zebrafishlet", "Piglet Pike", "Squirrelray", "Duckfin Tuna", "Porcufish", "Piranhamunk", "Salmoose", "Mained Lionfish", "Seacow", "Mama Poot", "Ken", "Grouchy Smurf", "No Name", "Hefty", "Vanity", "Brainy Smurf", "Clumsy Smurf", "Papa Smurf", "Moxie", "Sunny O'Coin", "Rowdy McCharm", "Plumrick O'Luck", "O'Mango Goldgrin", "Blarney McBreeze", "Magma Leviathan", "Anglers Lantern", "Crowned Anglerfish", "Crystallized Seadragon", "Scylla", "Ember Catfish", "Blistered Eel", "Lava Lamprey", "Molten Minnow", "Pyro Pike", "Cinder Carp", "Scooty Salmon", "Burnt Betta", "Ashcloud Archerfish", "Slain Maw", "Black Veil Ray", "Bone Lanternfish", "Harbinger Koi", "Hexeye Snapper", "Rotfin Eel", "Siren’s Guppy", "Wraithfin", "Lovestorm Eel", "Lovestorm Eel Supercharged", "Tempest Ray", "Abyss Snapper", "Whirlpool Marlin", "Vortex Barracuda", "Typhoon Tuna", "Cyclone Mako", "Maelstorm Shark", "Void Angler", "Reef Minnow", "Coral Chromis", "Reef Goby", "Coral Guard", "Crystal Wrasse", "Reef Parrotfish", "Coral Emperor", "Grand Reef Guardian", "Glacier Glowfish", "Frozen Fangfish", "Hollow Flake Catfish", "Crystal Carp", "Hollyscale Trout", "Red Energy Crystal", "Green Energy Crystal", "Yellow Energy Crystal", "Blue Energy Crystal", "Glass Diamond", "Ice Anchovy", "Icy Salmon", "Icy Carp", "Frigid Crab", "Icy Tuna", "Icy Goldfish", "Frigid Antlers", "Frozen Walnut", "Ice Eel", "Frigid Shrimp", "Ice Jellyfish", "Ice Octopus", "Frigid Taco", "Snowfish", "Polar Alligator", "Frigid Mammoth Tusk", "Frost Minnow", "Snowflake Smelt", "Iced Perch", "Snowback Char", "Chillfin Herring", "Frozen Pike", "Icebreaker Haddock", "Frostjaw Cod", "Aaurora Trout", "Glacial Sturgeon", "Snowgill Dace", "Frostling Goby", "Chillback Whitefish", "Icy Walleye", "Shiverfin Haddock", "Frostbite Flounder", "Glacier Swordfish", "Icefang Barracuda", "Borealis Snapper", "Icebeard Shark", "Meg's Spine", "Meg's Fang", "Moon Wood", "Inferno Wood", "Ancient Wood", "Void Wood", "Moonstone", "Lapis Lazuli", "Opal", "Ruby", "Amethyst", "Deep Sea Fragment", "Solar Fragment", "Earth Fragment", "Ancient Fragment", "Megalodon", "Phantom Megalodon", "Ancient Megalodon", "Forsaken Algae", "Ancient Algae", "Mushgrove Algae", "Snowcap Algae", "Barracuda's Spine", "Fossil Fan", "Claw Gill", "Spine Bone", "Spine Blade", "Shark Fang", "Nessie's Spine", "Spined Fin", "Ancient Serpent Spine", "Resin", "Ancient Serpent Skull", "Palaeoniscum", "Birgeria", "Phanerorhynchus", "Diplurus", "Lepidotes", "Amblypterus", "Boots", "RocketFuel", "Speed Core", "The Depths Key", "Destroyed Fossil", "Scrap Metal", "Deep-sea Hatchetfish", "Deep-sea Dragonfish", "Luminescent Minnow", "Frilled Shark", "Depth Octopus", "Three-eyed Fish", "Goblin Shark", "Black Dragon Fish", "Spider Crab", "Nautilus", "Small Spine Chimera", "Ancient Eel", "Mutated Shark", "Barreleye Fish", "Sea Snake", "Ancient Depth Serpent", "Corsair Grouper", "Shortfin Mako Shark", "Galleon Goliath", "Buccaneer Barracuda", "Scurvy Sailfish", "Cutlass Fish", "Reefrunner Snapper", "Cursed Eel", "Shipwreck Barracuda", "Golden Seahorse", "Captain's Goldfish", "Piranha", "Cladoselache", "Anomalocaris", "Starfish", "Onychodus", "Acanthodii", "Xiphactinus", "Hyneria", "Hallucigenia", "Cobia", "Floppy", "Leedsichthys", "Ginsu Shark", "Dunkleosteus", "Helicoprion", "Mosasaurus", "Banana", "Tire", "Boot", "Driftwood", "Seaweed", "Log", "Rock", "Common Crate", "Bloop Cosmetic Crate", "Carbon Crate", "Fish Barrel", "Bait Crate", "Quality Bait Crate", "Enchant Relic", "Exalted Relic", "Song of the Deep", "Cosmic Relic", "Bone", "Gazerfish", "Brine Shrimp", "Globe Jellyfish", "Dweller Catfish", "Eyefestation", "Brine Phantom", "Spectral Serpent", "Stalactite", "Coral Geode", "Horseshoe Crab", "Slate Tuna", "Phantom Ray", "Rockstar Hermit Crab", "Cockatoo Squid", "Banditfish", "Midnight Axolotl", "Barbed Shark", "Emperor Jellyfish", "Sea Mine", "Pale Tang", "Bluefish", "Lapisjack", "Keepers Guardian", "Umbral Shark", "Red Snapper", "Anchovy", "Largemouth Bass", "Trout", "Bream", "Sockeye Salmon", "Carp", "Yellowfin Tuna", "Goldfish", "Snook", "Flounder", "Eel", "Pike", "Whiptail Catfish", "Whisker Bill", "Treble Bass", "Fungal Cluster", "White Perch", "Swamp Bass", "Bowfin", "Grey Carp", "Swamp Scallop", "Mushgrove Crab", "Marsh Gar", "Catfish", "Alligator", "Handfish", "Sea Bass", "Porgy", "Mullet", "Sardine", "Mackerel", "Haddock", "Shrimp", "Sand Dollar", "Mussel", "Barracuda", "Cod", "Salmon", "Amberjack", "Crab", "Scallop", "Prawn", "Oyster", "Nurse Shark", "Lobster", "Ancient Lobster", "Studster", "Slipper Lobster", "Scalloped Spiny Lobster", "Rock Lobster", "Lagoon Lobster", "Snowcap Lobster", "Langoustine", "Second Sea Lobster", "Spiny Sunstone Lobster", "Terrapin Lobster", "Western Rock Lobster", "Roslit Ray Lobster", "Lobster King", "Azureback Haddock School", "Blobfish School", "Bluefin Tuna School", "Coralwing Guppy School", "Duskwave Herring School", "Infernal Halibut School", "Moonveil Salmon School", "Pufferling School", "Sardines School", "Seaspawn Shrimp School", "Shiver Swarmfish School", "Veinfin Tetra School", "Coelacath", "Bluefin Tuna", "Halibut", "Stingray", "Sea Urchin", "Anglerfish", "Pufferfish", "Swordfish", "Sailfish", "Cookiecutter Shark", "Bull Shark", "Moonfish", "Crown Bass", "Flying Fish", "Rabbitfish", "Dolphin", "Sawfish", "Oarfish", "Great White Shark", "Great Hammerhead Shark", "Mythic Fish", "Sea Pickle", "Colossal Squid", "Whale Shark", "Long Pike", "Mustard", "Chub", "Perch", "Minnow", "Pearl", "Pumpkinseed", "Clownfish", "Blue Tang", "Butterflyfish", "Gilded Pearl", "Angelfish", "Squid", "Ribbon Eel", "Yellow Boxfish", "Clam", "Rose Pearl", "Arapaima", "Alligator Gar", "Suckermouth Catfish", "Mauve Pearl", "Dumbo Octopus", "Axolotl", "Deep Pearl", "Manta Ray", "Aurora Pearl", "Golden Sea Pearl", "Basalt", "Volcanic Geode", "Magma Tang", "Ember Snapper", "Ember Perch", "Pyrogrub", "Obsidian Salmon", "Obsidian Swordfish", "Molten Banshee", "Ice", "Bluegill", "Grayling", "Red Drum", "Herring", "Pollock", "Arctic Char", "Burbot", "Blackfish", "Skipjack Tuna", "Glacier Pike", "Lingcod", "Sturgeon", "Pond Emperor", "Ringle", "Glacierfish", "Sweetfish", "Glassfish", "Longtail Bass", "Red Tang", "Chinfish", "Trumpetfish", "Mahi Mahi", "Napoleonfish", "Sunfish", "Wiifish", "Voltfish", "Smallmouth Bass", "Gudgeon", "White Bass", "Walleye", "Redeye Bass", "Chinook Salmon", "King Oyster", "Golden Smallmouth Bass", "Olm", "Sea Turtle", "Spiderfish", "Night Shrimp", "Twilight Eel", "Fangborn Gar", "Abyssacuda", "Voidfin Mahi", "Rubber Ducky", "Isonade", "Ghoulfish", "Lurkerfish", "Candy Fish", "Zombiefish", "Skelefish", "Nessie", "Turkey", "Icicle", "Basic Present", "Unique Present", "Supreme Present", "Festive Bait Crate", "Cookie", "Glass of Milk", "Candy Cane Carp", "Santa Salmon", "Gingerbread Fish", "Ornament Fish", "Snowflake Flounder", "Olmdeer", "Santa Pufferfish", "Northstar Serpent", "Confetti Shark", "Tidal Pike", "Countdown Perch", "Hourglass Bass", "Eternal Frostwhale", "Cryoskin", "Frostscale Fangtooth", "Subzero Stargazer", "Chillshadow Chub", "Deep Freeze Devilfish", "Iceberg Isopod", "Cryo Coelacanth", "Polar Prowler", "Chillfin Chimaera", "Frozen Leviathan", "Lightning Minnow", "Thunder Bass", "Static Ray", "Storm Eel", "Voltfin Carp", "Thunder Serpet", "Lightning Pike", "Sparkfin Tetra", "Stormcloud Angelfish", "Zeus' Herald", "Colossal Carp", "Titan Tuna", "Giant Manta", "Leviathan Bass", "Massive Marlin", "Titanic Sturgeon", "Titanfang Grouper", "Deep Emperor", "Deep Behemoth", "Abyssal Goliath", "Sunken Silverscale", "Atlantean Anchovy", "Oracle Minnow", "Poseidon's Perch", "Marble Maiden", "Crystal Chorus", "Helios Ray", "Philosopher's Fish", "Atlantean Guardian", "Triton's Herald", "Twilight Glowfish", "Atlantean Alchemist", "Deep Crownfish", "Celestial Koi", "Column Crawler", "Atlantean Sardine", "Neptune's Nibbler", "Aqua Scribe", "Temple Drifter", "Mosaic Swimmer", "Echo Fisher", "Oracle's Eye", "Siren Singer", "Chronos Deep Swimmer", "Voidscale Guppy", "Starlit Weaver", "Mage Marlin", "King Jellyfish", "Shadowfang Snapper", "Tentacled Horror", "Tentacle Eel", "Deep One", "Eldritch Horror", "Kraken's Herald", "Abyssal King", "Void Emperor", "Abyssal Devourer", "The Kraken", "Ancient Kraken", "Orca", "Ancient Orca", "Blue Whale", "Moby", "Titanic Black Seadevil", "Leviathan Humpback Anglerfish", "Abyssal Bearded Seadevil", "Colossal Saccopharynx", "Radiant Triplewart Seadevil", "Deeplight Footballfish", "Voidglow Ghostfish", "Infant Giant Seadevil", "Giant Seadevil", "Quartzfin Queenfish", "Diamond Discus", "Emerald Elephantnose", "Sapphire Stargazer", "Ruby Rasbora", "Prismatic Parrotfish", "Crystal Corydoras", "Shimmering Silverside", "Inferno Hide", "Hellfire Haddock", "Embertail Eel", "Infernal Iguanafish", "Smoldering Stingray", "Pyrite Pufferfish", "Molten Moray", "Scalding Swordfish", "Blisterback Blenny", "Hydra Haddock", "Serpent Surgeonfish", "Kraken Koi", "Gorgon Grouper", "Cyclone Scorpionfish", "Siren Sculpin", "Typhoon Tailfin", "Twilight Tentaclefish", "Baby Pond Emperor", "Sea Leviathan", "Gale Snapper", "Drift Claw", "Foamrunner", "Sprayfin", "Ripple Spine", "Depth Lurker", "Surge Pike", "Abyss Dart", "Breaker Moth", "Tide Fang", "Wave Piercer", "Gust Tail", "Vortex Ray", "Storm Skipper", "Watching Glowfin", "Drifting Gildfin", "Blue Foamtail", "Redwood Duskray", "Oak Stripetail", "Pine Zephyrfish", "Parktail Spinesnapper", "Sunray Sunscale", "Thornfish", "Bogscale", "Murkdrifter", "Vinefish", "Canopy Tetra", "Hollow Snapper", "Fogstripe", "Temple Perch", "Relic Dart", "Eecho Koi", "Glade Lurker", "Jungle Phantom", "Idolfish", "Primordial Levi", "Ashscale Minnow", "Glowfin Skipper", "Pyre Fang", "Firecrest", "Lava Bream", "Moltenstripe", "Magma Pike", "Hellmaw Eel", "Sulfur Snapper", "Smogfish", "Sunflare Tetra", "Searfin", "Basalt Pike", "Furnace Leaper", "Smolderfang", "Blazebelly", "Cragscale", "Volcanic Prowler", "Inferno Chaser", "Cinder Dart", "Emberwing", "Scorchray", "Brimstone Angler", "Obsidian Koi", "Tropicspike", "Molten Ripple", "Tidallow", "Reefdart", "Crestscale", "Horizon Tetra", "Driftfin", "Lantern Snapper", "Abyss Flicker", "Whisper Eel", "Phantom Koi", "Blisterfish", "Gloombiter", "Rotjaw", "Murkslither", "Split Eye Snapper", "Tumor Pike", "Hollowfin", "Crawling Angler", "Veinspawn", "Screaming Fluke", "Chasm Leech", "Dreaming Aberration", "Abyssborn Monstrosity", "Cursed Thread", "Hogchoker", "Rock Gunnel", "Pupfish", "Four Eyes Fish", "Black Swallower", "Warty Angler", "Lumpclinger", "Snipefish", "Boarfish", "Telescopefish", "Fangtooth", "Velvet Belly Lanternshark", "Snakehead", "Sarcastic Fringehead", "Knifefish", "Tripod Fish", "Pelican Eel", "Bigfin Squid", "X-ray Tetra", "Psychedelic Frogfish", "Murkfin", "Brackscale", "Lagoon Dart", "Glimmer Guppy", "Swampjaw", "Algae Lurker", "Reed Striker", "Azure Prowler", "Phantom Brine", "Bloomtail", "Depth Drifter", "Verdant Mirage", "Toilet Fish", "Dogefin", "Tartaruga", "Tropical Bait Crate", "Jurassic Mosasaurus", "Gillicus", "Ooreochima", "Diplomystus", "Giant Lamprey", "Edestus", "Jurassic Helicoprion", "Dasyatis", "Rhizodus", "Azure Studfish", "Clown Brickfish", "Goldbrick", "Yellow Studfish", "Stud Turtle", "Brickhorse", "Cardinal Studfish", "Crab Stud", "Glow Brick", "Jellystud", "Stud Koi", "Stud Shark", "Studling Crab", "Studphin", "Tentabrick", "Studolodon", "Gem Salmon", "Bluegem Angelfish", "Coin Triggerfish", "Crowned Royal Gramma", "Emerald Angelfish", "Gem Anchovy", "Gemscale Mandarinfish", "Goldband Butterflyfish", "Gem Eel", "Golden Dorado", "Hidden Filefish", "Coin Squid", "Coin Piranha", "Net Wolffish", "Queen Angelfish", "Gem Dolphin", "Ruby Lionfish", "Gemstone Whale Shark", "Gem Marlin", "Goldfin Octopus", "Gem Blobfish", "Gulf Toadfish", "Oyster toadfish", "Smooth toadfish", "Splendid toadfish", "Bearded Toadfish", "Giant Moray"}
    targetFav = {}

    
    AutosFavorit:AddDropdown({
        Title = "Select Fish to Favorite",
        Content = "Select a multi favorite fish",
        Options = namefish,
        Default = {"None"},
        Multi = true,
        Callback = function(v)
            targetFav = v
        end
    })
    
    local AutoFavoriteFunc = AutosFavorit:AddToggle({
        Title = "Auto Favorite",
        Default = _G.Config.AutoFavorite,
        Callback = function(value)
            _G.Config.AutoFavorite = value
            if value then
                spawn(function()
                    while _G.Config.AutoFavorite do
                        local backpack = game:GetService("Players").LocalPlayer.Backpack
                        local foundItems = {}
                        task.wait()
                        for _, itemName in pairs(targetFav) do
                            for _, child in pairs(backpack:GetChildren()) do
                                if child.Name == itemName and child:FindFirstChild("link") then
                                    table.insert(foundItems, {
                                        Name = child.Name,
                                        Link = child.link.Value
                                    })
                                    task.wait(0.1)
                                    game:GetService("ReplicatedStorage"):WaitForChild("packages"):WaitForChild("Net"):WaitForChild("RE/Backpack/Favourite"):FireServer(child.link.Value, true)
                                end
                            end
                        end
                    end
                end)
            end
        end
    })

    local AutoSellFunc = AutosSection:AddToggle({
        Title = "Auto Sell",
        Default = _G.Config.AutoSell,
        Callback = function(value)
             _G.Config.AutoSell = value
             task.spawn(function()
                if value then
                    AutoSell()
                end
            end)
        end
    })
    AutosSection:AddToggle({
        Title = "Auto Sell On Held",
        Default = _G.Config.AutoSellOnHeld,
        Callback = function(value)
            _G.Config.AutoSellOnHeld = value
            if value then
                task.spawn(function()
                    while _G.Config.AutoSellOnHeld do
                        local args = {
                            {
                                voice = 12,
                                idle = workspace:WaitForChild("world"):WaitForChild("npcs"):WaitForChild("Marc Merchant"):WaitForChild("description"):WaitForChild("idle"),
                                npc = workspace:WaitForChild("world"):WaitForChild("npcs"):WaitForChild("Marc Merchant")
                            }
                        }
                        game:GetService("ReplicatedStorage"):WaitForChild("events"):WaitForChild("Sell"):InvokeServer(unpack(args))
                        task.wait(0.2)
                    end
                end)
            end
        end
    })


    local autoOpenItemEnabled = false

    AutosSection:AddToggle({
        Title = "Auto Open Bait",
        Default = false,
        Content = "",
        Callback = function(isEnabled)
            autoOpenItemEnabled = isEnabled
            task.spawn(function()
                local PromptAmount = game:GetService("ReplicatedStorage"):WaitForChild("events"):WaitForChild("PromptAmount")
                PromptAmount.OnClientInvoke = function()
                    return 50
                end
                
                while autoOpenItemEnabled do
                    local char = game.Players.LocalPlayer.Character
                    local backpack = game.Players.LocalPlayer.Backpack
                    local item = char and char:FindFirstChildOfClass("Tool")
                    
                    if not item and backpack then
                        item = backpack:FindFirstChildOfClass("Tool")
                        if item then item.Parent = char end
                    end

                    if item then
                        item.Enabled = true
                        item:Activate()
                        item.Parent = backpack
                        item.Parent = char
                    else
                        autoOpenItemEnabled = false
                        break
                    end
                    task.wait()
                end
            end)
        end,
    })
    

local function equipAndClick(tool)
    local originalAutoCast = _G.Config.AutoCast
    _G.Config.AutoCast = false
    if not LocalPlayer.Character then 
        _G.Config.AutoCast = originalAutoCast
        return 
    end
    LocalPlayer.Character.Humanoid:EquipTool(tool)
    task.wait(0.5)
    mouse1press()
	wait(0.1)
    mouse1release()
    task.wait(1)
    _G.Config.AutoCast = originalAutoCast
end
DayTotemDropdown1 = "None"
NightTotemDropdown2 = "None"
local AutoAuroraTotem = false
local function autoTotemLoop()
    while AutoAuroraTotem do
        task.wait(1)
        
        local rodName = workspace.PlayerStats[LocalPlayer.Name].T[LocalPlayer.Name].Stats.rod.Value
        local cycleObj = 
            game:GetService("ReplicatedStorage"):FindFirstChild("world") and
            game:GetService("ReplicatedStorage").world:FindFirstChild("cycle")
        local cycle = cycleObj and cycleObj.Value or nil
        
        if not cycle then
            SendNotif("Error", "Failed to get cycle!", 3)
            break
        end
        
        local backpack = game.Players.LocalPlayer:FindFirstChild("Backpack")
        if not backpack then
            print("ERROR: Backpack not found!")
            SendNotif("Error", "Backpack not found!", 3)
            break
        end
        
        if cycle == "Day" and DayTotemDropdown1 == "Sundial Totem" then
            local sundialTotem = backpack:FindFirstChild("Sundial Totem")
            if sundialTotem then
                equipAndClick(sundialTotem)
                task.wait(0.5)
                local rod = backpack:FindFirstChild(rodName)
                if rod then
                    LocalPlayer.Character.Humanoid:EquipTool(rod)
                end
                while cycle == "Day" do
                    task.wait(1)
                    cycle = cycleObj and cycleObj.Value or nil
                end
            end
        end
        
        if cycle == "Night" and NightTotemDropdown2 == "Aurora Totem" then
            local auroraTotem = backpack:FindFirstChild("Aurora Totem")
            if auroraTotem then
                equipAndClick(auroraTotem)
                task.wait(0.5)
                local rod = backpack:FindFirstChild(rodName)
                if rod then
                    LocalPlayer.Character.Humanoid:EquipTool(rod)
                end
                while cycle == "Night" do
                    task.wait(1)
                    cycle = cycleObj and cycleObj.Value or nil
                end
            end
        end
    end
end
if not genv then genv = {} end
if genv.SelectedDayTotem == nil then genv.SelectedDayTotem = '' end
if genv.SelectedNightTotem == nil then genv.SelectedNightTotem = '' end
if genv.AutoTotemToggle == nil then genv.AutoTotemToggle = false end
if genv.AutoTotemRunning == nil then genv.AutoTotemRunning = false end
if genv.TotemSummoned == nil then genv.TotemSummoned = false end
if genv.TotemLock == nil then genv.TotemLock = false end
if genv.LastCycle == nil then genv.LastCycle = '' end
if genv.AutoPurchaseIfNone == nil then genv.AutoPurchaseIfNone = false end

TotemDay = AuraSection:AddDropdown({
    Title = 'Select Day Totem',
    Options = {
        'Sundial Totem',
        'Aurora Totem',
        'Tempest Totem',
        'Smokescreen Totem',
        'Windset Totem',
        'Eclipse Totem',
        'Meteor Totem',
        'Blizzard Totem',
        'Avalanche Totem',
        'Zeus Storm Totem',
        "Poseidon's Wrath Totem",
        'Mutation Totem',
        'Shiny Totem',
        'Sparkling Totem',
    },
    Value = 'Select Day Totem',
    PlaceHolder = 'Select Totem - Day',
    Multiple = false,
    Callback = function(SelectedTotem)
        if not genv then genv = {} end
        genv.SelectedDayTotem = SelectedTotem or ''
        print('Day Totem dipilih:', tostring(SelectedTotem))
    end,
})

TotemNight = AuraSection:AddDropdown({
    Title = 'Select Night Totem',
    Options = {
        'Sundial Totem',
        'Aurora Totem',
        'Tempest Totem',
        'Smokescreen Totem',
        'Windset Totem',
        'Eclipse Totem',
        'Meteor Totem',
        'Blizzard Totem',
        'Avalanche Totem',
        'Zeus Storm Totem',
        "Poseidon's Wrath Totem",
        'Mutation Totem',
        'Shiny Totem',
        'Sparkling Totem',
    },
    Value = 'Select Night Totem',
    PlaceHolder = 'Select Totem - Night',
    Multiple = false,
    Callback = function(SelectedTotem)
        if not genv then genv = {} end
        genv.SelectedNightTotem = SelectedTotem or ''
        print('Night Totem dipilih:', tostring(SelectedTotem))
    end,
})

TotemAuto = AuraSection:AddToggle({
    Title = 'Auto Totem',
    Value = false,
    Callback = function(isEnabled)
        genv.AutoTotemToggle = isEnabled
        if isEnabled then
            if genv.AutoTotemRunning then
                print('Auto Totem sudah berjalan!')
                return
            end
            
            genv.AutoTotemRunning = true
            print('Auto Totem diaktifkan')
            
            task.spawn(function()
                while genv.AutoTotemToggle do
                    local success = pcall(function()
                        task.wait(0.1)
                        local currentCycle = ReplicatedStorage.world.cycle.Value
                        
                        local selectedTotem = ''
                        if currentCycle == 'Day' then
                            selectedTotem = tostring(genv.SelectedDayTotem or '')
                        else
                            selectedTotem = tostring(genv.SelectedNightTotem or '')
                        end
                        if genv.LastCycle ~= currentCycle then
                            genv.TotemSummoned = false
                            genv.LastCycle = currentCycle
                            local function getQuest()
                        local playerStats = workspace:FindFirstChild("PlayerStats")
                        if not playerStats then return nil end
                        
                        local myStats = playerStats:FindFirstChild(LocalPlayer.Name)
                        if not myStats then return nil end

                        -- Try finding "Quests" folder recursively
                        local questsFolder = nil
                        for _, desc in ipairs(myStats:GetDescendants()) do
                            if desc.Name == "Quests" then
                                questsFolder = desc
                                break
                            end
                        end
                        
                        if questsFolder then
                            for _, child in ipairs(questsFolder:GetChildren()) do
                                if child.Name:find("Angler Quest") then
                                    return child
                                end
                            end
                        end
                        return nil
                    end        
                            genv.TotemLock = false
                            
                            if selectedTotem == '' or selectedTotem == 'nil' or 
                               selectedTotem == 'Select Day Totem' or selectedTotem == 'Select Night Totem' then
                                task.wait(2)
                                return
                            end

                            local oldTotem = workspace:FindFirstChild(LocalPlayer.Name)
                            if oldTotem then
                                for _, child in pairs(oldTotem:GetChildren()) do
                                    if child.Name:find("Totem") and child.Name ~= selectedTotem then
                                        pcall(function() child:Destroy() end)
                                    end
                                end
                            end
                            
                            task.wait(0.3)
                        end
                        local playerFolder = workspace:FindFirstChild(LocalPlayer.Name)
                        local totemInWorld = playerFolder and playerFolder:FindFirstChild(selectedTotem)
                        if genv.TotemSummoned then
                            task.wait(1)
                            return
                        end
                        if genv.TotemLock then
                            task.wait(0.3)
                            return
                        end
                        print('→ Memulai summon totem:', selectedTotem, '(' .. currentCycle .. ')')
                        genv.TotemLock = true
                        local totemItem = LocalPlayer.Backpack:FindFirstChild(selectedTotem)
                        if not totemItem and genv.AutoPurchaseIfNone then
                            pcall(function()
                                ReplicatedStorage.events.purchase:FireServer(
                                    selectedTotem,
                                    'Item',
                                    nil,
                                    1
                                )
                            end)
                            
                            local waitTime = 0
                            local maxWait = 5
                            while waitTime < maxWait do
                                totemItem = LocalPlayer.Backpack:FindFirstChild(selectedTotem)
                                if totemItem then
                                    break
                                end
                                task.wait(0.2)
                                waitTime = waitTime + 0.2
                            end
                        end
                        
                        if not totemItem then
                            if genv.AutoPurchaseIfNone then
                                pcall(function()
                                    ReplicatedStorage.events.purchase:FireServer(
                                        selectedTotem,
                                        'Item',
                                        nil,
                                        1
                                    )
                                end)
                            end
                            genv.TotemLock = false
                            task.wait(1)
                            return
                        end
                        totemItem.Parent = LocalPlayer.Character
                        task.wait(0.2)
                        local activated = false
                        local maxAttempts = 30
                        local attempts = 0
                        
                        while attempts < maxAttempts and not activated do
                            local activeTotem = LocalPlayer.Character
                                and LocalPlayer.Character:FindFirstChild(selectedTotem)
                            
                            if activeTotem then
                                local success, err = pcall(function()
                                    activeTotem:Activate()
                                end)
                                
                                if success then
                                    task.wait(0.2)
                                    local verifyTotem = workspace:FindFirstChild(LocalPlayer.Name)
                                        and workspace[LocalPlayer.Name]:FindFirstChild(selectedTotem)
                                    
                                    if verifyTotem then
                                        activated = true
                                        genv.TotemSummoned = true
                                        break
                                    end
                                elseif err then
                                    warn('Error aktivasi:', err)
                                end
                            end
                            
                            task.wait(0.1)
                            attempts = attempts + 1
                        end
                        
                        local currentTotem = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild(selectedTotem)
                        if currentTotem then
                            currentTotem.Parent = LocalPlayer.Backpack
                        end

                        if not activated then
                            genv.TotemSummoned = false
                        end

                        genv.TotemLock = false
                        task.wait(0.3) 
                    end)
                    
                    if not success then
                        warn('⚠ Error dalam loop auto totem')
                        genv.TotemLock = false
                        task.wait(1)
                    end
                end
                genv.AutoTotemRunning = false
                genv.TotemLock = false
                genv.TotemSummoned = false
            end)
        else
            genv.AutoTotemToggle = false
            genv.TotemLock = false
            genv.TotemSummoned = false
            task.wait(0.1)
            genv.AutoTotemRunning = false
        end
    end,
})

AuraSection:AddToggle({
    Title = 'Auto Sundial Totem',
    Value = false,
    Callback = function(isEnabled)
        genv.InfSundial = isEnabled
        if isEnabled then
            task.spawn(function()
                while genv.InfSundial do
                    local Backpack = LocalPlayer.Backpack
                    local Character = LocalPlayer.Character
                    local sundial = Character:FindFirstChild("Sundial Totem") or Backpack:FindFirstChild("Sundial Totem")
                    
                    if not sundial then
                        pcall(function()
                             game:GetService("ReplicatedStorage").events.purchase:FireServer("Sundial Totem", "Item", nil, 1)
                        end)
                        task.wait(1)
                        sundial = Character:FindFirstChild("Sundial Totem") or Backpack:FindFirstChild("Sundial Totem")
                    end

                    if sundial then
                        sundial.Parent = Character
                        task.wait(0.5)
                        sundial:Activate()
                        task.wait(2.5)
                        sundial.Parent = Backpack
                        task.wait(0.5)
                    else
                        task.wait(1)
                    end
                end
            end)
        end
    end,
})

     Main = AreaTab:AddSection('Main', true)
     SAVEPOSTION = AreaTab:AddSection('Save Positon', true)
     NPCSection = AreaTab:AddSection('NPC Teleport', true)
     BallonSection = AreaTab:AddSection('Ballon', false)

    -- Use global cache to persist data across script re-runs
    _G.cachedNpcLocations = _G.cachedNpcLocations or {}
     cachedNpcLocations = _G.cachedNpcLocations
    -- Pre-load known locations (Anglers)
     knownLocations = {
        ["Angler (Moosewood)"] = CFrame.new(481, 151, 299),
        ["Angler (Roslit)"] = CFrame.new(-1512, 140, 688),
        ["Angler (Sunstone)"] = CFrame.new(-885, 135, -1115),
        ["Angler (Terrapin)"] = CFrame.new(-153, 144, 1954),
        ["Angler (Depths)"] = CFrame.new(980, -700, 1230),
        ["Angler (Ancient)"] = CFrame.new(5737, 177, -57),
        ["Angler (Forsaken)"] = CFrame.new(-2702, 169, 1798),
        ["Angler (Crimson)"] = CFrame.new(-1069, -361, -4811),
        ["Angler (Luminescent)"] = CFrame.new(-1050, -337, -4078),
        ["Angler (Jungle)"] = CFrame.new(-2726, 226, -2186),
        ["Merlin"] = CFrame.new(-929, 224, -996),
        ["Pierre"] = CFrame.new(387, 133, 258),
        ["Halt"] = CFrame.new(-1319, 133, 412),
        ["Appraiser (Roslit)"] = CFrame.new(-1644, 137, 727),
        ["Appraiser (Moosewood)"] = CFrame.new(446, 150, 230),
        ["Appraiser (Terrapin)"] = CFrame.new(-109, 157, 1956),
    }
    for n, c in pairs(knownLocations) do
        cachedNpcLocations[n] = c
    end

     function cacheCurrentNpcs()
        if workspace:FindFirstChild("world") and workspace.world:FindFirstChild("npcs") then
            for _, npc in pairs(workspace.world.npcs:GetChildren()) do
                if npc:IsA("Model") then
                     root = npc:FindFirstChild("HumanoidRootPart") or npc:FindFirstChild("Head") or npc.PrimaryPart
                    if root then
                        cachedNpcLocations[npc.Name] = root.CFrame
                    end
                end
            end
        end
    end
    
    -- Listener for new NPCs streaming in
    if workspace:FindFirstChild("world") and workspace.world:FindFirstChild("npcs") then
         workspace.world.npcs.ChildAdded:Connect(function(child)
            task.wait(1) 
            if child:IsA("Model") then
                 root = child:FindFirstChild("HumanoidRootPart") or child:FindFirstChild("Head") or child.PrimaryPart
                if root then
                    cachedNpcLocations[child.Name] = root.CFrame
                    
                    -- Auto update dropdown
                    if updateNpcList and NpcDropdown then
                        updateNpcList()
                        if NpcDropdown.SetValues then
                            NpcDropdown:SetValues(npcNames)
                        elseif NpcDropdown.SetOptions then
                            NpcDropdown:SetOptions(npcNames)
                        end
                    end
                end
            end
         end)
    end

     npcNames = {}
     function updateNpcList()
        cacheCurrentNpcs()
        npcNames = {}
        for name, _ in pairs(cachedNpcLocations) do
            table.insert(npcNames, name)
        end
        table.sort(npcNames)
    end
    updateNpcList()

     selectedNpcToTp = nil
     NpcDropdown = NPCSection:AddDropdown({
        Title = "Select NPC",
        Options = npcNames,
        Default = "None",
        Callback = function(Value)
            selectedNpcToTp = Value
        end
    })

    NPCSection:AddButton({
        Title = "Teleport",
        Callback = function()
            local targetCFrame = cachedNpcLocations[selectedNpcToTp]
            
            -- Prioritize live NPC object if available
            if selectedNpcToTp and workspace.world.npcs:FindFirstChild(selectedNpcToTp) then
                 local npc = workspace.world.npcs[selectedNpcToTp]
                 local root = npc:FindFirstChild("HumanoidRootPart") or npc:FindFirstChild("Head") or npc.PrimaryPart
                 if root then
                    targetCFrame = root.CFrame
                 end
            end
            
            if targetCFrame and game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = targetCFrame + Vector3.new(0, 3, 0)
            else
                print("NPC location unknown or character not ready.")
            end
        end
    })

    NPCSection:AddButton({
        Title = "Refresh NPC List",
        Callback = function()
            updateNpcList()
            if NpcDropdown.SetValues then
                NpcDropdown:SetValues(npcNames)
            elseif NpcDropdown.SetOptions then
                NpcDropdown:SetOptions(npcNames)
            end
        end
    })

    stateMosslurker = false
    local savedLocation = nil
    

    local FishingSettings = {
        AutoFishing = false,
        SelectedZone = {"None"},
        SavedLocation = nil
    }

    -- local FishingZones = {
    --     "Beluga",
    --     "Magician Narwhall",
    --     "Narwhall",
    --     "Megalodon",
    --     "Ancient Megalodon",
    --     "Phantom Megalodon",
    --     "Kraken",
    --     "Ancient Kraken",
    --     "Colossal Blue Dragon",
    --     "Ancient Colossal Dragon",
    --     "Scylla",
    --     "Mosslurker", 
    --     "Orcas Pool", 
    --     "Moby", 
    --     "Megalodon Default", 
    --     "Megalodon Ancient", 
    --     "Megalodon Phantom", 
    --     "Great White Shark", 
    --     "Great Hammerhead Shark", 
    --     "Whale Shark", 
    --     "The Depths - Serpent", 
    --     "Isonade", 
    --     "Forsaken Veil - Scylla", 
    --     "Blarney McBreeze", 
    --     "Sea Leviathan Pool", 
    --     "Animal Pool", 
    --     "Octophant Pool Without Elephant", 
    --     "Kraken Pool", 
    --     "Blue Moon - First Sea",
    --     "LEGO", 
    --     "LEGO - Studolodon"
    -- }

    -- local ZoneDropdown = FishingEventZone:AddDropdown({
    --     Title = "Select Fishing Zone",
    --     Content = "Choose which fishing zone to auto-fish",
    --     Options = FishingZones,
    --     Multi = true,
    --     Callback = function(selectedZone)
    --         FishingSettings.SelectedZone = selectedZone
    --         print("Selected fishing zone:", selectedZone)
    --     end
    -- })

    -- FishingEventZone:AddToggle({
    --     Title = "Auto Fishing Zone",
    --     Content = "Enable/Disable auto fishing with selected zone, saves position when enabled",
    --     Default = false,
    --     Callback = function(state)
    --         FishingSettings.AutoFishing = state

    --         task.spawn(function()
    --             if state then
    --                 local Character = LocalPlayer.Character
    --                 if Character and Character:FindFirstChild("HumanoidRootPart") then
    --                     FishingSettings.SavedLocation = Character.HumanoidRootPart.CFrame
    --                     print("Saved current location")
    --                 end
    --                 task.spawn(function()
    --                     while FishingSettings.AutoFishing and task.wait() do
    --                         for _, selectedZone in ipairs(FishingSettings.SelectedZone) do
    --                             if selectedZone == "None" then
    --                                 if FishingSettings.SavedLocation then
    --                                     local Character = LocalPlayer.Character
    --                                     if Character and Character:FindFirstChild("HumanoidRootPart") then
    --                                         task.wait(0.1)
    --                                         if not _G.Config.selectedZoneADS then
    --                                             FreezeCharacter1(false)
    --                                             Character.HumanoidRootPart.CFrame = FishingSettings.SavedLocation
    --                                             fishingzone:SetValue(true)
    --                                         end
    --                                     end
    --                                 end
    --                                 continue
    --                             end
    --                             local zoneExists = false
    --                             local fishingZones = workspace:FindFirstChild("zones")
    --                                 and workspace.zones:FindFirstChild("fishing")

    --                             if fishingZones then
    --                                 local zone = fishingZones:FindFirstChild(selectedZone)
    --                                     or fishingZones:WaitForChild(selectedZone, 5)
    --                                 zoneExists = zone ~= nil
    --                             end
    --                             if zoneExists then
    --                                 fishingzone:SetValue(false)
    --                                 task.wait(2)
    --                                 teleportToFishingZone(selectedZone)
    --                             else
    --                                 if FishingSettings.SavedLocation then
    --                                     local Character = LocalPlayer.Character
    --                                     if Character and Character:FindFirstChild("HumanoidRootPart") then
    --                                         task.wait(0.1)
    --                                         if not _G.Config.selectedZoneADS then
    --                                             FreezeCharacter1(false)
    --                                             Character.HumanoidRootPart.CFrame = FishingSettings.SavedLocation
    --                                             fishingzone:SetValue(true)
    --                                         end
    --                                     end
    --                                 end
    --                             end
    --                         end
    --                     end
    --                 end)

    --             else
    --                 if FishingSettings.SavedLocation then
    --                     local Character = LocalPlayer.Character
    --                     if Character and Character:FindFirstChild("HumanoidRootPart") then
    --                         Character.HumanoidRootPart.CFrame = FishingSettings.SavedLocation
    --                         FreezeCharacter1(false)
    --                         print("Auto fishing disabled, returned to saved location")
    --                     end
    --                 end
    --                 FishingSettings.SavedLocation = nil
    --             end
    --         end)
    --     end
    -- })

    --// Variables
    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer
    local workspace = game:GetService("Workspace")


    FishingEventZone:AddDropdown({
        Title = "Select Zone Event",
        Value = __var.Hunting_Target or "Choose Event",
        Multi = false,
        Options = {
            "Orca",'Baby Bloop Fish', 'Bloop Fish', "Moby", "Megalodon", "Mossjaw","Megalodon Ancient", "Megalodon Phantom", "Great White Shark",
            "Hammerhead Shark", "Whale Shark", "The Depths - Serpent",
            "Isonade (Strange Whirlpool)", "Scylla (Forsaken Veil)",
            "Blarney McBreeze", "Sea Leviathan Pool", "Animal Pool",
            "Octophant Pool Without Elephant", "Kraken Pool",
            "Blue Moon - Sea 2", "Blue Moon - Sea 1",
            "Lego Pool", "Studolodon Pool", "Mosslurker", "Narwhal"
        },
        Callback = function(Value)
            __var.Hunting_Target = Value
        end
    })

    FishingEventZone:AddToggle({
        Title = "Auto Zone Event",
        Value = __var.Hunting_Enabled or false,
        Callback = function(Value)
            if Value then
                __var.Hunting_Enabled = true

                if not __var.savedPosition then
                    local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                    if root then
                        __var.savedPosition = root.CFrame
                    end
                end

                task.spawn(function()
                    while __var.Hunting_Enabled do
                        task.wait(1)

                        local fishingZone = workspace:FindFirstChild("zones") and workspace.zones:FindFirstChild("fishing")
                        if not fishingZone then
                            warn("[Hunting] Fishing zone tidak ditemukan!")
                            break
                        end

                        local target = __var.Hunting_Target
                        local target_pool
                        local target_spawn
                        local teleport_pos
                        if target == "Orca" then
                            target_pool = fishingZone:FindFirstChild("Orcas Pool")
                        elseif target == "Moby" then
                            local whale_pool = fishingZone:FindFirstChild("Whales Pool")
                            if whale_pool then
                                target_pool = whale_pool
                                target_spawn = whale_pool:FindFirstChild("MobySpawn")
                            end
                        elseif target == "Megalodon" then
                            target_pool = fishingZone:FindFirstChild("Megalodon Default")
                        elseif target == "Mossjaw" then
                            target_pool = fishingZone:FindFirstChild("Mossjaw")
                        elseif target == "Megalodon Ancient" then
                            target_pool = fishingZone:FindFirstChild("Megalodon Ancient")
                        elseif target == "Megalodon Phantom" then
                            target_pool = fishingZone:FindFirstChild("Megalodon Phantom")
                        elseif target == "Great White Shark" then
                            target_pool = fishingZone:FindFirstChild("Great White Shark")
                        elseif target == "Hammerhead Shark" then
                            target_pool = fishingZone:FindFirstChild("Great Hammerhead Shark")
                        elseif target == "Whale Shark" then
                            target_pool = fishingZone:FindFirstChild("Whale Shark")
                        elseif target == "The Depths - Serpent" then
                            target_pool = fishingZone:FindFirstChild("The Depths - Serpent")
                        elseif target == "Isonade (Strange Whirlpool)" then
                            target_pool = fishingZone:FindFirstChild("Isonade")
                        elseif target == "Scylla (Forsaken Veil)" then
                            target_pool = fishingZone:FindFirstChild("Forsaken Veil - Scylla") 
                                or workspace:FindFirstChild("fish_Scylla")
                        elseif target == "Blarney McBreeze" then
                            target_pool = fishingZone:FindFirstChild("Blarney McBreeze")
                        elseif target == "Sea Leviathan Pool" then
                            target_pool = fishingZone:FindFirstChild("Sea Leviathan Pool")
                        elseif target == "Animal Pool" then
                            target_pool = fishingZone:FindFirstChild("Animal Pool") or fishingZone:FindFirstChild("Animal Pool - Second Sea")
                        elseif target == "Octophant Pool Without Elephant" then
                            target_pool = fishingZone:FindFirstChild("Octophant Pool Without Elephant")
                        elseif target == "Kraken Pool" then
                            target_pool = fishingZone:FindFirstChild("The Kraken Pool")
                        elseif target == "Blue Moon - Sea 2" then
                            target_pool = fishingZone:FindFirstChild("Blue Moon - Second Sea")
                        elseif target == "Blue Moon - Sea 1" then
                            target_pool = fishingZone:FindFirstChild("Blue Moon - First Sea")
                        elseif target == "Lego Pool" then
                            target_pool = fishingZone:FindFirstChild("LEGO")
                        elseif target == "Studolodon Pool" then
                            target_pool = fishingZone:FindFirstChild("LEGO - Studolodon")
                        elseif target == "Mosslurker" then
                            target_pool = fishingZone:FindFirstChild("Mosslurker")
                        elseif target == "Narwhal" then
                            target_pool = fishingZone:FindFirstChild("Narwhall")
                        elseif target == "Baby Bloop Fish" then
                            target_pool = fishingZone:FindFirstChild("Baby Bloop Fish")
                        elseif target == "Bloop Fish" then
                            target_pool = fishingZone:FindFirstChild("Bloop Fish") or fishingZone:FindFirstChild("Bloop Fisher")
                        end

                        if target_pool then
                            target_pool.CanCollide = true

                            if target == "Orca" then
                                teleport_pos = CFrame.new(target_pool.Position + Vector3.new(0, 74, 0))
                            elseif target == "Moby" and target_spawn then
                                teleport_pos = CFrame.new(target_spawn.Position + Vector3.new(0, 50, 0))
                            elseif target == "Megalodon" or target == "Great White Shark" or target == "Hammerhead Shark"
                                or target == "Whale Shark" or target == "Megalodon Ancient" or target == "Megalodon Phantom" then
                                teleport_pos = CFrame.new(target_pool.Position + Vector3.new(0, 40, 0))
                            elseif target == "The Depths - Serpent" then
                                teleport_pos = CFrame.new(target_pool.Position + Vector3.new(0, 20, 0))
                            elseif target == "Kraken Pool" then
                                teleport_pos = CFrame.new(target_pool.Position + Vector3.new(0, 73, 0))
                            elseif target == "Isonade (Strange Whirlpool)" then
                                teleport_pos = CFrame.new(target_pool.Position + Vector3.new(20, 115, 20))
                            elseif target == "Lego Pool" or target == "Studolodon Pool" then
                                teleport_pos = CFrame.new(target_pool.Position + Vector3.new(20, 10, 20))
                            elseif target == "Scylla (Forsaken Veil)" or target == "Blarney McBreeze" or target == "Sea Leviathan Pool" then
                                teleport_pos = CFrame.new(target_pool.Position + Vector3.new(0, 74, 0))
                            elseif target == "Animal Pool" or target == "Octophant Pool Without Elephant"
                                or target == "Blue Moon - Sea 2" or target == "Blue Moon - Sea 1"
                                or target == "Mosslurker" or target == "Narwhal" 
                                or target == "Bloop Fisher" or target == "Baby Bloop Fish" or target == "Bloop Fish" then
                                teleport_pos = CFrame.new(target_pool.Position + Vector3.new(0, 10, 0))
                            end

                            if teleport_pos then
                                local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                                if root then
                                    local player = game.Players.LocalPlayer
                                    local boat
                                    repeat
                                        boat = workspace:FindFirstChild("active")
                                            and workspace.active:FindFirstChild("boats")
                                            and workspace.active.boats:FindFirstChild(player.Name)
                                            and workspace.active.boats[player.Name]:FindFirstChild("Rowboat")

                                        if not boat then
                                            local Character = LocalPlayer.Character
                                            local HumanoidRootPart =
                                                Character:FindFirstChild('HumanoidRootPart')
                                            HumanoidRootPart.CFrame = CFrame.new(362, 134, 259)
                                            task.wait(0.5)
                                            _G.Config.equipRod = false
                                            local Char = game.Players.LocalPlayer.Character
                                            if Char and Char:FindFirstChild("Humanoid") then
                                                Char.Humanoid:UnequipTools()
                                            end
                                            local args = {
                                                {
                                                    voice = 8,
                                                    idle = workspace
                                                        :WaitForChild('world')
                                                        :WaitForChild('npcs')
                                                        :WaitForChild('Moosewood Shipwright')
                                                        :WaitForChild('description')
                                                        :WaitForChild('idle'),
                                                    npc = workspace
                                                        :WaitForChild('world')
                                                        :WaitForChild('npcs')
                                                        :WaitForChild('Moosewood Shipwright'),
                                                },
                                            }
                                            workspace
                                                :WaitForChild('world')
                                                :WaitForChild('npcs')
                                                :WaitForChild('Moosewood Shipwright')
                                                :WaitForChild('shipwright')
                                                :WaitForChild('giveUI')
                                                :InvokeServer(unpack(args))
                                            task.wait(0.2)
                                            local args = {
                                                'Rowboat',
                                            }
                                            game:GetService('ReplicatedStorage')
                                                :WaitForChild('packages')
                                                :WaitForChild('Net')
                                                :WaitForChild('RF/Boats/Purchase')
                                                :InvokeServer(unpack(args))

                                            task.wait(0.5)

                                            local args = {
                                                'Rowboat',
                                            }
                                            game:GetService('ReplicatedStorage')
                                                :WaitForChild('packages')
                                                :WaitForChild('Net')
                                                :WaitForChild('RF/Boats/Spawn')
                                                :InvokeServer(unpack(args))
                                            task.wait(0.3)
                                            game:GetService('ReplicatedStorage')
                                                :WaitForChild('packages')
                                                :WaitForChild('Net')
                                                :WaitForChild('RE/Boats/Close')
                                                :FireServer()
                                            task.wait(0.5)
                                            _G.Config.equipRod = true
                                            autoEquipRod()
                                            local player = game:GetService('Players').LocalPlayer
                                            local gui = player
                                                :WaitForChild('PlayerGui')
                                                :WaitForChild('hud')
                                                :WaitForChild('safezone')
                                                :WaitForChild('shipwright')

                                            gui.Visible = false

                                        end
                                    until boat
                                    for _, descendant in ipairs(boat:GetDescendants()) do
                                        local name = descendant.Name:lower()
                                        if name == "sitprompt" or name == "body" then
                                            print("Destroyed:", descendant:GetFullName())
                                            descendant:Destroy()
                                        end
                                    end
                                    boat:PivotTo(teleport_pos)
                                    task.wait(0.5)
                                    FreezeCharacter1(true)
                                end
                            end
                        else
                            __var.Hunting_Enabled = false
                        end
                    end
                    if __var.savedPosition then
                        local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                        if root then
                            FreezeCharacter1(false)
                            root.CFrame = __var.savedPosition
                        end
                        __var.savedPosition = nil
                    end
                end)
            else
                __var.Hunting_Enabled = false
                if __var.savedPosition then
                    local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                    if root then
                        FreezeCharacter1(false)
                        root.CFrame = __var.savedPosition
                    end
                    __var.savedPosition = nil
                end
            end
        end
    })

    teleportSpots = getTpSpots() 
    Dropdown(Main, "TP Area", "None", teleportSpots, false, function(selected)
        teleportTo(selected)
    end)
    local tpCoord = nil

    Main:AddInput({
        Title = "Teleport Coordinate",
        Default = "",
        Callback = function(val)
            if val and val ~= "" then
                local numbers = {}
                for num in string.gmatch(val, "[-%d%.]+") do
                    table.insert(numbers, tonumber(num))
                end

                if #numbers >= 3 then
                    tpCoord = Vector3.new(numbers[1], numbers[2], numbers[3])
                    print("Koordinat siap:", tpCoord)
                else
                    warn("Format salah! Masukkan setidaknya x, y, z")
                end
            end
        end
    })

    Main:AddButton({
        Title = "Teleport",
        Callback = function()
            local char = game.Players.LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") and tpCoord then
                char.HumanoidRootPart.CFrame = CFrame.new(tpCoord)
                print("Teleported ke:", tpCoord)
            else
                warn("Belum ada koordinat valid!")
            end
        end
    })
    Dropdown(Main, "Teleport Zone", _G.Config.selectedZone, fishingSpots, false, function(selected)
        _G.Config.selectedZone = selected
    end)

    Main:AddButton({
        Title = "Teleport Zone",
        Content = "Teleport to selected zone",
        Callback = function()
            task.spawn(function()
                TeleportFishingZoneNoFrezeandNoBoat(_G.Config.selectedZone)
            end)
        end
    })

    local selectedPlayer = "None"
    local teleportPlayerDropdown
    
    teleportPlayerDropdown = Dropdown(Main, "Teleport Player", "None", getPlayerNames(), false, function(selected)
        selectedPlayer = selected
    end)
    local teleportPlayerButton = Button(Main, "Teleport ke Pemain", function()
        if selectedPlayer ~= "None" then
            teleportToPlayer(selectedPlayer)
        end
    end)
    local function teleportTo(pos)
        local p = game.Players.LocalPlayer
        if p and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
            p.Character.HumanoidRootPart.CFrame = CFrame.new(pos)
        end
    end
    BallonSection:AddSeperator({
        Title = 'Ballon Teleport',
    })
    Button(BallonSection, "Teleport ke Balon 1", function()
        teleportTo(Vector3.new(201.9, 162, -33.7))
    end)
    Button(BallonSection, "Teleport ke Balon 2", function()
        teleportTo(Vector3.new(1005, 131, -1234))
    end)
    Button(BallonSection, "Teleport ke Balon 3", function()
        teleportTo(Vector3.new(-2800, 260, 1550))
    end)
    Button(BallonSection, "Teleport ke Balon 4", function()
        teleportTo(Vector3.new(-1244, 131, 1594))
    end)
    Button(BallonSection, "Teleport ke Balon 5", function()
        teleportTo(Vector3.new(-2001, 190, 389))
    end)
    Button(BallonSection, "Teleport ke Balon 6", function()
        teleportTo(Vector3.new(-1129, 228, -1158))
    end)
    Button(BallonSection, "Teleport ke Balon 7", function()
        teleportTo(Vector3.new(1237, 140, 551))
    end)
    Button(BallonSection, "Teleport ke Balon 8", function()
        teleportTo(Vector3.new(2747, 142, -785))
    end)
    Button(BallonSection, "Teleport ke Balon 9", function()
        teleportTo(Vector3.new(-3881, 131, 326))
    end)
    Button(BallonSection, "Teleport ke Balon 10", function()
        teleportTo(Vector3.new(-1804, 188, 256))
    end)
    Button(BallonSection, "Teleport ke Balon 11", function()
        teleportTo(Vector3.new(-9.5, 157, -1079))
    end)
    Button(BallonSection, "Teleport ke Balon 12", function()
        teleportTo(Vector3.new(545, 295, -1887))
    end)
    Button(BallonSection, "Teleport ke Balon 13", function()
        teleportTo(Vector3.new(-2015, 224, -496))
    end)
    Button(BallonSection, "Teleport ke Balon 14", function()
        teleportTo(Vector3.new(506, 172, 220))
    end)
    Button(BallonSection, "Teleport ke Balon 15", function()
        teleportTo(Vector3.new(1742, 141, -2481))
    end)
    Button(BallonSection, "Teleport ke Balon 16", function()
        teleportTo(Vector3.new(1742, 141, -2481))
    end)
    Button(BallonSection, "Teleport ke Balon 17", function()
        teleportTo(Vector3.new(106, 184, 2074))
    end)
    Button(BallonSection, "Teleport ke Balon 18", function()
        teleportTo(Vector3.new(3019, -130, 2451))
    end)
    Button(BallonSection, "Teleport ke Balon 19", function()
        teleportTo(Vector3.new(5934, 259, 216))
    end)
    Button(BallonSection, "Teleport ke Balon 20", function()
        teleportTo(Vector3.new(-1520, 130, 2194))
    end)

    local player = game:GetService("Players").LocalPlayer
    local HttpService = game:GetService("HttpService")

    local savedPositions = {}
    local savedPositionName = "SHIELD"
    local selectedPosition = "None"
    local saveFileName = "saved_positions_" .. player.UserId .. ".json"
    local function loadSavedPositions()
        local success, result = pcall(function()
            if isfile and isfile(saveFileName) then
                jsonData = readfile(saveFileName)
                return HttpService:JSONDecode(jsonData)
            end
            return {}
        end)
        
        if success then
            return result
        else
            warn("Gagal memuat posisi tersimpan:", result)
            return {}
        end
    end
    function manualSaveConfig()
        SaveConfig(SelectedConfig)
    end
    function savePositionsToFile()
        success, errorMsg = pcall(function()
            if writefile then
                jsonData = HttpService:JSONEncode(savedPositions)
                writefile(saveFileName, jsonData)
            end
        end)
        
        if not success then
            warn("Gagal menyimpan posisi:", errorMsg)
        end
    end
    savedPositions = loadSavedPositions()

    SAVEPOSTION:AddInput({
        Title = "Name Spot",
        Default = savedPositionName,
        Callback = function(val)
            if val and val ~= "" then
                savedPositionName = val
            end
        end
    })
    teleportPositionDropdown = SAVEPOSTION:AddDropdown({
        Title = "Saved Positions",
        Content = "Select a saved position to teleport",
        Multi = false,
        Options = {"None"},
        Default = "None",
        Callback = function(val)
            selectedPosition = val
            print("Position selected:", val)
        end
    })
    function refreshDropdown()
        names = {"None"}
        for name in pairs(savedPositions) do
            table.insert(names, name)
        end
        
        teleportPositionDropdown:Refresh(names)
    end

    SAVEPOSTION:AddButton({
        Title = "Save Position",
        Callback = function()
            if savedPositionName and savedPositionName ~= "" then
                character = player.Character
                if character and character:FindFirstChild("HumanoidRootPart") then
                    pos = character.HumanoidRootPart.Position
                    savedPositions[savedPositionName] = {
                        X = pos.X,
                        Y = pos.Y,
                        Z = pos.Z
                    }
                    savePositionsToFile()
                    refreshDropdown()
                end
            end
        end
    })
    SAVEPOSTION:AddButton({
        Title = "Teleport ke Posisi",
        Callback = function()
            if selectedPosition ~= "None" and savedPositions[selectedPosition] then
                character = player.Character
                if character and character:FindFirstChild("HumanoidRootPart") then
                    posData = savedPositions[selectedPosition]
                    targetPosition = Vector3.new(posData.X, posData.Y, posData.Z)
                    
                    character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
                    print("Teleport ke:", selectedPosition)
                end
            end
        end
    })
    SAVEPOSTION:AddButton({
        Title = "Delete Selected Position",
        Callback = function()
            if selectedPosition ~= "None" and savedPositions[selectedPosition] then
                savedPositions[selectedPosition] = nil
                savePositionsToFile()
                refreshDropdown()
                selectedPosition = "None"
                print("Posisi dihapus:", selectedPosition)
            end
        end
    })
    refreshDropdown()
end


setupGUI()
